@using EvictionFiler.Application.DTOs.CourtDto
@using EvictionFiler.Application.Interfaces.IRepository.MasterRepository
@using EvictionFiler.Application.Interfaces.IServices
@using EvictionFiler.Client.SpinnerService
@using EvictionFiler.Domain.Entities.Master

@inject ICourtService courtService
@inject ICaseTypeRepository CaseTypeRepository
@inject SpinnerService spinnerservice

<style>
    .offcanvas.show {
    transform: translateX(0%);
    }

    .offcanvas {
    transform: translateX(100%);
    width: 500px !important;
    }

    .color-text {
    color: #1F365D;
    }
</style>

<div class="offcanvas offcanvas-end show border-start shadow" tabindex="-1" id="createCourt"
style="visibility:@(IsVisible ? "visible" : "hidden"); transition: transform 0.9s ease-in-out; min-width: 55%;"
aria-labelledby="createCourtLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="createCourtLabel">Add New Court</h5>
        <button type="button" class="btn-close text-reset" @onclick="Hide"></button>
    </div>

    <div class="offcanvas-body">
        <EditForm Model="@courtDto" OnValidSubmit="SubmitCourt" FormName="CreateCourt">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="row">
                <div class=" col-6 mb-3">
                    <label class="form-label color-text">Court Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-landmark color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.Court" placeholder="Enter Court Name" />
                    </div>
                </div>
                <div class=" col-6 mb-3">
                    <label class="form-label color-text">Phone</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-phone color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.Phone" placeholder="Enter Phone" />
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-3 mb-3">
                    <label class="form-label color-text">Part</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-landmark color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.Part" placeholder="Enter Part" />
                    </div>
                </div>
                <div class="col-3 mb-3">
                    <label class="form-label color-text">Room No.</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-door-open color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.RoomNo" placeholder="Enter Room" />
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <label class="form-label color-text">Virtual Link</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-tv color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.VirtualLink" placeholder="Enter Virtual Link" />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-7 mb-3">
                    <label class="form-label color-text">Address</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-location-dot color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.Address" placeholder="Enter Address" />
                    </div>
                </div>
                <div class="col-5 mb-3">
                    <label class="form-label color-text">Toll-Free</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-phone color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.CallIn" placeholder="Enter Toll-Free Number " />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-4 mb-3">
                    <label class="form-label color-text">ConferenceId</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-tv color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.ConferenceId" placeholder="Enter ConferenceId" />
                    </div>
                </div>

                <div class="col-4 mb-3">
                    <label class="form-label color-text">Judge</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-gavel color-text"></i></span>
                        <InputText class="form-control" @bind-Value="courtDto.Judge" placeholder="Enter Judge Name" />
                    </div>
                </div>

                <div class="col-4 mb-3">
                    <label class="form-label color-text">County</label>
                    <InputSelect class="form-select" @bind-Value="courtDto.CountyId" style="cursor:pointer;">
                        <option value="emptyGuid">-- Select Type --</option>
                        @foreach (var l in AllCounty)
                        {
                            <option value="@l.Id">@l.Name</option>
                        }
                    </InputSelect>
                    
                </div>
            </div>


            <div class="mb-4">
                <label class="form-label color-text">Notes</label>
                <InputTextArea class="form-control" @bind-Value="courtDto.Notes" placeholder="Enter Notes" />
            </div>

            <div class="d-flex justify-content-end" >
                <button type="submit" class="btn btn-primary btn-lg" style="background-color:#1F365D;">Submit</button>
            </div>
        </EditForm>
    </div>
</div>

@code {
    [Parameter] public CourtDto courtDto { get; set; } = new CourtDto();
    [Parameter] public EventCallback<CourtDto> OnSubmit { get; set; }
    private List<County> AllCounty = new List<County>();
    private bool IsVisible { get; set; } = false;
    private Guid emptyGuid = Guid.Empty;

    public async void Show(CourtDto model = null)
    {
        spinnerservice.Show();
        await Task.Delay(200);
        courtDto = model ?? new CourtDto();
        IsVisible = true;
        AllCounty = await CaseTypeRepository.GetAllCounty();
        StateHasChanged();
        spinnerservice.Hide();
    }

    public void Hide()
    {
        IsVisible = false;
        StateHasChanged();
    }

    private async Task SubmitCourt()
    {
        spinnerservice.Show();

        await courtService.AddCourtAsync(courtDto);

        if (OnSubmit.HasDelegate)
        {
            await OnSubmit.InvokeAsync(courtDto);
        }

        Hide();
        await Task.Delay(500);
        spinnerservice.Hide();
    }
}


