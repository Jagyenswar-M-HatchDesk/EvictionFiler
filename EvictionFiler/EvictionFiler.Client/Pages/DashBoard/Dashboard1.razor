@page "/dashboard"
<PageTitle>Dashboard - Housing CourtFiler</PageTitle>
@using EvictionFiler.Application.Common.Interfaces
@using EvictionFiler.Application.Common.Models
@using EvictionFiler.Application.DTOs
@using EvictionFiler.Application.DTOs.ClientDto
@using EvictionFiler.Application.DTOs.DashboardDto
@using EvictionFiler.Application.DTOs.LandLordDto
@using EvictionFiler.Application.DTOs.LegalCaseDto
@using EvictionFiler.Application.DTOs.PaginationDto
@using EvictionFiler.Application.DTOs.RemainderCenterDto
@using EvictionFiler.Application.DTOs.TenantDto
@using EvictionFiler.Application.Interfaces.IRepository
@using EvictionFiler.Application.Interfaces.IServices
@* @using EvictionFiler.Client.Jwt *@
@using EvictionFiler.Client.AuthService
@using EvictionFiler.Client.SpinnerService
@inject SpinnerService spinnerservice
@using EvictionFiler.Client.Components.Layout
@using EvictionFiler.Domain.Entities
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization;

@using System.Security.Claims
@inject AuthenticationStateProvider AuthStateProvider
@using System.Globalization

@inject ILegalCaseService _service
@inject ICaseHearingService _caseService
@inject IRemianderCenterService _remainder
@inject IDashBoardRepository DashBoardRepository;
@inject SpinnerService spinnerservice;
@inject IClientService _clientService
@inject NavigationManager navManager
@inject UserContextService userContext
@inject ILoggedInUserService _loggedInUserService
@attribute [Authorize]


<style>
    :root {
        /* Light theme with Navy & Gold brand accents */
        --bg: #f6f7fb;
        /* app background */
        --card: #ffffff;
        /* cards */
        --border: #e9edf3;
        /* subtle borders */
        --text: #0f1728;
        /* primary text */
        --muted: #697386;
        /* secondary text */
        --navy: #0f2747;
        /* brand navy */
        --gold: #eab308;
        /* brand gold */
        --indigo: #5b67f2;
        /* supporting accent */
        --success: #10b981;
        /* green */
        --warning: #f59e0b;
        /* amber */
        --info: #06b6d4;
        /* cyan */
        --danger: #ef4444;
        /* red */
        --radius: 16px;
        --shadow: 0 8px 24px rgba(15, 23, 40, .06);
    }

    * {
        box-sizing: border-box
    }

    html,
    body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--bg);
        color: var(--text)
    }

    a {
        text-decoration: none;
        color: inherit
    }

    .container {
        max-width: 100%;
        margin: 22px auto;
        padding: 0 16px
    }

    /* Topbar */
    .topbar {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        justify-content: space-between;
        gap: 12px;
        padding: 7px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        flex-wrap: wrap
    }



    .topbar1 {
        gap: 12px;
        padding: 14px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        flex-wrap: wrap
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 800;
        color: var(--navy)
    }

        .brand .logo {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--navy), #274b87)
        }

    /* Search filters */
    .searchbar {
        flex: 1;
        display: flex;
        flex-wrap: wrap;
        margin-top: 10px;
    }

    .searchbar input {
    flex: 1 1 145px;
    padding: 8px 15px;
    border: 2px solid #020336;
    border-radius: 25px;
    outline: 0;
    font-size: 1rem
    }

    .searchbtn {
        padding: 8px 14px;
        background: var(--navy);
        border: 0;
        border-radius: 8px;
        color: #fff;
        cursor: pointer
    }

        .searchbtn:hover {
            padding: 8px 14px;
            background: #6b84af;
            border: 0;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.25s ease;
            transform: translateY(-2px);
        }

    .top-icons {
        display: flex;
        gap: 12px;
        color: #64748b
    }

    /* Greeting */
    .greeting {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 14px 0
    }

    .greeting h2 {
    margin: 0;
    font-weight: 800;
    color: var(--navy);
    font-size:34px;

    }

    .chips {
        display: flex;
        gap: 8px;
        flex-wrap: wrap
    }

    .chip {
        border: 1px solid var(--border);
        background: #fff;
        color: #334155;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: .85rem
    }

    /* Grid helpers */
    .grid {
        display: grid;
        gap: 12px
    }

    .cols-4 {
        grid-template-columns: repeat(4, 1fr)
    }

    .cols-3 {
        grid-template-columns: repeat(3, 1fr)
    }

    .cols-2 {
        grid-template-columns: repeat(2, 1fr)
    }

    @@media (max-width:1024px) {

        .cols-4,
        .cols-3 {
            grid-template-columns: repeat(2, 1fr)
        }
    }

    @@media (max-width:640px) {

        .cols-4,
        .cols-3,
        .cols-2 {
            grid-template-columns: 1fr
        }
    }

    /* Cards */
    .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow)
    }

    .pad {
        padding: 14px
    }

    .header {
    color: var(--muted);
    font-weight: 700;
    letter-spacing: .3px;
    text-transform: uppercase;
    font-size:16px;
    }

    .muted {
        color: var(--muted)
    }

    /* Stat tiles */
    .tile {
        position: relative;
        height: 86px;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0 16px;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: #fff;
        transition: .2s
    }

        .tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 22px rgba(0, 0, 0, .06)
        }

        .tile .icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            font-size: 20px;
            background: #0f27470f;
            color: var(--navy);
            border: 1px solid var(--border)
        }

    .tile .count {
    font-size: 26px;
    font-weight: 800
    }

        .tile .label {
            color: var(--muted)
        }

    /* Tabs */
    .tabs {
        display: flex;
        gap: 8px;
        margin: 14px 0
    }

    .tab {
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: #fff;
    cursor: pointer;
    font-size:14px;
    font-family:'Poppins';
    }

        .tab.active {
            color: #fff;
            background: linear-gradient(135deg, var(--navy), #274b87);
            border-color: transparent
        }

    /*    .tabpanes>section {
        display: none
        } */

    .tabpanes > section.active {
        display: block
    }

    /* Feeds */
    .feed {
        display: flex;
        gap: 10px;
        padding: 10px 0;
        border-bottom: 1px dashed var(--border)
    }

        .feed:last-child {
            border-bottom: 0
        }

    .avatar {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: #0f27470f;
        color: var(--navy);
        border: 1px solid var(--border);
        display: grid;
        place-items: center;
        font-weight: 700
    }

    /* Progress */
    .progress {
        height: 12px;
        width: 100%;
        background: #eef2ff;
        border-radius: 999px;
        overflow: hidden
    }

    .bar {
        height: 100%;
        background: linear-gradient(90deg, #facc15, #eab308)
    }

    /* SVG charts */
    .chart {
        height: 250px
    }

    .legend {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    font-size: 16px;
    color: var(--muted)
    }

        .legend i {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 3px;
            margin-right: 6px
        }

    /* Accordion */
    .accordion .acc-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer
    }

    .accordion .acc-body {
        display: none;
        padding-top: 10px
    }

    .accordion.open .acc-body {
        display: block
    }

    footer {
        color: var(--muted);
        text-align: center;
        margin: 28px 0
    }

    .heatmap-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(34px, 1fr));
        gap: 10px;
        margin-top: 15px;
    }

    .day-box {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        transition: background-color 0.3s ease;
        cursor: default;
    }

    .rz-chart {
        box-sizing: border-box;
        position: relative;
        height: 250px !important;
        width: 542px !important;
        /* margin-left: -40px !important; */
    }

    @@media (max-width:640px) {

        .rz-chart {
            box-sizing: border-box;
            position: relative;
            height: 250px !important;
            width: 357px !important;
            margin-left: -40px !important;
        }
    }

    @@media (min-width: 640px) and (max-width: 768px) {
        .rz-chart {
            box-sizing: border-box;
            position: relative;
            height: 250px !important;
            width: 276px !important;
            margin-left: -40px !important;
        }
    }

    @@media (min-width: 768px) and (max-width: 900px) {
        .rz-chart {
            box-sizing: border-box;
            position: relative;
            height: 250px !important;
            width: 385px !important;
            margin-left: -40px !important;
        }
    }

    #pipelineChart {
        width: 100%;
    }

    @@media (max-width: 580px) {
        #pipelineChart .rz-chart-column rect {
            width: 8px !important; /* bars ka width */
        }
    }

    .table-responsive {
        overflow-x: auto; /* Enable horizontal scroll */
        position: relative;
    }

    table.table thead th {
        color: #1F365D;
        background: #F2F0EC;
        margin-bottom: 0px !important;
    }
    .firm-container{
        font-size:20px;
    }

        .firm-container span.txt-firm {
            color: #ddb156;
            font-weight: 400;
            font-size: 18px;
        }
        .case-link:hover
        {
        font-weight: bold;
        }
        .btn-sm
        {
        min-height: 21px !important;
        border-radius: 7px !important;
        font-size: 12px !important;
        padding: 0px 5px !important;
        line-height: 1 !important;
        }
</style>

<div class="container">
    <!-- Topbar -->
    <div class="topbar ">
        <div class="brand">
            <div class="logo"></div>
            <div class="firm-container">
                🏛️ HousingCourtFiler.com
                <span class="txt-firm">
                    @if (identityUser?.IsSuperAdmin == true)
                    {
                        <text>Product Owner</text>
                    }
                    else
                    {
                        @identityUser?.Firm
                    }
                </span>
            </div>
        </div>
        <div class="top-icons">
            <span title="New Action">
                🟦  @if (identityUser?.IsSuperAdmin == true || identityUser?.IsAdmin == true)
                {
                    <text>Admin</text>
                }
                else
                {
                    <text>Staff Member</text>
                }
            </span>
        </div>
    </div>
    <div class="topbar1 card">
        <div>
            <span style="color: grey; font-size: 16px; font-weight:600;">CASE SEARCH & FILTERS</span>
        </div>
        <div class="searchbar row">
           
            @* <div class="col ">
                <input class="form-control search-box"
                       placeholder="Search by Client"
                       @bind="selectedClient"
                       @onfocusout="FocusOutClient"
                       @onfocus="OnClientFocus"
                       @oninput="OnClientInput" />


                <ul class="list-group position-absolute " style="z-index:1000; font-size:14px"
                    hidden="@( !clientSuggestionsChecked || !clientSuggestions.Any() )">
                    @if (clientSuggestions.Any())
                    {
                        @foreach (var suggestion in clientSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                style="cursor:pointer;"
                                @onclick="() => SelectClient(suggestion)">
                                @suggestion.ClientCode - @suggestion.FirstName @suggestion.LastName
                            </li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item text-muted">
                            No result found
                        </li>
                    }
                </ul>


            </div>
            <div class="col ">
                <input class="form-control search-box" placeholder="Search by LandLord" @bind="selectedLandlord"
                       @oninput="OnLandlordInput" @onfocusout="FocusOutLandlord" @onfocus="OnLandlordsFocus"
                       autocomplete="off" />


                <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                    hidden="@(!landlordSuggestions.Any() || !landlordSuggestionsChecked)">
                    @if (landlordSuggestions.Any())
                    {
                        @foreach (var suggestion in landlordSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                style="cursor:pointer;"
                                @onclick="() => Selectlandlord(suggestion)">
                                @suggestion.LandLordCode - @suggestion.FirstName @suggestion.LastName
                            </li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item text-muted">
                            No result found
                        </li>
                    }
                </ul>
            </div>
            <div class="col ">
                <input class="form-control search-box"
                       placeholder="Search by Tenant"
                       @bind="selectedTenant" @onfocusout="FocusOutTenant"
                       @oninput="OnTenantInput"
                       @onfocus="OnTenantsFocus"
                       autocomplete="off" />


                <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                    hidden="@(!tenantSuggestions.Any() || !tenantSuggestionsChecked)">
                    @if (tenantSuggestions.Any())
                    {
                        @foreach (var suggestion in tenantSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                style="cursor:pointer;"
                                @onclick="() => SelectTenant(suggestion)">
                                @suggestion.TenantCode - @suggestion.FirstName @suggestion.LastName
                            </li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item text-muted">
                            No result found
                        </li>
                    }
                </ul>
            </div>
            <div class="col ">
                <input class="form-control search-box"
                       placeholder="Search by Case"
                       @bind="selectedCase" @onfocusout="FocusOutCase"
                       @oninput="OnCaseInput"
                       @onfocus="OnCaseFocus"
                       autocomplete="off" />


                <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                    hidden="@(!caseSuggestions.Any() || !caseSuggestionsChecked)">
                    @if (caseSuggestions.Any())
                    {
                        @foreach (var suggestion in caseSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                style="cursor:pointer;"
                                @onclick="() => SelectCase(suggestion)">
                                @suggestion.Casecode
                            </li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item text-muted">
                            No result found
                        </li>
                    }
                </ul>
            </div> *@

                <!-- CLIENT -->
                <div class="col">
                    <input class="form-control search-box"
                           placeholder="Search by Client"
                           @bind="clientInput"
                           @oninput="OnClientInput"
                           @onfocus="OnClientFocus"
                           @onfocusout="OnClientFocusOut" />

                    <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                        hidden="@(!clientSuggestionsChecked || !clientSuggestions.Any())">
                        @foreach (var suggestion in clientSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                @onclick="() => SelectClient(suggestion)">
                                @suggestion.ClientCode - @suggestion.FirstName @suggestion.LastName
                            </li>
                        }
                    </ul>
                </div>

                <!-- LANDLORD -->
                <div class="col">
                    <input class="form-control search-box"
                           placeholder="Search by Landlord"
                           @bind="landlordInput"
                           @oninput="OnLandlordInput"
                           @onfocus="OnLandlordFocus"
                           @onfocusout="OnLandlordFocusOut"
                           autocomplete="off" />

                    <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                        hidden="@(!landlordSuggestionsChecked || !landlordSuggestions.Any())">
                        @foreach (var suggestion in landlordSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                @onclick="() => SelectLandlord(suggestion)">
                                @suggestion.LandLordCode - @suggestion.FirstName @suggestion.LastName
                            </li>
                        }
                    </ul>
                </div>

                <!-- TENANT -->
                <div class="col">
                    <input class="form-control search-box"
                           placeholder="Search by Tenant"
                           @bind="tenantInput"
                           @oninput="OnTenantInput"
                           @onfocus="OnTenantFocus"
                           @onfocusout="OnTenantFocusOut"
                           autocomplete="off" />

                    <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                        hidden="@(!tenantSuggestionsChecked || !tenantSuggestions.Any())">
                        @foreach (var suggestion in tenantSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                @onclick="() => SelectTenant(suggestion)">
                                @suggestion.TenantCode - @suggestion.FirstName @suggestion.LastName
                            </li>
                        }
                    </ul>
                </div>

                <!-- CASE -->
                <div class="col">
                    <input class="form-control search-box"
                           placeholder="Search by Case"
                           @bind="caseInput"
                           @oninput="OnCaseInput"
                           @onfocus="OnCaseFocus"
                           @onfocusout="OnCaseFocusOut"
                           autocomplete="off" />

                    <ul class="list-group position-absolute" style="z-index:1000; font-size:14px"
                        hidden="@(!caseSuggestionsChecked || !caseSuggestions.Any())">
                        @foreach (var suggestion in caseSuggestions)
                        {
                            <li class="list-group-item list-group-item-action"
                                @onclick="() => SelectCase(suggestion)">
                                @suggestion.Casecode
                            </li>
                        }
                    </ul>
                </div>

            <div class="col-md-2">

                <button class="searchbtn" @onclick="Search" style="border-radius:25px; width:100%;"> <i class="fa fa-search mx-1"></i>  </button>
            </div>

        </div>


    </div>

    <!-- Greeting & suggestions -->
    <div class="greeting">
        <h2 id="greet">Good Morning, @identityUser.Name </h2>
        <div class="chips">
            <span class="chip">“Show me holdovers filed this week”</span>
            <span class="chip">“Deadlines in Queens today”</span>
            <span class="chip">“Unpaid invoices > $1,000”</span>
        </div>
    </div>

    <!-- Quick Snapshot tiles (Top Row) -->
    <div class="grid cols-4" style="margin-bottom:12px">
        <a class="tile" href="/calender">
            <div class="icon">⚖️</div>
            <div>
                <div class="count" id="todayHearings">@totalCasesHearing</div>
                <div class="label">Hearings Today</div>

            </div>
        </a>
        <a class="tile" href="#deadlines">
            <div class="icon">🕔</div>
            <div>
                <div class="count" id="deadlineCount">0</div>
                <div class="label">Due Today / Overdue</div>
            </div>
        </a>
        <a class="tile" href="/legalcases">
            <div class="icon">📁</div>
            <div>
                <div class="count" id="filedWeek">@totalCases</div>
                <div class="label">Cases Filed This Week</div>
            </div>
        </a>
        <a class="tile" href="#approvals">
            <div class="icon">✅</div>

            <div>
                <div class="count" id="pendingApprovals">0</div>
                <div class="label">Pending Client Approvals</div>
            </div>
        </a>
    </div>

    <div class="grid cols-4" style="margin-bottom:18px">
        <a class="tile" href="#balances">
            <div class="icon">💳</div>
            <div>
                <div class="count" id="openBalances">$0k</div>
                <div class="label">Open Balance Alerts</div>
            </div>
        </a>
        <a class="tile" href="#trust">
            <div class="icon">🏦</div>
            <div>
                <div class="count" id="trustBalances">$0k</div>
                <div class="label">Trust Balances</div>
            </div>
        </a>
        <a class="tile" href="#progress">
            <div class="icon">📈</div>
            <div>
                <div class="count" id="taskPct">0%</div>
                <div class="label">Tasks Completed (wk)</div>
            </div>
        </a>
        <a class="tile" href="/remainder-center">
            <div class="icon">🔔</div>
            <div>
                <div class="count" id="alertCount">@totalRemainder</div>
                <div class="label">Smart Alerts</div>
            </div>
        </a>
    </div>

    <!-- Tabs (Middle/Bottom Rows combined) -->
    <div class="tabs" role="tablist">
        <button class="tab active" data-tab="charts">Charts & Visuals</button>
        <button class="tab" data-tab="alerts">Smart Alerts & Reminders</button>
        <button class="tab" data-tab="activity">Collaboration Feeds</button>
        <button class="tab" data-tab="tips">Practice Tips</button>
    </div>

    <div class="tabpanes">
        <!-- Charts & Visuals -->
        <section id="charts" class="active">
            <div class="grid cols-2">
                <div class="card pad">
                    <div class="header">Case Pipeline — Nonpayment vs Holdover vs Other</div>
                    <div id="pipelineChart" style="margin-top:-50px">
                        <RadzenMediaQuery Query="(max-width: 768px)" Change="OnMediaQueryChange" />


                        <RadzenStack>
                            <RadzenRow>
                                <RadzenColumn>
                                    <RadzenChart>
                                        <RadzenColumnSeries Data="@pipelineData"
                                                            CategoryProperty="Month"
                                                            ValueProperty="NonPayment"
                                                            Fill="#002B5C" />

                                        <RadzenColumnSeries Data="@pipelineData"
                                                            CategoryProperty="Month"
                                                            ValueProperty="Holdover"
                                                            Fill="#00BFFF" />

                                        <RadzenColumnSeries Data="@pipelineData"
                                                            CategoryProperty="Month"
                                                            ValueProperty="Other"
                                                            Fill="#FFA500" />

                                        <!-- width 22 + gap via spacing -->
                                        <RadzenColumnOptions Radius="2" Width="@columnWidth" />

                                        <!-- axis hidden but padding increased to add gap between categories -->
                                        <RadzenCategoryAxis Visible="true" Padding="20" />
                                        <RadzenLegend Visible="false" />
                                        <RadzenValueAxis Visible="false">
                                            <RadzenGridLines Visible="false" />
                                        </RadzenValueAxis>
                                    </RadzenChart>
                                </RadzenColumn>
                            </RadzenRow>
                        </RadzenStack>
                    </div>






                    <div class="legend">
                        <span><i style="background:var(--navy)"></i>Nonpayment</span><span>
                            <i style="background:var(--info)"></i>Holdover
                        </span><span>
                            <i style="background:var(--warning)"></i>Other
                        </span>
                    </div>
                </div>
                <div class="card pad">
                    <div class="header">Financial Snapshot — Billed vs Collected</div>
                    <div id="finacialChart" style="margin-top:-50px">
                        <RadzenStack>
                            <RadzenRow>
                                <RadzenColumn>
                                    <RadzenChart>
                                        <RadzenColumnSeries Data="@financialData"
                                                            CategoryProperty="Month"
                                                            ValueProperty="Collected"
                                                            Fill="#eab308" />

                                        <RadzenColumnSeries Data="@financialData"
                                                            CategoryProperty="Month"
                                                            ValueProperty="Billed"
                                                            Fill="#c4a000" />



                                        <!-- width 22 + gap via spacing -->
                                        <RadzenColumnOptions Radius="2" Width="28" />

                                        <!-- axis hidden but padding increased to add gap between categories -->
                                        <RadzenCategoryAxis Visible="false" Padding="30" />
                                        <RadzenLegend Visible="false" />
                                        <RadzenValueAxis Visible="false">
                                            <RadzenGridLines Visible="false" />
                                        </RadzenValueAxis>
                                    </RadzenChart>
                                </RadzenColumn>
                            </RadzenRow>
                        </RadzenStack>
                    </div>
                    <div class="legend">
                        <span><i style="background:var(--gold)"></i>Collected</span><span>
                            <i style="background:#c4a000"></i>Billed
                        </span>
                    </div>
                </div>
            </div>
            <div class="grid cols-2" style="margin-top:12px">
                <div class="card pad">
                    <div class="header">Calendar Heatmap — Deadlines & Appearances</div>
                    @* <div id="heatmap" class="chart" style="height:220px"></div> *@
                    <div class="heatmap-grid">
                        @foreach (var day in calendarData)
                        {
                            <div class="day-box" style="background-color:@GetColor(day.Intensity)" title="@day.Date.ToString("MMM dd")">
                            </div>
                        }
                    </div>
                </div>
                <div class="card pad">
                    <div class="header">Task Completion (This Week)</div>
                    <div class="progress" style="margin:8px 0">
                        <div class="bar" style="width:72%"></div>
                    </div>
                    <div class="muted" style="margin-bottom:8px">18 / 25 tasks completed</div>
                    <div id="sparkline" style="margin-bottom:-50px">
                        <RadzenStack>
                            <RadzenChart>
                                <RadzenLineSeries Smooth="true"
                                                  Data="@revenue2024"
                                                  CategoryProperty="Date"
                                                  Title="2024"
                                                  ValueProperty="task"
                                                  RenderingOrder="1">
                                    <RadzenSeriesAnnotation Visible="annotation"
                                                            TItem="Datatask"
                                                            Data="@revenue2024[7]"
                                                            OffsetY="-16"
                                                            Text="Acquisition" />

                                    <RadzenSeriesAnnotation Visible="annotation"
                                                            TItem="Datatask"
                                                            Data="@revenue2024[5]"
                                                            OffsetY="-16"
                                                            Text="IPO"
                                                            Fill="#0a0a0a" />

                                    <RadzenMarkers MarkerType="MarkerType.Circle" />
                                </RadzenLineSeries>

                                <!-- Axes removed -->
                                <RadzenCategoryAxis Visible="false" />
                                <RadzenLegend Visible="false" />
                                <RadzenValueAxis Visible="false">
                                    <RadzenGridLines Visible="false" />
                                </RadzenValueAxis>
                            </RadzenChart>
                        </RadzenStack>

                    </div>





                </div>
            </div>
        </section>
        <!-- Smart Alerts & Reminders -->
        <section id="alerts" style="margin-top:10px">
            <div class="grid cols-2">
                <div class="card pad accordion" id="acc-cases">
                    <div class="acc-head">
                        <div class="header">Cases Today</div><button class="tab small" data-acc="acc-cases">Expand</button>
                    </div>
                    <div class="acc-body">
                        <div class="feed">
                            <div class="avatar">10</div>
                            <div>
                                <div style="font-weight:600">Hearing — 10:00 AM</div><small class="muted">
                                    Brooklyn Housing Part
                                    H
                                </small>
                            </div>
                        </div>
                        <div class="feed">
                            <div class="avatar">1P</div>
                            <div>
                                <div style="font-weight:600">Appearance — 1:00 PM</div><small class="muted">Queens Part T</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card pad accordion" id="acc-tasks">
                    <div class="acc-head">
                        <div class="header">Pending Tasks</div><button class="tab small" data-acc="acc-tasks">Expand</button>
                    </div>
                    <div class="acc-body">
                        <div style="display:flex; justify-content:space-between; margin:6px 0">
                            <span>
                                Predicate Notice
                                response
                            </span><span style="background:var(--danger); color:#fff; padding:2px 8px; border-radius:999px">Overdue</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin:6px 0">
                            <span>Discovery due</span><span style="background:var(--warning); color:#fff; padding:2px 8px; border-radius:999px">Due Today</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid cols-3" style="margin-top:12px">
                <div class="card pad">
                    <strong>Overdue Notices</strong>
                    <div style="display:flex; gap:8px; margin-top:8px">
                        <span>⛔</span><small class="muted">
                            “Predicate Notice
                            response window expired — action needed.”
                        </small>
                    </div>
                </div>
                <div class="card pad">
                    <strong>NYSCEF Auto‑Synced Alerts</strong>
                    <div style="display:flex; gap:8px; margin-top:8px">
                        <span>🔄</span><small class="muted">
                            “Opposing counsel
                            filed Answer — see attached.”
                        </small>
                    </div>
                </div>
                <div class="card pad">
                    <strong>Case Transfer Notifications</strong>
                    <div style="display:flex; gap:8px; margin-top:8px">
                        <span>🔀</span><small class="muted">
                            Per‑diem coverage or
                            reassignment alerts.
                        </small>
                    </div>
                </div>
            </div>
        </section>

        <!-- Collaboration & Communication -->
        <section id="activity" style="margin-top:10px">
            <div class="grid cols-3">
                <div class="card pad">
                    <div class="header">Inbox Preview (NYSCEF Sync)</div>
                    <div class="feed">
                        <div class="avatar">CN</div>
                        <div>
                            <div style="font-weight:600">Court Notice — Motion filed</div><small class="muted">3m ago</small>
                        </div>
                    </div>
                    <div class="feed">
                        <div class="avatar">OC</div>
                        <div>
                            <div style="font-weight:600">Opposing Counsel — Answer filed</div><small class="muted">6m ago</small>
                        </div>
                    </div>
                    <div class="feed">
                        <div class="avatar">CC</div>
                        <div>
                            <div style="font-weight:600">Court Clerk — Order uploaded</div><small class="muted">10m ago</small>
                        </div>
                    </div>
                </div>
                <div class="card pad">
                    <div class="header">Internal Messages / Case Notes</div>
                    <div class="feed">
                        <div class="avatar">JD</div>
                        <div>
                            <div style="font-weight:600">John Doe pinned a note</div><small class="muted">5m ago</small>
                        </div>
                    </div>
                    <div class="feed">
                        <div class="avatar">TL</div>
                        <div>
                            <div style="font-weight:600">Team Lead assigned a new task</div><small class="muted">9m ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

</div>
@if (showCaseModal)
{
    <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header text-white" style="background-color: #1F365D;">
                    <h5 class="modal-title">
                        <i class="bi bi-bell-fill me-2"></i> Pending Reminders
                    </h5>
                    <button type="button" class="btn-close btn-close-white" aria-label="Close"
                            @onclick="@(() => showCaseModal = false)">
                    </button>
                </div>

                <div class="modal-body" style="max-height:360px; overflow-y:auto;">
                    @foreach (var group in groupedRemainder)
                    {
                        <div class="card p-2 mb-2" style="cursor:pointer; border:1px solid #d0d7e1;"
                             @onclick="@(() => OpenReminderPopup(group))">
                             <div class="d-flex justify-content-between align-items-center">

                                 <div>

                            <strong>Case @group.Key</strong>
                            <div class="text-muted">@group.Count() reminders pending</div>
                            </div>
                            <div>
                                    <button class="btn btn-sm" type="button" style="background-color:#1F365D; color:white; border-radius:25px; cursor:pointer;" @onclick="() => NavigateToCase(group.First().CaseId)" @onclick:stopPropagation="true">
                                        Go to case
                                    </button>
                            </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}

@if (showReminderModal && selectedGroup != null)
{
    <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">

                <div class="modal-header text-white" style="background-color: #1F365D;">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i> Reminders for Case <span class=" case-link text-decoration-underline " style="cursor:pointer;" @onclick ="()=>NavigateToCase(selectedGroup.First().CaseId)"> @selectedGroup.Key</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" aria-label="Close"
                            @onclick="CloseReminderPopup">
                    </button>
                </div>

                <div class="modal-body" style="max-height:350px; overflow-y:auto;">
                    @foreach (var r in selectedGroup)
                    {
                        <div class="p-2 mb-2 border rounded">
                            <div class="fw-semibold">@r.ReminderName</div>
                            <small class="text-muted">
                                Due: @r.When?.ToString("MMM dd, yyyy")
                            </small>
                        </div>
                    }
                </div>

            </div>
        </div>
    </div>
}

@code {
    bool showDataLabels = false;
    private string searchText;
    private bool isSearched = false;
    private string searchTermStatus = string.Empty;
    private string searchTermDate = string.Empty;


    private PaginationDto<LegalCase> searchResults;
    private int currentPage = 1;
    private int pageSize = 10;
    private string searchTerm = "";

    // private string selectedClient = string.Empty;
    // private string _previousClientText = string.Empty;
    // private Guid? selectedClientId = null;
    // private bool clientSuggestionsChecked = false;
    // private List<EditToClientDto> clientSuggestions = new List<EditToClientDto>();

    private string selectedReasonholdover = string.Empty;
    private bool reasonholdoverSuggestionsChecked = false;
    private List<string> reasonholdoverSuggestions = new List<string>();

    // private string selectedTenant = string.Empty;
    // private bool tenantSuggestionsChecked = false;
    // private List<EditToTenantDto> tenantSuggestions = new List<EditToTenantDto>();

    // private string selectedCase = string.Empty;
    // private bool caseSuggestionsChecked = false;
    // private List<CreateToEditLegalCaseModel> caseSuggestions = new List<CreateToEditLegalCaseModel>();

    // private string selectedLandlord = string.Empty;
    // private bool landlordSuggestionsChecked = false;
    // private List<EditToLandlordDto> landlordSuggestions = new List<EditToLandlordDto>();

    private List<List<LegalCase>> legalcaseDto = new();
    private List<LegalCase> TodaylegalcaseDto = new();

    private int ActiveIndex = 0;
    private int totalCases = 0;
    private int totalRemainder = 0;
    private int totalCasesHearing = 0;
    private int activeCases = 0;
    private bool IsPrevDisabled => ActiveIndex == 0;
    private bool IsNextDisabled => ActiveIndex == legalcaseDto.Count - 1;
    private string? loggedInUserId;
    private bool isAdmin = false;
    private bool isAuth = false;
    private CancellationTokenSource _cts;
    private string successMessage;
    private string? loginUser { get; set; }
    private List<EditToClientDto> ClientList = new();
    private List<EditToClientDto> filteredClients = new();
    private List<EditToRemainderCenterDto> InCompleteRemainder = new();
    private List<IGrouping<string?, EditToRemainderCenterDto>> groupedRemainder = new();
    private LoggedInUser? identityUser;

    // INPUT (typing only)
    private string clientInput = "";
    private string landlordInput = "";
    private string tenantInput = "";
    private string caseInput = "";

    // SELECTED ENTITIES
    private EditToClientDto selectedClient;
    private EditToLandlordDto selectedLandlord;
    private EditToTenantDto selectedTenant;
    private CreateToEditLegalCaseModel selectedCase;

    // SUGGESTIONS
    private List<EditToClientDto> clientSuggestions = new();
    private List<EditToLandlordDto> landlordSuggestions = new();
    private List<EditToTenantDto> tenantSuggestions = new();
    private List<CreateToEditLegalCaseModel> caseSuggestions = new();

    private bool clientSuggestionsChecked;
    private bool landlordSuggestionsChecked;
    private bool tenantSuggestionsChecked;
    private bool caseSuggestionsChecked;


    protected override async Task OnInitializedAsync()
    {
        spinnerservice.Show();
        var loggedInUser = await _loggedInUserService.GetAsync();
        if (loggedInUser==null || !loggedInUser.IsAuthenticated)
        {
            navManager.NavigateTo("/", forceLoad: true);
            return;
        }
        this.identityUser = loggedInUser;
        var uri = new Uri(navManager.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);
        if (query != null && query.Any())
        {
            if (query.TryGetValue("success", out var isSuccess) && isSuccess == "true")
            {
                successMessage = "Case Added successfully!";
                await Task.Delay(1000);
                successMessage = string.Empty;

                navManager.NavigateTo("dashboard", forceLoad: true);
            }
            else if (query.TryGetValue("edit", out var isEdit) && isEdit == "true")
            {
                successMessage = "Case updated successfully!";
                StateHasChanged();

                await Task.Delay(2000);
                successMessage = string.Empty;
                StateHasChanged();

                navManager.NavigateTo("/dashboard", forceLoad: false);
            }
        }

        totalCases = await _service.GetTotalCasesCountAsync(loggedInUser.FirmId??string.Empty, loggedInUser.IsSuperAdmin);
        totalCasesHearing = await _caseService.GetAllTodayCaseHearingAsync(loggedInUser.FirmId ?? string.Empty, loggedInUser.IsSuperAdmin);
        //activeCases = await _service.GetActiveCasesCountAsync(loggedInUser.UserId ?? string.Empty, loggedInUser.IsSuperAdmin);
        pipelineData = await _service.GetPipelineChartItems(loggedInUser.FirmId ?? string.Empty, loggedInUser.IsSuperAdmin);

        InCompleteRemainder = await _remainder.GetAllInCompleteRemainder(identityUser.IsSuperAdmin, Guid.Parse(loggedInUser.UserId??string.Empty));

        groupedRemainder = InCompleteRemainder.GroupBy(e => e.CaseCode).ToList();
        if (groupedRemainder.Any())
            showCaseModal = true;
        totalRemainder = InCompleteRemainder.Count();
        spinnerservice.Hide();
    }
    private async Task ChangePage(int page)
    {
        if (page >= 1 && page <= Math.Ceiling((double)searchResults.TotalCount / pageSize))
        {
            currentPage = page;
            await Search();
        }
    }


    // private async Task OnClientFocus()
    // {

    //     if (string.IsNullOrWhiteSpace(selectedClient))
    //     {
    //         clientSuggestions = await DashBoardRepository.GetTopClients();
    //         clientSuggestionsChecked = true;
    //     }
    // }

    // private async Task OnCaseFocus()
    // {

    //     if (string.IsNullOrWhiteSpace(selectedCase))
    //     {
    //         caseSuggestions = await DashBoardRepository.GetTopCases();
    //         caseSuggestionsChecked = true;
    //     }
    // }

    // private async Task OnLandlordsFocus()
    // {

    //     if (string.IsNullOrEmpty(selectedLandlord))
    //     {
    //         landlordSuggestions = await DashBoardRepository.GetTopLandlords();
    //         landlordSuggestionsChecked = true;
    //     }

    // }
    // private async Task OnTenantsFocus()
    // {

    //     if (string.IsNullOrWhiteSpace(selectedTenant))
    //     {
    //         tenantSuggestions = await DashBoardRepository.GetTopTenants();
    //         tenantSuggestionsChecked = true;
    //     }
    // }

    private async Task Search()
    {

        if (string.IsNullOrWhiteSpace(caseInput) &&
            string.IsNullOrWhiteSpace(clientInput) &&
            string.IsNullOrWhiteSpace(tenantInput) &&
            string.IsNullOrWhiteSpace(landlordInput) &&
            string.IsNullOrWhiteSpace(selectedReasonholdover) &&
            string.IsNullOrWhiteSpace(searchTermDate) &&
            string.IsNullOrWhiteSpace(searchTermStatus))
        {

            searchResults = null;
            isSearched = true;

            spinnerservice.Hide();

            return;
        }

        spinnerservice.Show();
        isSearched = true;
        string url = "/legalcases/search";
        List<string> queryParams = new();

        if (!string.IsNullOrWhiteSpace(caseInput))
            queryParams.Add($"cases={caseInput}");

        if (!string.IsNullOrWhiteSpace(clientInput))
            queryParams.Add($"client={clientInput}");

        if (!string.IsNullOrWhiteSpace(tenantInput))
            queryParams.Add($"tenant={tenantInput}");

        if (!string.IsNullOrWhiteSpace(landlordInput))
            queryParams.Add($"landlord={landlordInput}");

        // Append query string only if we have filters
        if (queryParams.Any())
            url += "?" + string.Join("&", queryParams);

        navManager.NavigateTo(url);

        // var filters = new CaseFilterDto
        // {
        //     CaseCode = selectedCase,
        //     Client = selectedClient,
        //     Tenant = selectedTenant,
        //     LandLord = selectedLandlord,
        //     ReasonHoldover = selectedReasonholdover,
        //     ActionDate = searchTermDate,
        //     Status = searchTermStatus
        // };
        // searchResults = await DashBoardRepository.Search(currentPage, pageSize, filters);

        // selectedClient = string.Empty;
        // selectedCase = string.Empty;
        // selectedTenant = string.Empty;
        // selectedLandlord = string.Empty;
        // selectedReasonholdover = string.Empty;
        // searchTermDate = string.Empty;
        // searchTermStatus = string.Empty;

        // spinnerservice.Hide();
    }

    // private async Task OnClientInput(ChangeEventArgs e)
    // {
    //     selectedClient = e.Value?.ToString();
    //       _cts?.Cancel();
    //     _cts = new CancellationTokenSource();
    //     try
    //     {
    //          await Task.Delay(300, _cts.Token);
    //     if (!string.IsNullOrWhiteSpace(selectedClient))
    //     {
    //         clientSuggestions = await DashBoardRepository.GetClientSuggestions(selectedClient);
    //         clientSuggestionsChecked = true;
    //     }
    //     else
    //     {
    //         clientSuggestions = new List<EditToClientDto>();
    //         clientSuggestionsChecked = false;
    //     }
    // }catch (TaskCanceledException)
    //     {

    //     }
    // }

    // private async Task OnClientInput(ChangeEventArgs e)
    // {
    //     var newValue = e.Value?.ToString() ?? string.Empty;

    //     bool isDeleting = newValue.Length < _previousClientText.Length;
    //     bool isAdding = newValue.Length > _previousClientText.Length;

    //     selectedClient = newValue;

    //     _previousClientText = newValue;

    //     _cts?.Cancel();
    //     _cts = new CancellationTokenSource();

    //     try
    //     {
    //         await Task.Delay(300, _cts.Token);

    //         if (!string.IsNullOrWhiteSpace(selectedClient))
    //         {
    //             clientSuggestions =
    //                 await DashBoardRepository.GetClientSuggestions(selectedClient);
    //             clientSuggestionsChecked = true;
    //         }
    //         else
    //         {
    //             clientSuggestions =
    //                 await DashBoardRepository.GetTopClients();
    //             clientSuggestionsChecked = true;
    //         }
    //     }
    //     catch (TaskCanceledException)
    //     {
    //         // ignore
    //     }
    // }


    // private async Task OnTenantInput(ChangeEventArgs e)
    // {
    //     selectedTenant = e.Value?.ToString();
    //     _cts?.Cancel();
    //     _cts = new CancellationTokenSource();
    //     try
    //     {
    //         await Task.Delay(300, _cts.Token);
    //         if (!string.IsNullOrWhiteSpace(selectedTenant))
    //         {
    //             tenantSuggestions = await DashBoardRepository.GetTenantSuggestions(selectedTenant);
    //             tenantSuggestionsChecked = true;
    //         }
    //         else
    //         {
    //             tenantSuggestions = new List<EditToTenantDto>();
    //             tenantSuggestionsChecked = false;
    //         }
    //     }
    //     catch (TaskCanceledException)
    //     {

    //     }
    // }

    // private async Task OnCaseInput(ChangeEventArgs e)
    // {
    //     selectedCase = e.Value?.ToString();
    //     _cts?.Cancel();
    //     _cts = new CancellationTokenSource();
    //     try
    //     {
    //         await Task.Delay(300, _cts.Token);

    //         if (!string.IsNullOrWhiteSpace(selectedCase))
    //         {
    //             caseSuggestions = await DashBoardRepository.GetCaseSuggestions(selectedCase);
    //             caseSuggestionsChecked = true;
    //         }
    //         else
    //         {
    //             caseSuggestions = new List<CreateToEditLegalCaseModel>();
    //             caseSuggestionsChecked = false;
    //         }
    //     }
    //     catch (TaskCanceledException)
    //     {

    //     }
    // }

    // private async Task OnLandlordInput(ChangeEventArgs e)
    // {
    //     selectedLandlord = e.Value?.ToString();
    //     _cts?.Cancel();
    //     _cts = new CancellationTokenSource();
    //     try
    //     {
    //         await Task.Delay(300, _cts.Token);

    //         if (!string.IsNullOrWhiteSpace(selectedLandlord))
    //         {
    //             landlordSuggestions = await DashBoardRepository.GetLandlordSuggestions(selectedLandlord);
    //             landlordSuggestionsChecked = true;
    //         }
    //         else
    //         {
    //             landlordSuggestions = new List<EditToLandlordDto>();
    //             landlordSuggestionsChecked = false;
    //         }
    //     }
    //     catch (TaskCanceledException)
    //     {

    //     }
    // }

    // private void SelectClient(EditToClientDto client)
    // {
    //     selectedClient = $"{client.FirstName} {client.LastName}";
    //     clientSuggestions.Clear();
    //     clientSuggestionsChecked = false;
    // }

    // private async Task FocusOutClient()
    // {
    //     await Task.Delay(500);
    //     clientSuggestions.Clear();
    //     clientSuggestionsChecked = false;
    // }

    // private void Selectlandlord(EditToLandlordDto landlord)
    // {
    //     selectedLandlord = $"{landlord.FirstName} {landlord.LastName}";
    //     landlordSuggestions.Clear();
    //     landlordSuggestionsChecked = false;
    // }
    // private async Task FocusOutLandlord()
    // {
    //     await Task.Delay(500);
    //     landlordSuggestions.Clear();
    //     landlordSuggestionsChecked = false;
    // }
    // private void SelectTenant(EditToTenantDto tenant)
    // {
    //     selectedTenant = $"{tenant.FirstName} {tenant.LastName}"; ;
    //     tenantSuggestions.Clear();
    //     tenantSuggestionsChecked = false;
    // }
    // private async Task FocusOutTenant()
    // {
    //     await Task.Delay(500);
    //     tenantSuggestions.Clear();
    //     tenantSuggestionsChecked = false;
    // }

    // private void SelectCase(CreateToEditLegalCaseModel cases)
    // {
    //     selectedCase = cases?.Casecode;
    //     caseSuggestions.Clear();
    //     caseSuggestionsChecked = false;
    // }
    // private async Task FocusOutCase()
    // {
    //     await Task.Delay(500);
    //     caseSuggestions.Clear();
    //     caseSuggestionsChecked = false;
    // }

    // private void Resetsearch()
    // {
    //     selectedClient = string.Empty;
    //     selectedCase = string.Empty;
    //     selectedTenant = string.Empty;
    //     selectedLandlord = string.Empty;
    //     selectedReasonholdover = string.Empty;
    //     searchTermDate = string.Empty;
    //     searchTermStatus = string.Empty;

    //     searchResults = null;

    // }

    int columnWidth = 15; // default desktop width

    void OnMediaQueryChange(bool matches)
    {
        // matches == true means screen <= 768px
        columnWidth = matches ? 6 : 15;
        StateHasChanged();
    }

    public class CalendarDay
    {
        public DateTime Date { get; set; }
        public int Intensity { get; set; } // 0 se 4 tak
    }

    List<CalendarDay> calendarData = new();

    protected override void OnInitialized()
    {
        var startDate = new DateTime(2025, 9, 1);
        var endDate = new DateTime(2025, 9, 30);
        // Yahan apne data ke hisaab se Intensity assign kar sakte hain
        int[] intensities = new int[]
        {
            0,0,3,0,2,4,4,3,3,2,
            4,1,0,0,2,0,0,0,2,4,
            4,0,1,0,0,4,4,3,4,1,
            4,3,4,4,4,4,4,2,3,0,
            4,4,4,3,3,2,0,1,0,0,
        };

        var idx = 0;
        for (var date = startDate; date <= endDate; date = date.AddDays(1))
        {
            calendarData.Add(new CalendarDay
            {
                Date = date,
                Intensity = intensities[idx]
            });
            idx++;
        }
    }

    string GetColor(int intensity)
    {
        return intensity switch
        {
            0 => "#E0E0E0",    // Light grey (no activity)
            1 => "#A9BBD9",    // Light blue
            2 => "#7B8DC6",    // Medium blue
            3 => "#324B87",    // Dark blue
            4 => "#061D4A",    // Very dark blue (almost navy)
            _ => "#FFFFFF"
        };
    }
    private bool showCaseModal = false;
    private bool showReminderModal = false;
    private IGrouping<string?, EditToRemainderCenterDto>? selectedGroup;

    private void OpenReminderPopup(IGrouping<string?, EditToRemainderCenterDto> group)
    {
        selectedGroup = group;
        showCaseModal = false;
        showReminderModal = true;
    }


    private void CloseReminderPopup()
    {
        showReminderModal = false;
        showCaseModal = true;
    }

    void NavigateToCase(Guid? caseId)
    {
        if (caseId.HasValue)
        {
            navManager.NavigateTo($"/legalcase/details/{caseId.Value}");
        }
    }

    class DataItem
    {
        public string Month { get; set; }
        public double NonPayment { get; set; }
        public double Holdover { get; set; }
        public double Other { get; set; }
    }

    public List<PipeLineChartItem> pipelineData = new List<PipeLineChartItem>();


    class DataFinacial
    {
        public string Month { get; set; }
        public double Collected { get; set; }
        public double Billed { get; set; }

    }


    List<DataFinacial> financialData = new List<DataFinacial>()
                                        {
                                        new DataFinacial(){Month="Jan",Collected=50, Billed=30},
                                        new DataFinacial(){Month="Feb",Collected=100, Billed=60},
                                        new DataFinacial(){Month="Mar",Collected=70, Billed=95},
                                        new DataFinacial(){Month="Apr",Collected=60, Billed=75},
                                        new DataFinacial(){Month="May",Collected=120, Billed=85},
                                        };



    bool annotation = false;

    class Datatask
    {
        public string Date { get; set; }
        public int task { get; set; }
    }

    Datatask[] revenue2024 = new Datatask[] {
                                        new Datatask
                                        {
                                        Date = "Jan",
                                        task = 234000
                                        },
                                        new Datatask
                                        {
                                        Date = "Feb",
                                        task = 269000
                                        },
                                        new Datatask
                                        {
                                        Date = "Mar",
                                        task = 233000
                                        },
                                        new Datatask
                                        {
                                        Date = "Apr",
                                        task = 244000
                                        },
                                        new Datatask
                                        {
                                        Date = "May",
                                        task = 214000
                                        },
                                        new Datatask
                                        {
                                        Date = "Jun",
                                        task = 253000
                                        },
                                        new Datatask
                                        {
                                        Date = "Jul",
                                        task = 274000
                                        },
                                        new Datatask
                                        {
                                        Date = "Aug",
                                        task = 284000
                                        },
                                        new Datatask
                                        {
                                        Date = "Sept",
                                        task = 273000
                                        },
                                        new Datatask
                                        {
                                        Date = "Oct",
                                        task = 282000
                                        },
                                        new Datatask
                                        {
                                        Date = "Nov",
                                        task = 289000
                                        },
                                        new Datatask
                                        {
                                        Date = "Dec",
                                        task = 294000
                                        }
                                    };


    private void ResetLandlordSection()
    {
        selectedLandlord = null;
        landlordInput = "";
        landlordSuggestions.Clear();
        landlordSuggestionsChecked = false;

        ResetTenantSection();
    }

    private void ResetTenantSection()
    {
        selectedTenant = null;
        tenantInput = "";
        tenantSuggestions.Clear();
        tenantSuggestionsChecked = false;

        ResetCaseSection();
    }

    private void ResetCaseSection()
    {
        selectedCase = null;
        caseInput = "";
        caseSuggestions.Clear();
        caseSuggestionsChecked = false;
    }

    private async Task OnClientInput(ChangeEventArgs e)
    {
        clientInput = e.Value?.ToString() ?? "";

        selectedClient = null;              // typing breaks selection
        ResetLandlordSection();             // clear dependent sections

        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {
            await Task.Delay(300, _cts.Token);

            if (!string.IsNullOrWhiteSpace(clientInput))
            {
                clientSuggestions = await DashBoardRepository.GetClientSuggestions(clientInput);
                clientSuggestionsChecked = true;
            }
            else
            {
                clientSuggestions.Clear();
                clientSuggestionsChecked = false;
            }
        }
        catch { }
    }
    private async Task OnClientFocus()
    {
        if (string.IsNullOrWhiteSpace(clientInput))
        {
            clientSuggestions = await DashBoardRepository.GetTopClients();
            clientSuggestionsChecked = true;
        }
    }

    private async Task OnClientFocusOut()
    {
        await Task.Delay(500);
        if (selectedClient == null)
            clientInput = "";      // clear because nothing is selected

        clientSuggestions.Clear();
        clientSuggestionsChecked = false;
    }

    private async Task SelectClient(EditToClientDto client)
    {
        selectedClient = client;
        clientInput = $"{client.FirstName} {client.LastName}";

        clientSuggestions.Clear();
        clientSuggestionsChecked = false;

        ResetLandlordSection(); // wipe dependent hierarchy
    }

    private async Task OnLandlordInput(ChangeEventArgs e)
    {
        landlordInput = e.Value?.ToString() ?? "";
        selectedLandlord = null;
        ResetTenantSection();

        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {
            await Task.Delay(300, _cts.Token);

            if (!string.IsNullOrWhiteSpace(landlordInput))
            {
                landlordSuggestions = await DashBoardRepository
                    .GetLandlordSuggestions(landlordInput, selectedClient?.Id);
                landlordSuggestionsChecked = true;
            }
            else
            {
                landlordSuggestions.Clear();
                landlordSuggestionsChecked = false;
            }
        }
        catch { }
    }

    private async Task OnLandlordFocus()
    {
        if (string.IsNullOrWhiteSpace(landlordInput))
        {
            landlordSuggestions = await DashBoardRepository
                .GetTopLandlords(selectedClient?.Id);

            landlordSuggestionsChecked = true;
        }
    }

    private async Task OnLandlordFocusOut()
    {
        await Task.Delay(500);

        if (selectedLandlord == null)
            landlordInput = "";

        landlordSuggestions.Clear();
        landlordSuggestionsChecked = false;
    }

    private void SelectLandlord(EditToLandlordDto landlord)
    {
        selectedLandlord = landlord;
        landlordInput = $"{landlord.FirstName} {landlord.LastName}";

        landlordSuggestions.Clear();
        landlordSuggestionsChecked = false;

        ResetTenantSection();
    }

    private async Task OnTenantInput(ChangeEventArgs e)
    {
        tenantInput = e.Value?.ToString() ?? "";
        selectedTenant = null;
        ResetCaseSection();

        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {
            await Task.Delay(300, _cts.Token);

            if (!string.IsNullOrWhiteSpace(tenantInput))
            {
                tenantSuggestions = await DashBoardRepository
                    .GetTenantSuggestions(tenantInput, selectedClient?.Id, selectedLandlord?.Id);

                tenantSuggestionsChecked = true;
            }
            else
            {
                tenantSuggestions.Clear();
                tenantSuggestionsChecked = false;
            }
        }
        catch { }
    }

    private async Task OnTenantFocus()
    {
        if (string.IsNullOrWhiteSpace(tenantInput))
        {
            tenantSuggestions = await DashBoardRepository
                .GetTopTenants(selectedClient?.Id, selectedLandlord?.Id);

            tenantSuggestionsChecked = true;
        }
    }

    private async Task OnTenantFocusOut()
    {
        await Task.Delay(500);

        if (selectedTenant == null)
            tenantInput = "";

        tenantSuggestions.Clear();
        tenantSuggestionsChecked = false;
    }

    private void SelectTenant(EditToTenantDto tenant)
    {
        selectedTenant = tenant;
        tenantInput = $"{tenant.FirstName} {tenant.LastName}";

        tenantSuggestions.Clear();
        tenantSuggestionsChecked = false;

        ResetCaseSection();
    }

    private async Task OnCaseInput(ChangeEventArgs e)
    {
        caseInput = e.Value?.ToString() ?? "";
        selectedCase = null;

        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {
            await Task.Delay(300, _cts.Token);

            if (!string.IsNullOrWhiteSpace(caseInput))
            {
                caseSuggestions = await DashBoardRepository
                    .GetCaseSuggestions(caseInput, selectedClient?.Id, selectedLandlord?.Id, selectedTenant?.Id);

                caseSuggestionsChecked = true;
            }
            else
            {
                caseSuggestions.Clear();
                caseSuggestionsChecked = false;
            }
        }
        catch { }
    }

    private async Task OnCaseFocus()
    {
        if (string.IsNullOrWhiteSpace(caseInput))
        {
            caseSuggestions = await DashBoardRepository
                .GetTopCases(selectedClient?.Id, selectedLandlord?.Id, selectedTenant?.Id);

            caseSuggestionsChecked = true;
        }
    }

    private async Task OnCaseFocusOut()
    {
        await Task.Delay(500);
        if (selectedCase == null)
            caseInput = "";

        caseSuggestions.Clear();
        caseSuggestionsChecked = false;
    }

    private void SelectCase(CreateToEditLegalCaseModel cases)
    {
        selectedCase = cases;
        caseInput = cases.Casecode;

        caseSuggestions.Clear();
        caseSuggestionsChecked = false;
    }
}