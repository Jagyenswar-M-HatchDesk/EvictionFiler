@page "/legalcase/create-perdiem"



@using System.ComponentModel.DataAnnotations
@using System.Linq.Expressions
@using EvictionFiler.Application.DTOs
@using EvictionFiler.Application.DTOs.ApartmentDto
@using EvictionFiler.Application.DTOs.ClientDto
@using EvictionFiler.Application.DTOs.LandLordDto
@using EvictionFiler.Application.DTOs.LegalCaseDto
@using EvictionFiler.Application.DTOs.OccupantDto
@using EvictionFiler.Application.DTOs.PaginationDto
@using EvictionFiler.Application.DTOs.TenantDto
@using EvictionFiler.Application.Interfaces.IRepository.MasterRepository
@using EvictionFiler.Application.Interfaces.IServices
@using EvictionFiler.Application.Services
@using EvictionFiler.Client.Components.Cases
@using EvictionFiler.Client.Jwt
@using EvictionFiler.Domain.Entities.Master
@using Blazored.Typeahead

@inject IClientRoleRepository ClientRoleRepository
@inject ICaseTypeRepository CaseTypeRepository
@inject ICaseSubTypeRepository CaseSubTypeRepository
@inject IRegulationStatusRepository RegulationStatusRepository
@inject IReasonHoldoverRepository ReasonHoldoverRepository
@inject ILandlordTypeRepository LandlordTypeRepository
@inject IRenewalStatusRepository RenewalStatusRepository
@inject IUnitIllegalRepository UnitIllegalRepository
@inject ITenancyTypeRepository TenancyTypeRepository
@inject IDateRentRepository DateRentRepository
@inject ILandlordSevice _landlordService
@inject IBuildingService _buildingService
@inject ILegalCaseService _legalCaseService
@inject ITenantService _tenantService
@inject IClientService _clientService
@inject ICaseProgramRepository _caseprogram
@inject IAdditionalTenantService _additionalTenant
@inject IAdditionalOccupantsService _additionalOccupant
@inject IStateRepository _stateRepository

@using EvictionFiler.Client.SpinnerService
@using EvictionFiler.Domian.Enums
@inject IJSRuntime JS
@inject NavigationManager nav
@inject SpinnerService spinnerservice

@using Microsoft.AspNetCore.Components.Authorization;
@using EvictionFiler.Domain.Entities

@using System.Security.Claims
@inject JwtAuthStateProviders _authStateProvider

<HeadContent>

</HeadContent>

<style>
    .required-label::after { content: " *"; color: red; }

    :root { --bg: #f7f9fc; --card: #ffffff; --ink: #0f172a; --muted: #64748b; --line: #e2e8f0; --brand: #4f46e5; --brand-2: #4338ca; --ok: #059669; --warn: #b45309; --danger: #b91c1c; --radius: 16px; --shadow: 0 6px 24px rgba(2, 6, 23, .08); }

    * { box-sizing: border-box }

    html,
    body { height: 100% }

    body { margin: 0; font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; background: radial-gradient(70% 120% at 50% -10%, #eef2ff 0%, var(--bg) 60%); color: var(--ink) }

    .wrap { max-width: 1200px; margin: auto; padding: 24px }

    header.top { position: sticky; top: 0; z-index: 10; background: rgba(255, 255, 255, .9); backdrop-filter: saturate(180%) blur(6px); border-bottom: 1px solid var(--line) }

        header.top .bar { display: flex; align-items: center; justify-content: space-between; padding: 12px 24px; max-width: 1200px; margin: auto }

    .brand { display: flex; gap: 12px; align-items: center }

    .logo { width: 40px; height: 40px; border-radius: 14px; background: #0f172a; color: #fff; display: grid; place-items: center; font-weight: 700 }

    .secure { display: inline-flex; gap: 8px; align-items: center; border-radius: 999px; padding: 6px 10px; border: 1px solid #d1fae5; background: #ecfdf5; color: #065f46; font-size: 12px }

    .stepper { padding: 0 24px 14px; max-width: 1200px; margin: auto }

    .track { height: 6px; background: #e5e7eb; border-radius: 999px; overflow: hidden }

    .meter { height: 100%; background: linear-gradient(90deg, var(--brand), var(--brand-2)); width: 40% }

    .steps { display: flex; gap: 12px; flex-wrap: wrap; margin: 8px 0 }

    .btn-tenant:hover { background: #1F365D !important; }

    .chip { display: flex; gap: 8px; align-items: center; color: #475569 }

    .dot { width: 10px; height: 10px; border-radius: 999px; background: #cbd5e1 }

        .dot.active { background: #818cf8 }

        .dot.done { background: #4f46e5 }

    .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px }

    @@media (max-width:1024px) {
        .grid { grid-template-columns: 1fr }
    }

    .card { background: var(--card); border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow) }

        .card > header { padding: 18px 20px; border-bottom: 1px solid var(--line); display: flex; gap: 12px; align-items: flex-start }

    .k { width: 28px; height: 28px; border-radius: 12px; background: #0f172a; color: #fff; display: grid; place-items: center; font-size: 12px; font-weight: 700 }

    .card .body { padding: 20px }

    .fields { display: grid; gap: 16px }

    .cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)) }

    .cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)) }

    @@media (max-width:820px) {
        .cols-2, .cols-3 { grid-template-columns: 1fr }
    }

    label.lbl { display: block; font-size: 12px; text-transform: uppercase; letter-spacing: .04em; font-weight: 700; color: #475569; margin-bottom: 6px }

    input.txt,
    select.sel { width: 100%; padding: 12px 14px; border: 1px solid #cbd5e1; border-radius: 12px; background: #fff; color: #0f172a; outline: none }

        input.txt:focus,
        select.sel:focus { border-color: #6366f1; box-shadow: 0 0 0 6px #eef2ff }

    .hint { font-size: 12px; color: #64748b; margin-top: 4px }

    .pill { display: inline-block; padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 12px; background: #fff; font-size: 13px }

    .aside.card { position: sticky; top: 106px; height: fit-content }

    .kv { display: flex; justify-content: space-between; gap: 12px }

        .kv .k { background: none; color: #64748b; width: auto; height: auto; border-radius: 0; font-weight: 600 }

    .actions { position: sticky; bottom: 0; z-index: 10; background: rgba(255, 255, 255, .9); border-top: 1px solid var(--line) }

        .actions .row { max-width: 1200px; margin: auto; padding: 12px 24px; display: flex; justify-content: space-between; align-items: center }

    .btn { padding: 10px 16px; border-radius: 12px; border: 1px solid #cbd5e1; background: #fff; color: #0f172a }

        .btn.primary { background: var(--brand); border-color: transparent; color: #fff }

        .btn.danger { background: #fee2e2; border-color: #fecaca; color: #991b1b }

    .list { display: flex; flex-direction: column; gap: 8px }

        .list .row { display: flex; gap: 8px }

    .iconbtn { border: 1px solid #cbd5e1; background: #fff; border-radius: 10px; padding: 8px 10px; cursor: pointer }

    .pre { white-space: pre-wrap; background: #0b1020; color: #e2e8f0; border-radius: 12px; padding: 14px; overflow: auto; max-height: 360px }

    @@media (max-width:560px) {
        .logo { width: 36px; height: 36px }

        .brand h1 { font-size: 16px }

        .secure { display: none }
    }

    .form-check-input { cursor: pointer; }
</style>


<div class="container-fluid py-3 border-bottom bg-white sticky-top">
    <div class="d-flex justify-content-between align-items-center">

        <div class="d-flex align-items-center" style="gap:30px">
            @for (var i = 0; i < Steps.Count; i++)
            {
                var bgColor = i <= (int)CurrentStep ? "#1F365D" : "#6c757d";

                <div class="d-flex align-items-center gap-2">
                    <span class="rounded-circle d-inline-block"
                          style="width:14px; height:14px; border: 1px solid #333; background-color:@bgColor;"></span>
                    <span>@Steps[i]</span>
                </div>
            }
        </div>


    </div>
    <div class="progress mt-3" style="height:6px;">
        <div class="progress-bar" role="progressbar" style="width:@Progress% ;  background-color:#1F365D !important"></div>
    </div>
</div>

<div class="container my-4">
    @*  <EditForm > *@
    @if (CurrentStep == StepPerdiem.Attorney)
    {

        <div class="row">
            <!-- Left side: Attorney Assigning Case -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                        Attorney Assigning Case
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <!-- Hiring Attorney / Firm -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Hiring Attorney / Firm <span class="text-danger">*</span></label>
                                <input type="text" name="hiringFirm" class="form-control" required />
                                <div class="invalid-feedback">
                                    Please enter the hiring firm.
                                </div>
                            </div>

                            <!-- Contact Person -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Contact Person</label>
                                <input type="text" name="contactPerson" class="form-control" />
                            </div>

                            <!-- Phone / Email -->
                            <div class="col-md-12">
                                <label class="form-label fw-semibold">Phone / Email</label>
                                <input type="text" name="contactPhoneEmail" class="form-control" placeholder="(555) 555-5555 / name@example.com" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right side summary -->
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>


    }


    @if (CurrentStep == StepPerdiem.Case)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                        Case Information
                    </div>

                    <div class="card-body">
                        <!-- Case Type -->
                        <div class="row">
                            <div class="col-12">
                            </div><label class="form-label fw-semibold">Case Type <span class="text-danger">*</span></label>
                        </div>
                        <div class="row mt-1">
                            <div class="col-4">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="caseType1" name="caseType" value="Residential Holdover">
                                    <label class="form-check-label" for="caseType1">Residential Holdover</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="caseType2" name="caseType" value="Residential Nonpayment">
                                    <label class="form-check-label" for="caseType2">Residential Nonpayment</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="caseTypeOtherCb" value="HPD/Code Enforcement">
                                    <label class="form-check-label" for="caseTypeOtherCb">HPD/Code Enforcement</label>
                                </div>
                            </div>

                        </div>
                        <div class="row mt-1">
                            <div class="col-3">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="caseType1" name="caseType" value="Commercial Case">
                                    <label class="form-check-label" for="caseType1">Commercial Case</label>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="caseType2" name="caseType" value="Illegal Lockout">
                                    <label class="form-check-label" for="caseType2">Illegal Lockout</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="caseTypeOtherCb">
                                    <label class="form-check-label" for="caseTypeOtherCb">
                                        Post‑Eviction / Restoration
                                    </label>
                                </div>
                            </div>
                            <div class="col-2">
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="caseTypeOtherCb">
                                    <label class="form-check-label" for="caseTypeOtherCb">Other</label>
                                </div>
                            </div>

                        </div>
                        <!-- Case Details -->
                        <div class="row g-3 mt-2">

                            <!-- Court Location -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Court Location (Borough) <span class="text-danger">*</span></label>
                                <input type="text" name="courtLocation" class="form-control" required />
                                <div class="invalid-feedback">Enter borough.</div>
                            </div>

                            <!-- Part / Room # -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Part / Room #</label>
                                <input type="text" name="partRoom" class="form-control" />
                            </div>

                            <!-- Index / LT Docket # -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Index / LT Docket #</label>
                                <input type="text" name="docket" class="form-control" />
                            </div>

                            <!-- County / Borough -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">County / Borough <span class="text-danger">*</span></label>
                                <input type="text" name="county" class="form-control" required />
                                <div class="invalid-feedback">Enter county/borough.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right side summary -->
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    @if (CurrentStep == StepPerdiem.Party)
    {

        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                        Party Representation
                    </div>

                    <div class="card-body">
                        <!-- Representing -->
                        <div class="row">
                            <div class="col-12">
                                <label class="form-label fw-semibold">
                                    Representing <span class="text-danger">*</span>
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="repPetitioner" name="representing" value="Petitioner" required>
                                    <label class="form-check-label" for="repPetitioner">
                                        Petitioner (Tenant/Occupant)
                                    </label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="repRespondent" name="representing" value="Respondent">
                                    <label class="form-check-label" for="repRespondent">
                                        Respondent (Landlord/Owner/Managing Agent)
                                    </label>
                                </div>
                            </div>

                        </div>

                        <!-- Party Details -->
                        <div class="row g-3">
                            <!-- Petitioner / Tenant Names -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Petitioner / Tenant Name(s) <span class="text-danger">*</span></label>
                                <input type="text" name="petitionerNames" class="form-control" required />
                                <div class="invalid-feedback">Party Name(s).</div>
                            </div>

   
                            <!-- Opposing Counsel -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Opposing Counsel (if any)</label>
                                <input type="text" name="opposingCounsel" class="form-control" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }
  
    
    @if (CurrentStep == StepPerdiem.Appearance)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                        Appearance Details
                    </div>

                    <div class="card-body">
                        <!-- Date & Time -->
                        <div class="row g-3 mb-4">
                            <!-- Date of Appearance -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">
                                    Date of Appearance <span class="text-danger">*</span>
                                </label>
                                <input type="date" name="appearanceDate" class="form-control" required />
                                <div class="invalid-feedback">Select a date.</div>
                            </div>

                            <!-- Time of Appearance -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">
                                    Time of Appearance <span class="text-danger">*</span>
                                </label>
                                <input type="time" name="appearanceTime" class="form-control" required />
                                <div class="invalid-feedback">Select a time.</div>
                            </div>
                        </div>

                        <!-- Type of Appearance -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">
                                Type of Appearance <span class="text-danger">*</span>
                            </label>

                            <div id="appearanceTypeGroup">
                                <!-- Checkboxes -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="appt1" name="appearanceType" value="First Appearance / Intake">
                                    <label class="form-check-label" for="appt1">First Appearance / Intake</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="appt2" name="appearanceType" value="Trial / Hearing">
                                    <label class="form-check-label" for="appt2">Trial / Hearing</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="appt3" name="appearanceType" value="Motion / OSC Return Date">
                                    <label class="form-check-label" for="appt3">Motion / OSC Return Date</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="appt4" name="appearanceType" value="Adjournment / Stipulation">
                                    <label class="form-check-label" for="appt4">Adjournment / Stipulation</label>
                                </div>

                                <!-- Other Option -->
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="apptOtherCb">
                                    <label class="form-check-label" for="apptOtherCb">Other</label>
                                </div>

                                <input type="text" id="apptOther" class="form-control mt-2 ms-4" placeholder="Specify other" style="display:none;" />
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-12">
                                <label>Relief / Action Requested Today</label>
                            </div>
                            <div class="col-12">
                                <textarea name="relief" rows="3" style="width:100%"></textarea>
                            </div>
                            
                          
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    @if (CurrentStep == StepPerdiem.CaseBackground)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                        Case Background (Brief)
                    </div>

                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Petitioner / Tenant -->
                            <div class="col-md-12">
                                <label class="req fw-bold">Key Facts to Know (bullet points)</label>
                            </div>
                            <div class="col-md-12">
                                    <textarea name="keyFacts" rows="4" style="width:100%"  placeholder="• Fact 1 • Fact 2 • Fact 3" required></textarea>
                            </div>

                          
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    @if (CurrentStep == StepPerdiem.DocumentIntractions)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold">
                        Documents & Instructions
                    </div>

                    <div class="card-body">
                        <!-- Documents Provided -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Documents Provided <span class="text-danger">*</span></label>

                            <div class="d-flex flex-wrap gap-3" id="docsGroup">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="docsPetition" name="docs" value="Petition/Answer">
                                    <label class="form-check-label" for="docsPetition">Petition/Answer</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="docsLease" name="docs" value="Lease / Rent Ledger">
                                    <label class="form-check-label" for="docsLease">Lease / Rent Ledger</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="docsPrior" name="docs" value="Prior Orders">
                                    <label class="form-check-label" for="docsPrior">Prior Orders</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="docsInspect" name="docs" value="Inspection Reports">
                                    <label class="form-check-label" for="docsInspect">Inspection Reports</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="docsStip" name="docs" value="Stipulations">
                                    <label class="form-check-label" for="docsStip">Stipulations</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="docsOtherCb">
                                    <label class="form-check-label" for="docsOtherCb">Other</label>
                                </div>

                                <input type="text" id="docsOther" name="docsOther"
                                       class="form-control mt-2" placeholder="Specify other"
                                       style="max-width: 300px; display: none;" />
                            </div>

                           
                        </div>

                        <!-- Special Instructions -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Special Instructions from Hiring Attorney</label>
                            <textarea name="instructions" class="form-control" rows="3" placeholder="Enter any special instructions..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    @if (CurrentStep == StepPerdiem.Reporting)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold">
                        Reporting Requirements
                    </div>

                    <div class="card-body">
                        <div class="card-body">
                            <label class="form-label fw-semibold">Select Applicable Reporting Requirements</label>

                            <div class="d-flex flex-column gap-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="reportWritten" name="reporting" value="Written Court Report">
                                    <label class="form-check-label" for="reportWritten">
                                        Written Court Report (Outcome, Next Date, Judge’s Notes)
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="reportCopy" name="reporting" value="Copy of Stipulation/Order">
                                    <label class="form-check-label" for="reportCopy">
                                        Copy of Any Stipulation/Order Signed
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="reportUpdate" name="reporting" value="Update Status in Platform">
                                    <label class="form-check-label" for="reportUpdate">
                                        Updated Case Status in Platform
                                    </label>
                                </div>
                            </div>

                            <div class="text-danger small mt-2 d-none" id="reportError">
                                Please select at least one reporting requirement.
                            </div>
                        </div>
                      
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    @if (CurrentStep == StepPerdiem.Billing)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                       Billing
                    </div>

                    <div class="card-body">
                        <!-- Rate / Compensation -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                Rate / Compensation <span class="text-danger">*</span>
                            </label>

                            <div id="billingRadio" class="d-flex flex-wrap align-items-center gap-3">
                                <!-- Flat Rate Option -->
                                <div class="form-check d-flex align-items-center gap-2">
                                    <input class="form-check-input" type="radio" name="billingMode" id="billingFlat" value="flat" checked>
                                    <label class="form-check-label" for="billingFlat">Flat</label>
                                </div>
                                <input type="number" id="flatAmount" name="flatAmount"
                                       class="form-control" placeholder="$"
                                       min="0" step="0.01"
                                       style="width:160px;" />

                                <!-- Hourly Rate Option -->
                                <div class="form-check d-flex align-items-center gap-2">
                                    <input class="form-check-input" type="radio" name="billingMode" id="billingHourly" value="hourly">
                                    <label class="form-check-label" for="billingHourly">Hourly</label>
                                </div>
                                <input type="number" id="hourlyRate" name="hourlyRate"
                                       class="form-control" placeholder="$ / hr"
                                       min="0" step="0.01"
                                       style="width:160px; display:none;" />
                                <input type="number" id="hourlyEstimate" name="hourlyEstimate"
                                       class="form-control" placeholder="est. hrs"
                                       min="0" step="0.25"
                                       style="width:120px; display:none;" />
                            </div>

                            <div class="text-danger small mt-1 d-none" id="billingError">
                                Enter a flat amount, or hourly rate + estimated hours.
                            </div>
                        </div>

                        <!-- Travel / Other Expenses & Payment Method -->
                        <div class="row g-3">
                            <!-- Travel / Other Expenses -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Travel / Other Expenses</label>
                                <input type="text" id="expenses" name="expenses"
                                       class="form-control" placeholder="Optional" />
                            </div>

                            <!-- Payment Method -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Payment Method <span class="text-danger">*</span></label>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="paymentDirect" name="payment" value="Direct Pay" checked>
                                    <label class="form-check-label" for="paymentDirect">Direct Pay (check / ACH)</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="paymentPlatform" name="payment" value="Platform Invoice">
                                    <label class="form-check-label" for="paymentPlatform">Platform Invoice (EvictionFiler.com)</label>
                                </div>

                                <div class="text-danger small mt-1 d-none" id="paymentError">
                                    Please select a payment method.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    @if (CurrentStep == StepPerdiem.Acknowledgment)
    {
        <div class="row">
            <!-- Left side: Case Information -->
            <div class="col-md-8">
                <div class="card mb-3 shadow-sm rounded-3">
                    <div class="card-header fw-bold ">
                        ✅ Acknowledgment
                    </div>

                    <div class="card-body">
                        <p class="text-muted mb-4">
                            I, (Per Diem Attorney), accept responsibility to appear and represent the above party in accordance with instructions provided.
                        </p>

                        <div class="row g-3">
                            <!-- Attorney Name -->
                            <div class="col-md-4">
                                <label class="form-label fw-semibold">
                                    Per Diem Attorney (Name) <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="ackName" name="ackName" required placeholder="Enter full name" />
                                <div class="text-danger small mt-1 d-none" id="ackNameError">Please enter your full name.</div>
                            </div>

                            <!-- Signature -->
                            <div class="col-md-4">
                                <label class="form-label fw-semibold">
                                    Signature <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="ackSignature" name="ackSignature" required placeholder="Type full name as signature" />
                                <div class="text-danger small mt-1 d-none" id="ackSignatureError">Please provide your typed signature.</div>
                            </div>

                            <!-- Date -->
                            <div class="col-md-4">
                                <label class="form-label fw-semibold">
                                    Date <span class="text-danger">*</span>
                                </label>
                                <input type="date" class="form-control" id="ackDate" name="ackDate" required />
                                <div class="text-danger small mt-1 d-none" id="ackDateError">Please select a date.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <TipsSummary />
            </div>
        </div>
    }


    <div class="d-flex justify-content-between border-top pt-3 mt-3">
        <button type="button" class="btn btn-outline-secondary" @onclick="Prev" disabled="@(CurrentStep == StepPerdiem.Acknowledgment)">← Back</button>
        @if (CurrentStep != StepPerdiem.Acknowledgment)
        {
            <button type="button" class="btn" style="background-color:#1F365D !important; color:white" @onclick="Next">Next →</button>
        }
        else
        {
            <button type="button" class="btn btn-success">Submit</button>
        }
    </div>
    @* </EditForm> *@

</div>

@code {
    private readonly List<string> Steps = new() { "Attorney", "Case", "Party Repre", "Apperence", "Case Background", "Document/Intractions", "Reporting", "Billing", "Acknowledgment "};

    [Parameter] public StepPerdiem CurrentStep { get; set; }
    private void Prev()
    {
        if (CurrentStep > StepPerdiem.Attorney) CurrentStep--;
    }

    private async Task Next()
    {

        if (CurrentStep < StepPerdiem.Acknowledgment) CurrentStep++;
    }

    private string Progress => (((int)CurrentStep + 1) * 100.0 / Steps.Count).ToString("0");
}


