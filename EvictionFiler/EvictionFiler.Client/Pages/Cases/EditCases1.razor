@page "/legalcase/{caseId:guid}"

@using System.ComponentModel.DataAnnotations
@using System.Linq.Expressions
@using EvictionFiler.Application.DTOs
@using EvictionFiler.Application.DTOs.ApartmentDto
@using EvictionFiler.Application.DTOs.ArrearLedgerDtos
@using EvictionFiler.Application.DTOs.ClientDto
@using EvictionFiler.Application.DTOs.CourtDto
@using EvictionFiler.Application.DTOs.CourtPart
@using EvictionFiler.Application.DTOs.FormTypeDto
@using EvictionFiler.Application.DTOs.LandLordDto
@using EvictionFiler.Application.DTOs.LegalCaseDto
@using EvictionFiler.Application.DTOs.MasterDtos.ApperenceTypeDto
@using EvictionFiler.Application.DTOs.MasterDtos.CaseTypeHPDDto
@using EvictionFiler.Application.DTOs.MasterDtos.CaseTypePerDiemDto
@using EvictionFiler.Application.DTOs.MasterDtos.CountyDto
@using EvictionFiler.Application.DTOs.MasterDtos.DefenseTypeDto
@using EvictionFiler.Application.DTOs.MasterDtos.DocumentInstructionPerDiemDto
@using EvictionFiler.Application.DTOs.MasterDtos.HarassmentTypeDto
@using EvictionFiler.Application.DTOs.MasterDtos.ReliefPetitionerTypeDto
@using EvictionFiler.Application.DTOs.MasterDtos.ReliefRespondentTypeDto
@using EvictionFiler.Application.DTOs.MasterDtos.ReportingRequirementPerDiemDto
@using EvictionFiler.Application.DTOs.OccupantDto
@using EvictionFiler.Application.DTOs.TenantDto

@using EvictionFiler.Application.Interfaces.IRepository.MasterRepository
@using EvictionFiler.Application.Interfaces.IServices
@using EvictionFiler.Application.Interfaces.IServices.Master
@using EvictionFiler.Client.Components.Cases
@* @using EvictionFiler.Client.Jwt *@
@using EvictionFiler.Domain.Entities
@using EvictionFiler.Domain.Entities.Master
@inject IClientRoleRepository ClientRoleRepository
@inject IPremiseTypeRepository PremiseTypeRepository
@inject ICaseTypeRepository CaseTypeRepository
@inject ICaseSubTypeRepository CaseSubTypeRepository
@inject IRegulationStatusRepository RegulationStatusRepository
@inject IReasonHoldoverRepository ReasonHoldoverRepository
@inject ILandlordTypeRepository LandlordTypeRepository
@inject IRenewalStatusRepository RenewalStatusRepository
@inject IUnitIllegalRepository UnitIllegalRepository
@inject ITenancyTypeRepository TenancyTypeRepository
@inject IDateRentRepository DateRentRepository
@inject ILandlordSevice _landlordService
@inject IBuildingService _buildingService
@inject ILegalCaseService _legalCaseService
@inject ICountyService _countyService
@inject ICourtService _courtService
@inject ITenantService _tenantService
@inject IClientService _clientService
@inject ICaseProgramRepository _caseprogram
@inject IFormTypesRepository _FormService
@inject IAdditionalTenantService _additionalTenant
@inject IAdditionalOccupantsService _additionalOccupant
@inject IStateRepository _stateRepository
@inject ICaseAdditionalTenantService _caseAdditionalTenant
@inject ITenancyTypeForBuildingRepository TenancyTypeForBuildingRepository;
@inject IExemptionBasicRepository ExemptionBasicRepository;
@inject IExemptionReasonRepository ExemptionReasonRepository;
@inject NavigationStateMessage navmessage

@using EvictionFiler.Client.SpinnerService
@using EvictionFiler.Domian.Enums
@inject IJSRuntime JS
@inject NavigationManager nav
@inject SpinnerService spinnerservice
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization;
@using System.Security.Claims
@using System.Globalization
@inject AuthenticationStateProvider _authStateProvider
@inject IJSRuntime JS
@inject NavigationManager nav
@inject SpinnerService spinnerservice
@attribute [Authorize]
<!--
EvictionFiler – Intake Wizard (Blazor + Bootstrap 5)
• Single self‑contained .razor component
• Stepper, progress bar, per‑step validation
• Clean Bootstrap 5 cards & grid
• Review screen and JS alert on submit (replace with API call)
-->
<PageTitle>Edit Case - Housing Court Filer</PageTitle>


<style>
    .required-label::after {
        content: " *";
        color: red;
    }

    :root {
        --bg: #f7f9fc;
        --card: #ffffff;
        --ink: #0f172a;
        --muted: #64748b;
        --line: #e2e8f0;
        --brand: #4f46e5;
        --brand-2: #4338ca;
        --ok: #059669;
        --warn: #b45309;
        --danger: #b91c1c;
        --radius: 16px;
        --shadow: 0 6px 24px rgba(2, 6, 23, .08);
    }

    * {
        box-sizing: border-box
    }

    html,
    body {
        height: 100%
    }

    body {
        margin: 0;
        font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
        background: radial-gradient(70% 120% at 50% -10%, #eef2ff 0%, var(--bg) 60%);
        color: var(--ink)
    }

    .wrap {
        max-width: 1200px;
        margin: auto;
        padding: 24px
    }

    label {
        display: block;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: .04em;
        font-weight: 700;
        color: #475569;
        margin-bottom: 6px;
    }

    header.top {
        position: sticky;
        top: 0;
        z-index: 10;
        background: rgba(255, 255, 255, .9);
        backdrop-filter: saturate(180%) blur(6px);
        border-bottom: 1px solid var(--line)
    }

        header.top .bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            max-width: 1200px;
            margin: auto
        }

    .brand {
        display: flex;
        gap: 12px;
        align-items: center
    }

    .logo {
        width: 40px;
        height: 40px;
        border-radius: 14px;
        background: #0f172a;
        color: #fff;
        display: grid;
        place-items: center;
        font-weight: 700
    }

    .secure {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        border-radius: 999px;
        padding: 6px 10px;
        border: 1px solid #d1fae5;
        background: #ecfdf5;
        color: #065f46;
        font-size: 12px
    }

    .stepper {
        padding: 0 24px 14px;
        max-width: 1200px;
        margin: auto
    }

    .track {
        height: 6px;
        background: #e5e7eb;
        border-radius: 999px;
        overflow: hidden
    }

    .meter {
        height: 100%;
        background: linear-gradient(90deg, var(--brand), var(--brand-2));
        width: 40%
    }

    .steps {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin: 8px 0
    }

    .chip {
        display: flex;
        gap: 8px;
        align-items: center;
        color: #475569
    }

    .dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: #cbd5e1
    }

        .dot.active {
            background: #818cf8
        }

        .dot.done {
            background: #4f46e5
        }

    .grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px
    }

    @@media (max-width:1024px) {
        .grid {
            grid-template-columns: 1fr
        }
    }

    .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow)
    }

        .card > header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--line);
            display: flex;
            gap: 12px;
            align-items: flex-start
        }

    .k {
        width: 28px;
        height: 28px;
        border-radius: 12px;
        background: #0f172a;
        color: #fff;
        display: grid;
        place-items: center;
        font-size: 12px;
        font-weight: 700
    }

    .card .body {
        padding: 20px
    }

    .fields {
        display: grid;
        gap: 16px
    }

    .cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr))
    }

    .cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr))
    }

    @@media (max-width:820px) {
        .cols-2, .cols-3 {
            grid-template-columns: 1fr
        }
    }

    label.lbl {
        display: block;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: .04em;
        font-weight: 700;
        color: #475569;
        margin-bottom: 6px
    }

    input.txt,
    select.sel {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid #cbd5e1;
        border-radius: 12px;
        background: #fff;
        color: #0f172a;
        outline: none
    }

        input.txt:focus,
        select.sel:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 6px #eef2ff
        }

    .hint {
        font-size: 12px;
        color: #64748b;
        margin-top: 4px
    }

    .pill {
        display: inline-block;
        padding: 8px 12px;
        border: 1px solid #cbd5e1;
        border-radius: 12px;
        background: #fff;
        font-size: 13px
    }

    .aside.card {
        position: sticky;
        top: 106px;
        height: fit-content
    }

    .kv {
        display: flex;
        justify-content: space-between;
        gap: 12px
    }

        .kv .k {
            background: none;
            color: #64748b;
            width: auto;
            height: auto;
            border-radius: 0;
            font-weight: 600
        }

    .actions {
        position: sticky;
        bottom: 0;
        z-index: 10;
        background: rgba(255, 255, 255, .9);
        border-top: 1px solid var(--line)
    }

        .actions .row {
            max-width: 1200px;
            margin: auto;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

    .btn {
        padding: 10px 16px;
        border-radius: 12px;
        border: 1px solid #cbd5e1;
        background: #fff;
        color: #0f172a
    }

        .btn.primary {
            background: var(--brand);
            border-color: transparent;
            color: #fff
        }

        .btn.danger {
            background: #fee2e2;
            border-color: #fecaca;
            color: #991b1b
        }

    .list {
        display: flex;
        flex-direction: column;
        gap: 8px
    }

        .list .row {
            display: flex;
            gap: 8px
        }

    .iconbtn {
        border: 1px solid #cbd5e1;
        background: #fff;
        border-radius: 10px;
        padding: 8px 10px;
        cursor: pointer
    }

    .pre {
        white-space: pre-wrap;
        background: #0b1020;
        color: #e2e8f0;
        border-radius: 12px;
        padding: 14px;
        overflow: auto;
        max-height: 360px
    }

    @@media (max-width:560px) {
        .logo {
            width: 36px;
            height: 36px
        }

        .brand h1 {
            font-size: 16px
        }

        .secure {
            display: none
        }
    }

    .form-check-input {
        cursor: pointer;
        width: 17px;
        height: 17px;
        margin-top: 10px
    }

    .btn-tenant:hover {
        background: #1F365D !important;
    }

    .holdover-form:focus {
        border-color: #1F365D !important;
        box-shadow: 0 0 0 0 !important;
        outline: none !important;
    }

    .step-disabled {
        cursor: not-allowed;
        opacity: 0.5;
        pointer-events: none;
    }

    .step-active {
        cursor: pointer;
    }

    .bigger-checkbox {
        width: 17px !important;
        height: 17px !important;
        cursor: pointer;
    }

    .form-check {
        display: flex; /* Center vertically */
        gap: 8px; /* Checkbox aur text me spacing */
    }

    .form-check-label {
        margin-top: 9px; /* Slight alignment tweak */
    }


    .row-item {
        display: grid;
        grid-template-columns: 1fr 1fr 1.2fr 120px;
        column-gap: 18px;
        row-gap: 8px;
        padding: 15px 0;
        border-bottom: 1px solid #e5e7eb;
        margin-bottom: 10px;
    }

    .form-label-arrear {
        grid-column: span 4;
        font-size: 14px;
        margin-bottom: 4px;
        font-weight: 600;
        color: #374151;
    }

    .input {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #d1d5db;
        border-radius: 10px;
        font-size: 15px;
    }

    .remove-btn {
        border: 1px solid #d1d5db;
        background: #fff;
        border-radius: 10px;
        cursor: pointer;
        padding: 10px 15px;
        align-self: end;
    }

    .add-btn {
        margin-top: 15px;
        padding: 12px 22px;
        background: #f9fafb;
        border: 1px solid #d1d5db;
        border-radius: 10px;
        cursor: pointer;
        font-size: 15px;
    }

    .total-box {
        background: #f3f4f6;
        padding: 14px 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        font-size: 16px;
        font-weight: 600;
    }

    .lookup-link {
        color: #1F365D;
        display: flex;
        justify-content: center;
        align-items: center;
        text-decoration: none;
    }

        .lookup-link:hover {
            color: #1F365D;
            display: flex;
            font-weight: 600;
            justify-content: center;
            align-items: center;
            text-decoration: underline;
            cursor: pointer;
            text-decoration: underline;
        }

    /* Parent container */
    .tenant-scroll-container {
        height: 75vh; /* adjust if header height changes */
        overflow-y: auto;
        padding-bottom: 90px; /* reserve space for footer */
    }

    @@media (min-width: 1400px) {
        .container, .container-lg, .container-md, .container-sm, .container-xl, .container-xxl {
            max-width: 100%;
        }
    }

    .btn:focus, .btn:active:focus, .btn-link.nav-link:focus, .form-control:focus, .form-check-input:focus {
        box-shadow: none;
    }

    .form-switch .form-check-input:checked {
        background-color: darkblue;
    }

    .form-switch .form-check-input:not(:checked) {
        --bs-form-switch-bg: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'><circle r='3' fill='%236b84af'/></svg>");
    }

    .form-switch .form-check-input {
        width: 2.5em;
        margin-left: -0.5em;
        border: solid 2px lightgrey;
    }

</style>


@if (!isLoading)
{
    <div class="container-fluid py-3 border-bottom bg-white sticky-top">
        <div class="d-flex justify-content-between align-items-center">

            <div class="d-flex align-items-center justify-content-between w-100">
                @for (var i = 0; i < Steps.Count; i++)
                {
                    var bgColor = i <= (int)CurrentStep ? "#1F365D" : "#ecf0f2";
                    StepItems step = Steps[i];
                    <div class="d-flex align-items-center gap-2">
                        <span class="rounded-circle d-inline-block"
                              style="width:14px; height:14px; border: 1px solid #ecf0f2; background-color:@bgColor;"></span>
                        @*   @if (step.Name == "CaseAndclient")
                        {
                            <span style="@(i <= Tracker ? "cursor:pointer;" : "not-allowed")" @onclick="@(() => OnStepClick(step.Id))">Case & Client</span>

                        }
                        else
                        {
                            <span style="@(i <= Tracker ? "cursor:pointer;" : "not-allowed")" @onclick="@(() => OnStepClick(step.Id))">@step.Name</span>

                        } *@

                        @if (i <= Tracker)
                        {
                            <span class="step-active" @onclick="@(() => OnStepClick(step.Id))">
                                @(step.Name == "CaseAndclient" ? "Case & Client" : step.Name)
                            </span>
                        }
                        else
                        {
                            <span class="step-disabled">
                                @(step.Name == "CaseAndclient" ? "Case & Client" : step.Name)
                            </span>
                        }

                    </div>
                }
            </div>

        </div>

        <div class="progress mt-3" style="height:6px;">
            <div class="progress-bar" role="progressbar" style="width:@Progress% ;  background-color:#1F365D !important"></div>
        </div>
    </div>

}



<div class="container my-4">
    <EditForm EditContext="_editContext">
        <DataAnnotationsValidator />

        @if (legalcaseDto.CaseTypeName == "Holdover" || legalcaseDto.CaseTypeName == "NonPayment")
        {
            @if (Steps[CurrentStep].Name == "CaseAndclient")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card mb-3">
                                <div class="card-header fw-bold head">Case Information</div>
                                <div class="card-body">
                                    <div class="row g-3">

                                        @if (!HideCaseAndClientSection)
                                        {
                                            <!-- CASE TYPE -->
                                            <div class="col-5 ">
                                                <label class="form-label required-label">Case Type</label>
                                                <InputSelect class="form-select holdover-form"
                                                             @bind-Value="legalcaseDto.CaseTypeId"
                                                             @bind-Value:after="BuildSteps">

                                                    @foreach (var l in CaseTypeList)
                                                    {
                                                        <option value="@l.Id">@l.Name</option>
                                                    }
                                                </InputSelect>
                                                <ValidationMessage For="() => legalcaseDto.CaseTypeId" />
                                            </div>

                                            <div class="col-5 ">
                                                <label class="form-label required-label">Sub Case Type</label>
                                                <InputSelect class="form-select holdover-form"
                                                             @bind-Value="legalcaseDto.SubCaseTypeId">

                                                    @foreach (var l in SubCaseTypeList)
                                                    {
                                                        <option value="@l.Id">@l.Name</option>
                                                    }
                                                </InputSelect>
                                                <ValidationMessage For="() => legalcaseDto.SubCaseTypeId" />
                                            </div>

                                            <!-- CLIENT SEARCH BOX -->
                                            <div class="col-6">
                                                @if (!IsNewClient)
                                                {
                                                    <div class="position-relative" @onfocusout="HideClientDropDown">
                                                        <label class="form-label required-label">Client</label>

                                                        <input type="text" class="form-control" autocomplete="off"
                                                               placeholder="Search by client name or code..."
                                                               @bind-value="searchText"
                                                               @oninput="OnSearchInput"
                                                               @onclick="ShowAllClients" />

                                                        @if (filteredClients?.Any() == true)
                                                        {
                                                            <ul class="dropdown-menu show"
                                                                style="position:absolute; width:100%; cursor:pointer; z-index:2000;">
                                                                @foreach (var c in filteredClients)
                                                                {
                                                                    <li class="dropdown-item"
                                                                        @onclick="() => SelectClient(c)">
                                                                        @c.FirstName @c.LastName / @c.ClientCode
                                                                    </li>
                                                                }
                                                            </ul>
                                                        }
                                                        <div style="min-height:1.5em;">
                                                            <ValidationMessage For="() => legalcaseDto.ClientId" />
                                                        </div>
                                                    </div>
                                                }
                                            </div>

                                            <!-- ADD BUTTON -->
                                            <div class="col-3 d-flex  align-items-center">
                                                <label class="form-label "></label>
                                                @if (!showClientTextbox)
                                                {
                                                    <div class="w-100 d-flex gap-3 align-items-center">
                                                        <span class="mt-2 fw-bold">OR</span>
                                                        <button type="button" class="btn"
                                                                style="background-color:#1F365D; color:white"
                                                                @onclick="AddClient">
                                                            + ADD
                                                        </button>
                                                    </div>
                                                }
                                            </div>

                                        }


                                        @if (!showClientTextbox && legalcaseDto.ClientId.HasValue
                                                                        && legalcaseDto.CaseTypeId.HasValue)
                                        {
                                            <div class="card p-3 position-relative mt-3">
                                                <button type="button"
                                                        class="btn-close position-absolute top-0 end-0 m-2"
                                                        @onclick="ClearSelectedClient" title=" Click here for Client reset">
                                                </button>

                                                <div class="row g-3">
                                                    <div class="col-4">
                                                        <label class="form-label ">Client Name</label>
                                                        <InputText class="form-control" style="cursor:not-allowed"
                                                                   placeholder="Enter Name"
                                                                   @bind-Value="legalcaseDto.ClientName" disabled />
                                                        <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Phone</label>
                                                        <InputText class="form-control" style="cursor:not-allowed"
                                                                   placeholder="Enter Number"
                                                                   @bind-Value="legalcaseDto.ClientPhone" disabled />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label ">Client Type</label>
                                                        <InputSelect class="form-select" style="cursor:not-allowed"
                                                                     @bind-Value="legalcaseDto.ClientTypeId" disabled>
                                                            <option value="">-- Select --</option>
                                                            @foreach (var Own in ClientTypeList)
                                                            {
                                                                <option value="@Own.Id">@Own.Name</option>
                                                            }
                                                        </InputSelect>
                                                        <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                    </div>





                                                    <div class="col-6">
                                                        <label class="form-label ">Email</label>
                                                        <InputText class="form-control" style="cursor:not-allowed"
                                                                   placeholder="Enter Email"
                                                                   @bind-Value="legalcaseDto.ClientEmail" disabled />
                                                        <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Reference #</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Reference"
                                                                   @bind-Value="legalcaseDto.Reference" />
                                                    </div>



                                                    @if (IsNewClient)
                                                    {
                                                        <div class="col-9">
                                                            <label class="form-label">Address</label>
                                                            <InputText class="form-control"
                                                                       placeholder="Enter Address"
                                                                       @bind-Value="legalcaseDto.ClientAddress" />
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        }


                                        <!-- NEW CLIENT TEXTBOX FORM -->
                                        @if (showClientTextbox)
                                        {


                                            <div class="card p-3 position-relative">
                                                <button type="button"
                                                        class="btn-close position-absolute top-0 end-0 m-2"
                                                        @onclick="ClearSelectedClient" title=" Click here for lanlord reset">
                                                </button>

                                                <div class="row g-3">

                                                    <div class="col-4">
                                                        <label class="form-label required-label">Client Name</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Name"
                                                                   @bind-Value="legalcaseDto.ClientName" />
                                                        <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Phone</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Number"
                                                                   @bind-Value="legalcaseDto.ClientPhone" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label required-label">Client Type</label>
                                                        <InputSelect class="form-select"
                                                                     @bind-Value="legalcaseDto.ClientTypeId">
                                                            <option value="">-- Select --</option>
                                                            @foreach (var Own in ClientTypeList)
                                                            {
                                                                <option value="@Own.Id">@Own.Name</option>
                                                            }
                                                        </InputSelect>
                                                        <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                    </div>
                                                    <div class="col-6">
                                                        <label class="form-label required-label">Email</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Email"
                                                                   @bind-Value="legalcaseDto.ClientEmail" />
                                                        <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Reference #</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Reference"
                                                                   @bind-Value="legalcaseDto.Reference" />
                                                    </div>

                                                    @if (IsNewClient)
                                                    {
                                                        <div class="col-8">
                                                            <label class="form-label">Address</label>
                                                            <InputText class="form-control"
                                                                       placeholder="Enter Address"
                                                                       @bind-Value="legalcaseDto.ClientAddress" />
                                                        </div>
                                                    }

                                                </div>
                                            </div>
                                        }

                                    </div>



                                </div>
                            </div>
                        </div>

                        <!-- Right side summary -->
                        <div class="col-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          ClientList="selectedClient"
                                          CaseTypeList="CaseTypeList"
                                          CurrentStep="CurrentStep" Steps="Steps" />
                            <TipsSummary />
                        </div>
                    </div>
                </div>


            }


            @if (Steps[CurrentStep].Name == "Landlord")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card mb-3">
                                <div class="card-header d-flex justify-content-between ">
                                    <div class="fw-bold head">
                                        Landlord Information
                                    </div>
                                    <a href="https://a836-acris.nyc.gov/CP/" target="_blank" class="lookup-link"><i class="fa-solid fa-book" style="margin-right:5px;"></i>lookup</a>
                                </div>
                                <div class="card-body ">


                                    <div class="row mt-2 align-items-center">
                                        @if (showLandlordfields)
                                        {
                                            <button type="button" class="btn-close position-absolute top-3 end-0 m-2 fs-6"
                                                    aria-label="Close" title=" Click here for lanlord reset"
                                                    @onclick="CancelLandlords">
                                            </button>
                                        }
                                        <!-- align-items-end vertically bottom align -->
                                        <div class="col-md-6 position-relative" @onfocusout="HideLandlordsDropDown">
                                            <label class=@(IsLandlordSelected ? "form-label" : "form-label required-label")>Landlord / Owner Name</label>

                                            @if (showLandlordfields && selectedlandlord == null)
                                            {
                                                <input type="text" class="form-control" autocomplete="off"
                                                       placeholder="Enter Landlord name"
                                                       @bind-value="searchlandlordText"
                                                       @onblur="saveLandLordName" />
                                            }
                                            else

                                            {
                                                <input type="text" class="form-control" style=@(IsLandlordSelected ? "cursor:not-allowed" : "")
                                                       placeholder="Search by LandLord name or code..."
                                                       @bind-value="searchlandlordText"
                                                       @oninput="OnSearchLandlordInput"
                                                       @onblur="saveLandLordName"
                                                       disabled="@IsLandlordSelected"
                                                       @onclick="ShowAlllandlords" />
                                            }

                                            @if (filteredLandlords?.Any() == true)
                                            {
                                                <ul class="dropdown-menu show" style="position: absolute; width:95%; cursor:pointer; z-index:2000;">
                                                    @foreach (var c in filteredLandlords)
                                                    {
                                                        <li class="dropdown-item" @onclick="() => SelectLandlord(c)">
                                                            @c.FirstName @c.LastName / @c.LandLordCode
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                            <div style="min-height:1.5em; margin-top:4px">
                                                <ValidationMessage For="() => legalcaseDto.LandlordId" />
                                            </div>

                                        </div>

                                        <div class="col-md-4 d-flex align-items-end">
                                            <!-- bottom align -->
                                            @if (!showLandlordfields)
                                            {
                                                <div class="w-100 d-flex gap-3  align-items-center">
                                                    <span class="fw-bold mt-1">OR</span>
                                                    <button type="button" class="btn"
                                                            style="background-color:#1F365D; color:white"
                                                            @onclick="SelectLandlords">
                                                        + ADD
                                                    </button>
                                                </div>
                                            }

                                        </div>
                                    </div>



                                    @if (showLandlordfields)
                                    {
                                        <div class=@(selectedlandlord != null ? "card p-3 position-relative " : " position-relative")>

                                            <div class="row mt-1">
                                                <div class="col-md-6">
                                                    <label class=@(IsLandlordSelected ? "form-label" : "form-label required-label")>Contact Person </label>
                                                    <InputText class="form-control" style=@(IsLandlordSelected ? "cursor:not-allowed" : "") @bind-Value="legalcaseDto.ContactPersonName" placeholder="Enter Contact Person" disabled="@IsLandlordSelected" />
                                                    @if (!IsLandlordSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.ContactPersonName" />
                                                    }
                                                </div>
                                                <div class="col-md-6 ">
                                                    <label class=@(IsLandlordSelected ? "form-label" : "form-label required-label")>Landlord Address </label>
                                                    <InputText class="form-control" style=@(IsLandlordSelected ? "cursor:not-allowed" : "") @bind-Value="legalcaseDto.LandlordAddress" placeholder="Enter Address" disabled="@IsLandlordSelected" />
                                                    @if (!IsLandlordSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.LandlordAddress" />
                                                    }
                                                </div>

                                            </div>

                                        </div>
                                    }

                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <CasesSummary LegalCase="legalcaseDto" LandLordTypeList="LandLordTypeList" CurrentStep="CurrentStep" Steps="Steps" />

                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @* BUILDING *@
            @if (Steps[CurrentStep].Name == "Building")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card mb-3">
                                <div class="card-header d-flex justify-content-between">
                                    <div class="fw-bold head">
                                        Building Information
                                    </div>
                                    <a href=" https://hpdonline.nyc.gov/hpdonline/" target="_blank" class="lookup-link"><i class="fa-solid fa-book" style="margin-right:5px;"></i>lookup</a>
                                </div>
                                <div class="card-body row ">


                                    <div class="row mt-2">

                                        @if (!IsNewBuilding && !isBuildingSelected)
                                        {
                                            <div class="col-md-6 position-relative" @onfocusout="HideBuildingDropdown">
                                                <label class="form-label  required-label">Building</label>
                                                <input type="text" class="form-control" autocomplete="off"
                                                       placeholder="Search by Building Address or code..."
                                                       @bind-value="searchBuildingText"
                                                       @oninput="OnSearchBuildingInput"
                                                       @onclick="ShowAllBuildings" />
                                                @if (filteredBuildings?.Any() == true)
                                                {
                                                    <ul class="dropdown-menu show" style="position: absolute; width:94% !important; cursor:pointer;">
                                                        @foreach (var c in filteredBuildings)
                                                        {
                                                            <li class="dropdown-item" @onclick="() => SelectBuilding(c)">
                                                                @c.Address1 / @c.BuildingCode
                                                            </li>
                                                        }
                                                    </ul>
                                                }
                                                <div style="min-height:1.5em; margin-top:4px">

                                                    <ValidationMessage For="() => legalcaseDto.BuildingId" />
                                                </div>

                                            </div>
                                            <div class="col-md-4 d-flex align-items-center">
                                                <!-- bottom align -->
                                                @if (!showBuildingfields)
                                                {
                                                    <div class="w-100 d-flex gap-3  align-items-center">
                                                        <span class="fw-bold mt-1">OR</span>
                                                        <button type="button" class="btn"
                                                                style="background-color:#1F365D; color:white"
                                                                @onclick="OnBindBuldingAfter">
                                                            + ADD
                                                        </button>
                                                    </div>
                                                }
                                            </div>

                                        }



                                    </div>

                                    @if (showBuildingfields || isBuildingSelected)
                                    {
                                        <div class="card p-2 position-relative">
                                            @if (showBuildingfields)
                                            {
                                                <button type="button" class="btn-close position-absolute top-3 end-0 m-2 fs-6"
                                                        aria-label="Close"
                                                        @onclick="OnBindBuldingCancel" title="Click here for building reset">
                                                </button>
                                            }
                                            <div class="row mt-5">
                                                <div class="col-6">
                                                    <label class=@(isBuildingSelected ? "form-label" : "form-label required-label")>Street Address </label>
                                                    <InputText class="form-control" style=@(isBuildingSelected ? "cursor:not-allowed" : "") @bind-Value="legalcaseDto.BuildingAddress" placeholder="Enter Address" disabled="@isBuildingSelected" />

                                                    @if (!isBuildingSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.BuildingAddress" />
                                                    }
                                                </div>

                                                <div class="col-md-3">
                                                    <label class=@(isBuildingSelected ? "form-label" : "form-label required-label")>MDR Number </label>
                                                    <InputText class="form-control" style=@(isBuildingSelected ? "cursor:not-allowed" : "") @bind-Value="legalcaseDto.Mdr" placeholder="Enter MDR Number" disabled="@isBuildingSelected" />

                                                    @if (!isBuildingSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.Mdr" />
                                                    }
                                                </div>
                                                <div class="col-md-3">
                                                    <label class=@(isBuildingSelected ? "form-label" : "form-label required-label")>No. of Units </label>
                                                    <InputText class="form-control" style=@(isBuildingSelected ? "cursor:not-allowed" : "") @bind-Value="legalcaseDto.Units" placeholder="Enter Units" disabled="@isBuildingSelected" />

                                                    @if (!isBuildingSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.Units" />
                                                    }
                                                </div>

                                            </div>

                                            <div class="row mt-4">

                                                <!-- County -->
                                                <div class="@ColumnClass" style=@(ShowExemptionOther ? "width:25%" : "")>
                                                    <label class="form-label required-label">County</label>
                                                    <InputSelect class="form-select"
                                                                 @bind-Value="legalcaseDto.BoroughorCityId"
                                                                 disabled="@isBuildingSelected">
                                                        <option value="">-- Select --</option>
                                                        @foreach (var s in CityList)
                                                        {
                                                            <option value="@s.Id">@s.Name</option>
                                                        }
                                                    </InputSelect>
                                                </div>

                                                <!-- Rent Regulation -->
                                                <div class="@ColumnClass" style=@(ShowExemptionOther ? "width:20%" : "")>
                                                    <label class="form-label required-label">Rent Regulation</label>
                                                    <InputSelect class="form-select"
                                                                 @bind-Value="legalcaseDto.RegulationStatusId"
                                                                 disabled="@isBuildingSelected">
                                                        <option value="">-- Select --</option>
                                                        @foreach (var l in RegulationList)
                                                        {
                                                            <option value="@l.Id">@l.Name</option>
                                                        }
                                                    </InputSelect>
                                                </div>

                                                @if (ShowExemptionBasic)
                                                {
                                                    <!-- Exemption Basic -->
                                                    <div class="@ColumnClass" style=@(ShowExemptionOther ? "width:20%" : "")>
                                                        <label class="form-label required-label fw-semibold">
                                                            Exemption Basic
                                                        </label>
                                                        <InputSelect class="form-select"
                                                                     @bind-Value="legalcaseDto.ExemptionBasisId"
                                                                     disabled="@isBuildingSelected">
                                                            <option value="">-- Select --</option>
                                                            @foreach (var s in ExemptionBasicList)
                                                            {
                                                                <option value="@s.Id">@s.Name</option>
                                                            }
                                                        </InputSelect>
                                                    </div>
                                                }
                                                @if (ShowExemptionOther)
                                                {
                                                    <!-- Exemption Basic -->
                                                    <div class="col">
                                                        <label class="form-label  fw-semibold">
                                                            Exemption
                                                        </label>
                                                        <InputText class="form-control" @bind-Value="legalcaseDto.ExemptionBasisOther" placeholder="Enter Exemption" disabled="@isBuildingSelected" />
                                                    </div>
                                                }
                                                @if (ShowRentOther)
                                                {
                                                    <!-- Exemption Basic -->
                                                    <div class="col">
                                                        <label class="form-label  ">
                                                            Other Regulation
                                                        </label>
                                                        <InputText class="form-control" @bind-Value="legalcaseDto.RentRegulationOther" placeholder="Enter Other Reulation" disabled="@isBuildingSelected" />
                                                    </div>
                                                }
                                            </div>


                                            @if (IsNewBuilding)
                                            {
                                                <div class="row mt-4">
                                                    <div class="col-md-4">
                                                        <label class="form-label  required-label">State </label>
                                                        <InputSelect class="form-select" @bind-Value="legalcaseDto.BuildingStateId" style="cursor:pointer" disabled="@isBuildingSelected">
                                                            @foreach (var s in StateList)
                                                            {
                                                                <option value="@s.Id">@s.Name</option>
                                                            }
                                                        </InputSelect>
                                                        <ValidationMessage For="() => legalcaseDto.BuildingStateId" />
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="form-label  required-label">Zipcode </label>
                                                        <InputText class="form-control" @bind-Value="legalcaseDto.BuildingZip" placeholder="Enter ZipCode" disabled="@isBuildingSelected" />
                                                        <ValidationMessage For="() => legalcaseDto.BuildingZip" />
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="form-label required-label">Agent </label>
                                                        <InputText class="form-control" @bind-Value="legalcaseDto.ManagingAgent" placeholder="Enter Agent" disabled="@isBuildingSelected" />

                                                        @if (!isBuildingSelected)
                                                        {
                                                            <ValidationMessage For="() => legalcaseDto.ManagingAgent" />
                                                        }
                                                    </div>
                                                </div>

                                            }
                                            <div class="row mt-4 d-flex justify-content-between">
                                                <div class="col-md-4">
                                                    <label class=@(isBuildingSelected ? "form-label fw-semibold" : "form-label required-label fw-semibold")>
                                                        Building Type
                                                    </label>
                                                    <InputSelect class="form-select" @bind-Value="legalcaseDto.PremiseTypeId" style=@(isBuildingSelected ? "cursor:not-allowed" : "cursor:pointer") disabled="@isBuildingSelected">
                                                        <option value="">-- Select --</option>
                                                        @foreach (var s in PremiseTypesList)
                                                        {
                                                            <option value="@s.Id">@s.Name</option>
                                                        }
                                                    </InputSelect>
                                                    @if (!IsExistingBuildingSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.PremiseTypeId" />
                                                    }

                                                </div>



                                                <div class="col-md-8">
                                                    <label class=@(isBuildingSelected ? "form-label fw-semibold" : "form-label required-label fw-semibold")>
                                                        Registration Status (HPD/DOF)
                                                    </label>

                                                    <div class="row mt-1">
                                                        @if (RegistrationstatusList != null && RegistrationstatusList.Any())
                                                        {
                                                            <div style="display: flex;flex-wrap: wrap; column-gap: 33px;">
                                                                <InputRadioGroup @bind-Value="legalcaseDto.RegistrationStatusTypeId" class="d-flex flex-wrap">
                                                                    @foreach (var Type in RegistrationstatusList)
                                                                    {
                                                                        <div class="col-auto">
                                                                            <div class="form-check">
                                                                                <InputRadio class="form-check-input" style=@(isBuildingSelected ? "cursor:not-allowed" : "cursor:pointer")
                                                                                            id="@($"RegStatus_{Type.Id}")"
                                                                                            Value="@Type.Id" disabled="@(IsExistingBuildingSelected == true || legalcaseDto.OwnerOccupied == true)" />
                                                                                <label class="form-check-label" for="@($"RegStatus_{Type.Id}")">@Type.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                </InputRadioGroup>
                                                                <ValidationMessage For="() => legalcaseDto.RegistrationStatusTypeId" />


                                                            </div>
                                                        }
                                                    </div>
                                                </div>


                                            </div>
                                            <div class="row mb-3 mt-3">
                                                <div class="col-4">
                                                    <div class="form-check form-switch" style="padding-left:0px;">


                                                        <label class="form-check-label form-label mb-0 me-2" for="ownerOccupiedSwitch">
                                                            Owner Occupied?
                                                            @* <span class="ms-2 fw-semibold">
                                                                @(legalcaseDto.OwnerOccupied ? "Yes" : "No")
                                                            </span> *@
                                                        </label>
                                                        <input class="form-check-input"
                                                               type="checkbox"
                                                               id="ownerOccupiedSwitch"
                                                               @bind="legalcaseDto.OwnerOccupied" @bind:after="SelectedOwnerOccupied"
                                                               disabled="@isBuildingSelected" />
                                                    </div>


                                                </div>

                                                <div class="col-4">

                                                    <div class="form-check form-switch" style="padding-left:0px;">


                                                        <label class="form-check-label form-label mb-0 me-2" for="goodCauseSwitch">
                                                            Does Good Cause Apply?:
                                                            @* <span class="ms-2 fw-semibold">
                                                                @(legalcaseDto.OwnerOccupied ? "Yes" : "No")
                                                            </span> *@
                                                        </label>
                                                        <input class="form-check-input"
                                                               type="checkbox"
                                                               id="GoodcauseSwitch"
                                                               @bind="legalcaseDto.GoodCause"
                                                               disabled="@isBuildingSelected" />
                                                    </div>


                                                </div>

                                                @if (!legalcaseDto.GoodCause)
                                                {
                                                    <div class="col-md-4">
                                                        <label class=@(isBuildingSelected ? "form-label fw-semibold" : "form-label required-label fw-semibold")>
                                                            Exemption Reason
                                                        </label>
                                                        <InputSelect class="form-select" @bind-Value="legalcaseDto.ExemptionReasonId" style=@(isBuildingSelected ? "cursor:not-allowed" : "cursor:pointer") disabled="@isBuildingSelected">
                                                            <option value="">-- Select --</option>
                                                            @foreach (var s in ExemptionReasonList)
                                                            {
                                                                <option value="@s.Id">@s.Name</option>
                                                            }
                                                        </InputSelect>
                                                        @if (!IsExistingBuildingSelected)
                                                        {
                                                            <ValidationMessage For="() => legalcaseDto.ExemptionReasonId" />
                                                        }

                                                    </div>
                                                }

                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          LandLordTypeList="LandLordTypeList"
                                          RegulationList="RegulationList"
                                          CurrentStep="CurrentStep"
                                          Steps="Steps" />


                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }

            @* TENANT *@
            @if (Steps[CurrentStep].Name == "Tenant")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <div style="font-weight:700" class="head">Tenant / Occupant</div>
                                    @* <div class="hint">Add multiple tenants and undertenants</div> *@
                                </div>

                                <div class="card-body">
                                    <!-- Unit / Apt -->
                                    <div class="row">
                                        @if (Tenants.Count > 0)
                                        {

                                            <button type="button" class="btn-close position-absolute top-3 end-0 m-2 fs-6"
                                                    aria-label="Close"
                                                    @onclick="ClearSelecteedTenant" title="Click here for tenant reset">
                                            </button>
                                        }
                                        <div class="col-md-6 position-relative" @onfocusout="HideTenantDropDown">
                                            <label class=@(selectedtenant == null ? "form-label required-label" : "form-label")>Unit / Apt # (confirm)</label>
                                            <input type="text" class="form-control" autocomplete="off"
                                                   placeholder="Search or Enter Unit / Apt"
                                                   @bind-value="searchTenantText"
                                                   @oninput="OnSearchTenantInput" @onblur="SelectTenant" @onclick="ShowAllTenantForHoldover" />
                                            @if (filteredTenant?.Any() == true)
                                            {
                                                <ul class="dropdown-menu show" style="position: absolute; width:94% !important; cursor:pointer;">
                                                    @foreach (var c in filteredTenant)
                                                    {
                                                        <li class="dropdown-item" @onclick="() => SelectedTenant(c)">
                                                            @c.UnitOrApartmentNumber / @c.FirstName @c.LastName
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                            <ValidationMessage For="() => legalcaseDto.TenantId" />
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="form-check form-switch" style="padding-left:10px">

                                            <label class="form-check-label  form-label mb-0 me-2" for="primaryResidenceSwitch">
                                                <span class="required-label"></span> Primary Residence?:

                                            </label>
                                            <input class="form-check-input"
                                                   type="checkbox"
                                                   id="ownerOccupiedSwitch"
                                                   @bind="legalcaseDto.PrimaryResidence" />
                                        </div>
                                        <ValidationMessage For="() => legalcaseDto.PrimaryResidence" />


                                    </div>
                                   @*  <div class="row mt-3">
                                        <div class="col-auto" style="display: flex;
                                                                                            justify-content: center;
                                                                                            align-items: flex-end;">
                                            <label class="form-label  fw-semibold">
                                                Tenancy Type
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <InputSelect class="form-select" @bind-Value="TenancytypeId">
                                                <option value="">-- Select --</option>
                                                @foreach (var s in TenancyTypeList)
                                                {
                                                    <option value="@s.Id">@s.Name</option>
                                                }
                                            </InputSelect>
                                            

                                        </div>

                                    </div> *@
                                    <div class="row mt-3">
                                        <div class="col-12 row">
                                            <label class=@(selectedtenant == null ? "lbl required-label" : "lbl")>Tenants</label>
                                            @if (Tenants.Count > 0)
                                            {

                                                @foreach (var tenant in Tenants.Select((t, i) => new { t, i }))
                                                {

                                                    <div class="col-11">
                                                        <input class="form-control mb-2"
                                                               placeholder="Tenant Full Name"
                                                               @bind-value="Tenants[tenant.i]"
                                                               @onblur="() => OnchangeAdditionalTenant(tenant.i)" />
                                                    </div>
                                                    if (tenant.i > 0)
                                                    {
                                                        <div class="col-1">
                                                            <button type="button"
                                                                    class="btn btn-delete" style="border :none;"
                                                                    @onclick="@(() => DeleteAdditionalTenant(tenant.i))">
                                                                <i class="fa-solid fa-xmark"></i>
                                                            </button>
                                                        </div>
                                                    }


                                                }


                                            }
                                            <ValidationMessage For="() => legalcaseDto.TenantName" />
                                            <div class="col-5">
                                                <button class="btn btn-sm btn-primary btn-tenant mt-2" @onclick="AddTenant">＋ Add Tenant</button>
                                            </div>
                                        </div>

                                        <div class="col-12 row mt-3">
                                            <label class="lbl">Undertenants / Other Occupants</label>
                                            @if (Undertenants.Count > 0)
                                            {

                                                @foreach (var undertenant in Undertenants.Select((t, i) => new { t, i }))
                                                {
                                                    <div class="col-11">
                                                        <input class="form-control mb-2"
                                                               placeholder="Other Occupant Name"
                                                               @bind-value="Undertenants[undertenant.i]"
                                                               @onblur="() => OnchangeAdditionalOccupants(undertenant.i)" />
                                                    </div>

                                                    <div class="col-1">
                                                        <button type="button"
                                                                class="btn btn-delete" style="border :none;"
                                                                @onclick="@(() => DeleteAdditionalOccupant(undertenant.i))">
                                                            <i class="fa-solid fa-xmark"></i>
                                                        </button>
                                                    </div>
                                                }
                                            }
                                            <div class="col-5">
                                                <button class="btn btn-sm btn-primary btn-tenant mt-2" @onclick="AddUnder">＋ Add Undertenant/Occupant</button>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mt-3 g-3">
                                        <div class="col-md-4">
                                            <label class="form-label required-label">Rent Due Frequency</label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.RentDueEachMonthOrWeekId" >
                                                <option value="">-- Select --</option>
                                                @foreach (var l in DateRentList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                            <ValidationMessage For="() => legalcaseDto.RentDueEachMonthOrWeekId" />
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label required-label">Monthly Rent ($)</label>
                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.MonthlyRent"  />
                                            @* <ValidationMessage For="() => noticeModel.MonthlyRent" /> *@
                                            <ValidationMessage For="() => legalcaseDto.MonthlyRent" />


                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label">Tenant's Share ($)</label>
                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.TenantShare"  />
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label required-label">Tenancy Type</label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.TenancyTypeId" @bind-Value:after="CalcNoticeDays" >
                                                <option value="">-- Select --</option>
                                                @foreach (var t in TenancyTypeList)
                                                {
                                                    <option value="@t.Id">@t.Name</option>
                                                }
                                            </InputSelect>
                                            <ValidationMessage For="() => legalcaseDto.TenancyTypeId" />

                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label">Last Payment Date</label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; "  @bind-Value="legalcaseDto.LastPaymentDate" @bind-Value:after="GenerateMonths" />
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label">Last Payment Amount ($)</label>
                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.LastPayment" />
                                        </div>
                                        @if (legalcaseDto.CaseTypeName == "NonPayment")
                                        {
                                            <div class="col-md-4">
                                                <label class="form-label ">Lease Start </label>
                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; "  @bind-Value="legalcaseDto.LeaseStart" />

                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label ">Lease End </label>
                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " disabled @bind-Value="legalcaseDto.LeaseEnd" />

                                            </div>
                                            @*  <div class="col-md-4">
                                                <label class="form-label" style="align-items: center;display: flex;height: 36px;">Written Lease?</label>
                                                <div class="d-flex justify-content-start align-items-center  gap-2">
                                                    <InputRadioGroup @bind-Value="legalcaseDto.WrittenLease">
                                                        <div class="form-check d-flex justify-content-center gap-2">
                                                            <InputRadio class="form-check-input" Value="true" style="font-size:15px" />
                                                            <label class="form-check-label">Yes</label>
                                                        </div>
                                                        <div class="form-check  d-flex justify-content-center gap-2">
                                                            <InputRadio class="form-check-input " Value="false" style="font-size:15px" />
                                                            <label class="form-check-label">No</label>
                                                        </div>
                                                    </InputRadioGroup>
                                                </div>
                                            </div> *@
                                        }

                                    </div>

                                    <div class="row g-2 mt-2">
                                        <div class="col">
                                            <label class="form-label">Rent Breakup</label>
                                            <div class="total-box mt-1">
                                                <label class="form-label " style="font-size:14px; font-weight:300; margin-bottom:0px;">Total Owed: $ @(legalcaseDto.TotalOwed ?? 00)</label>
                                            </div>

                                            @foreach (var item in Rows)
                                            {
                                                <div class="row mb-3">
                                                    <div class="col-4">
                                                        <label class="form-label ">Month (YYYY-MM) </label>
                                                        <InputSelect class="form-select holdover-form" 
                                                                     @bind-Value="item.Month"
                                                                     @bind-Value:after="(() => OnMonthChanged(item))">

                                                            <option value="">Select month</option>

                                                            @foreach (var m in MonthOptions)
                                                            {
                                                                <option value="@m.Value">@m.Display</option>
                                                            }

                                                        </InputSelect>
                                                    </div>
                                                    <div class="col-3">
                                                        <label class="form-label  ">Amount ($) </label>
                                                        <InputNumber @bind-Value="item.Amount" @bind-Value:after="RecalculateTotal" 
                                                                     class="form-control" />
                                                    </div>

                                                    <div class="col-3">
                                                        <label class="form-label  ">Notes </label>
                                                        <InputText @bind-Value="item.Notes"
                                                                   class="form-control" placeholder="Partial, vouchers, etc."  />
                                                    </div>

                                                    @*  <div class="col-2" style="justify-content:end; display:flex;">
                                                                        <button type="button" class="remove-btn" @onclick="(() => RemoveRow(item))">
                                                                            <i class="fa-solid fa-xmark"></i>
                                                                        </button>
                                                                    </div> *@


                                                </div>
                                            }

                                            @* <button type="button" class="add-btn" @onclick="AddRow">
                                                                + Add Month
                                                            </button> *@
                                        </div>
                                    </div>



                                </div>
                            </div>



                        </div>
                        <div class="col-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          IsUnitIllegalList="IsUnitIllegalList"
                                          CurrentStep="CurrentStep"
                                          Steps="Steps" />



                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }

            @* Term *@
            @if (Steps[CurrentStep].Name == "Terms")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div style="font-weight:700" class="head">Terms</div>
                                    <div class="hint">Move‑in date controls 30/60/90. Tenancy type only controls special 10‑day.</div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-2">

                                        <!-- Written Lease -->
                                        <div class="col-md-4">
                                            <label class="form-label">Written Lease?</label>
                                            <div class="d-flex justify-content-start align-items-center  gap-2">
                                                <InputRadioGroup @bind-Value="legalcaseDto.WrittenLease">
                                                    <div class="form-check d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input" Value="true" style="font-size:15px" />
                                                        <label class="form-check-label">Yes</label>
                                                    </div>
                                                    <div class="form-check  d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input " Value="false" style="font-size:15px" />
                                                        <label class="form-check-label">No</label>
                                                    </div>
                                                </InputRadioGroup>
                                            </div>
                                        </div>

                                        <!-- Oral Start -->
                                        @* <div class="col-md-4">
                                    <label class="form-label">Oral Aggrement</label>
                                    <InputRadioGroup @bind-Value="legalcaseDto.OralAgreeMent">
                                        <div class="form-check d-flex justify-content-center gap-2">
                                            <InputRadio class="form-check-input" Value="true" />
                                            <label class="form-check-label">Yes</label>
                                        </div>
                                        <div class="form-check  d-flex justify-content-center gap-2">
                                            <InputRadio class="form-check-input " Value="false" />
                                            <label class="form-check-label">No</label>
                                        </div>
                                    </InputRadioGroup>
                                </div> *@
                                        <div class="col-md-4">
                                            <label class="form-label">Oral Aggrement</label>
                                            <div class="d-flex justify-content-start align-items-center  gap-2" style="cursor:pointer;">
                                                <InputRadioGroup @bind-Value="legalcaseDto.OralAgreeMent">
                                                    <div class="form-check d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input" Value="true" style="font-size:15px" />
                                                        <label class="form-check-label">Yes</label>
                                                    </div>
                                                    <div class="form-check  d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input " Value="false" style="font-size:15px" />
                                                        <label class="form-check-label">No</label>
                                                    </div>
                                                </InputRadioGroup>
                                            </div>
                                        </div>

                                        <!-- Oral End -->
                                        <div class="col-md-4">
                                            <label class="form-label">Program</label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CaseProgramId" style="cursor:pointer;">
                                                <option value="">-- Select --</option>
                                                @foreach (var l in CaseProgramList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                            <ValidationMessage For="() => legalcaseDto.CaseProgramId" />
                                        </div>

                                    </div>
                                    <div class="row g-2 mt-2">
                                        <!-- Date Tenant Moved -->
                                        <div class="col-md-4">
                                            <label class="form-label">Good Cause Applies?</label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.GoodCauseApplies" style="cursor:pointer;">
                                                <option value="false">No (Exempt)</option>
                                                <option value="true">Yes (Owner ≥ 10)</option>
                                            </InputSelect>

                                        </div>

                                        <!-- Rent Due Day -->
                                        <div class="col-md-4">
                                            <label class="form-label required-label ">Move In Date </label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%" @bind-Value="legalcaseDto.DateTenantMoved" Max="@DateTime.Today" @bind-Value:after="CalcNoticeDays" />
                                            <ValidationMessage For="() => legalcaseDto.DateTenantMoved" />
                                        </div>

                                        <!-- Monthly Rent -->
                                        <div class="col-md-4">
                                            <label class="form-label ">Lease End (If any) </label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LeaseEnd" />

                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>


                        <div class="col-md-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          TenancyTypeList="TenancyTypeList"
                                          DateRentList="DateRentList"
                                          CaseProgramList="CaseProgramList"
                                          CurrentStep="CurrentStep"
                                          Steps="Steps" />
                            <TipsSummary />
                        </div>
                    </div>

                </div>
            }

            @* CASE *@
            @if (Steps[CurrentStep].Name == "Case")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div style="font-weight:700" class="head">Case</div>
                                    <div class="hint">Pick the holdover scenario.</div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-2">
                                        <!-- Tenancy Type -->
                                        <div class="col-md-4">
                                            <label class="form-label required-label">Tenancy Type</label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.TenancyTypeId" @bind-Value:after="CalcNoticeDays" style="cursor:pointer;">
                                                <option value="">-- Select --</option>
                                                @foreach (var l in TenancyTypeList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                            <ValidationMessage For="() => legalcaseDto.TenancyTypeId" />
                                        </div>



                                        <!-- Oral Start -->
                                        <div class="col-md-4">
                                            <label class="form-label required-label">Date Notice Served</label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.DateNoticeServed" @bind-Value:after="CalcExpireAligned" />
                                            <ValidationMessage For="() => legalcaseDto.DateNoticeServed" />

                                        </div>

                                        <!-- Oral End -->
                                        <div class="col-md-4">
                                            <label class="form-label">Calculated Notice Length</label>
                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.CalculatedNoticeLength" />
                                        </div>

                                    </div>
                                    <div class="row g-2 mt-2">
                                        <!-- Expiration Date -->
                                        <div class="col-md-4">
                                            <label class="form-label" style="height: 36px;
                                                                                                                                                                        display: flex;
                                                                                                                                                                        align-items: center;">Expiration Date (Auto)</label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%;" @bind-Value="legalcaseDto.ExpirationDate" />

                                        </div>

                                        <!-- Predicate -->
                                        <div class="col-md-4">
                                            <label class="form-label " style="height: 36px;
                                                                                                                                                                                display: flex;
                                                                                                                                                                                align-items: center;">Predicate Notice (Auto) </label>
                                            <InputText class="form-control" @bind-Value="legalcaseDto.PredicateNotice" />

                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Good Cause Exemption Notice attached</label>
                                            <div class="d-flex justify-content-start align-items-center  gap-2">
                                                <InputRadioGroup @bind-Value="legalcaseDto.GoodCauseExempt">
                                                    <div class="form-check d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input" Value="true" style="font-size:15px" />
                                                        <label class="form-check-label">Yes</label>
                                                    </div>
                                                    <div class="form-check  d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input " Value="false" style="font-size:15px" />
                                                        <label class="form-check-label">No</label>
                                                    </div>
                                                </InputRadioGroup>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row g-2 mb-3 mt-3">

                                        <!-- Notice type -->
                                        <div class="col-md-3">

                                            <div class="form-check d-flex justify-content-center gap-2">
                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.leasedAttached" />
                                                <label class="form-check-label"> Leased Attached </label>
                                            </div>
                                        </div>

                                        <div class="col-md-3">
                                            <div class="form-check d-flex justify-content-center gap-2">
                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.ledgerAttached" />
                                                <label class="form-check-label"> Ledger attached </label>
                                            </div>

                                        </div>
                                        <div class="col-md-3">

                                            <div class="form-check d-flex justify-content-center gap-2">
                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.NoticeproofAttached" />
                                                <label class="form-check-label"> Notices proof attached </label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">

                                            <div class="form-check d-flex justify-content-center gap-2">
                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.RegistrationRentAttached" />
                                                <label class="form-check-label">Registration/Rent history attached</label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row g-2 mb-3">



                                        <div class="col">
                                            <label class="form-label ">Additional Comments </label>
                                            <InputText class="form-control" @bind-Value="legalcaseDto.AdditionalComments" style="cursor:pointer;" />

                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>


                        <div class="col-md-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          TenancyTypeList="TenancyTypeList"
                                          DateRentList="DateRentList"
                                          CurrentStep="CurrentStep"
                                          Steps="Steps" />
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }

            @* RENT *@

            @if (Steps[CurrentStep].Name == "Rent")
            {
                <div class="row">
                    <div class="col-md-8">
                        <div class="card mb-3">
                            <div class="card-header fw-bold head">Rent Details</div>
                            <div class="card-body">
                                <div class="row g-2">

                                    <!-- Rent Due Day -->
                                    <div class="col-md-4">
                                        <label class="form-label  required-label">Date Rent  Due (Month/Week) </label>
                                        <InputSelect class="form-select" @bind-Value="legalcaseDto.RentDueEachMonthOrWeekId" style="cursor:pointer;">
                                            <option value="">-- Select --</option>
                                            @foreach (var l in DateRentList)
                                            {
                                                <option value="@l.Id">@l.Name</option>
                                            }
                                        </InputSelect>
                                        <ValidationMessage For="() => legalcaseDto.RentDueEachMonthOrWeekId" />
                                    </div>

                                    <!-- Monthly Rent -->
                                    <div class="col-md-4">
                                        <label class="form-label  required-label">Monthly Rent ($) </label>
                                        <InputNumber class="form-control" @bind-Value="legalcaseDto.MonthlyRent" placeholder="Enter Monthly Rent" />
                                        <ValidationMessage For="() => legalcaseDto.MonthlyRent" />
                                    </div>

                                    <!-- Tenant's Share -->
                                    <div class="col-md-4">
                                        <label class="form-label">Tenant's Share ($)</label>
                                        <InputNumber class="form-control" @bind-Value="legalcaseDto.TenantShare" placeholder="Enter Total Share" min="0" />

                                    </div>


                                </div>

                                <div class="row g-2 mt-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Social Services (If any)</label>
                                        <InputText class="form-control" @bind-Value="legalcaseDto.SocialService" placeholder="Enter Social Service" />

                                    </div>

                                    @* <div class="col-md-4">
                                        <label class="form-label">Unpaid Rent (Months) </label>
                                        <InputText class="form-control"
                                                   @bind-Value="legalcaseDto.LastRentPaid"
                                                   placeholder="Enter  unpaid months" @bind-Value:after="FormatLastRentPaid" />
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Total Rent Owed ($)</label>
                                        <InputNumber class="form-control" @bind-Value="legalcaseDto.TotalOwed" placeholder="Enter Total Rent" min="0" />

                                    </div> *@
                                    <div class="col-md-4">
                                        <label class="form-label ">Date of Last Payment </label>
                                        <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LastPaymentDate" @bind-Value:after="GenerateMonths" />

                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Amount of Last Payment ($)</label>
                                        <InputNumber class="form-control" @bind-Value="legalcaseDto.LastPayment" min="0" />

                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col">
                                        <label class="form-label">Rent Breakup</label>
                                        <div class="total-box mt-1">
                                            <label class="form-label " style="font-size:14px; font-weight:300; margin-bottom:0px;">Total Owed: $ @(legalcaseDto.TotalOwed ?? 00)</label>
                                        </div>

                                        @foreach (var item in Rows)
                                        {
                                            <div class="row mb-3">
                                                <div class="col-3">
                                                    <label class="form-label ">Month (YYYY-MM) </label>
                                                    <InputSelect class="form-select holdover-form"
                                                                 @bind-Value="item.Month"
                                                                 @bind-Value:after="(() => OnMonthChanged(item))">

                                                        <option value="">Select month</option>

                                                        @foreach (var m in MonthOptions)
                                                        {
                                                            <option value="@m.Value">@m.Display</option>
                                                        }

                                                    </InputSelect>
                                                </div>
                                                <div class="col-3">
                                                    <label class="form-label  ">Amount ($) </label>
                                                    <InputNumber @bind-Value="item.Amount" @bind-Value:after="RecalculateTotal"
                                                                 class="form-control" />
                                                </div>

                                                <div class="col-3">
                                                    <label class="form-label  ">Notes </label>
                                                    <InputText @bind-Value="item.Notes"
                                                               class="form-control" placeholder="Partial, vouchers, etc." />
                                                </div>

                                                <div class="col-3" style="justify-content:end; display:flex;">
                                                    <button class="remove-btn" @onclick="(() => RemoveRow(item))">
                                                        × Remove
                                                    </button>
                                                </div>


                                            </div>
                                        }

                                        <button class="add-btn" @onclick="AddRow">
                                            + Add Month
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="col-md-4">
                        <CasesSummary LegalCase="legalcaseDto"
                                      TenancyTypeList="TenancyTypeList"
                                      DateRentList="DateRentList"
                                      CurrentStep="CurrentStep" Steps="Steps" />
                        <TipsSummary />
                    </div>
                </div>


            }

            @* Notice *@
            @if (Steps[CurrentStep].Name == "Notice" && legalcaseDto.CaseTypeName == "Holdover")
            {
                <div class="row">
                    <div class="col-md-12">
                        @*  <section class="card">
                        <header>
                            <div class="k">8</div>
                            <div>
                                <div style="font-weight:700">Notice Selector</div>
                                <div class="hint">Auto-selected predicate & merge preview</div>
                            </div>
                        </header>
                        <div class="body">
                            <div class="fields cols-2">
                                <div>
                                    <div class="pill">Selected: <strong id="selLabel">—</strong></div>
                                    <p class="hint" style="margin-top:8px">
                                        Move‑in → 30/60/90. Tenancy type → only special 10‑day. Expiration
                                        aligns to rent due day (default 1st).
                                    </p>
                                </div>
                                <div>
                                    <div class="pill">Export</div>
                                    <p class="hint" style="margin-top:8px">
                                        On submit, send <code>predicate</code> + <code>merge</code> to your
                                        doc engine.
                                    </p>
                                </div>
                            </div>
                            <div class="pre"><pre>@System.Text.Json.JsonSerializer.Serialize(MergeData, new System.Text.Json.JsonSerializerOptions { WriteIndented = true })</pre></div>


                        </div>
                    </section> *@
                    </div>



                </div>


            }

            @* Lease Nonpayement*@
            @if (Steps[CurrentStep].Name == "Lease")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div style="font-weight:700" class="head"> Lease & Assistance</div>
                                    @* <div class="hint">Used to populate petition & notices</div> *@
                                </div>
                                <div class="card-body">
                                    <div class="row g-2 mb-3">

                                        <!-- Written Lease -->
                                        <div class="col-md-4">
                                            <label class="form-label ">Lease Start </label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LeaseStart" />

                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label ">Lease End </label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LeaseEnd" />

                                        </div>


                                        <!-- Monthly Rent -->
                                        <div class="col-md-4">
                                            <label class="form-label ">Monthly Rent ($) </label>
                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.MonthlyRent" />
                                            <ValidationMessage For="() => legalcaseDto.MonthlyRent" />
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label ">Date Rent  Due (Month/Week) </label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.RentDueEachMonthOrWeekId" style="cursor:pointer;">
                                                <option value="">-- Select --</option>
                                                @foreach (var l in DateRentList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                            <ValidationMessage For="() => legalcaseDto.RentDueEachMonthOrWeekId" />
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label ">Date of Last Payment </label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LastPaymentDate" @bind-Value:after="GenerateMonths" />

                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Amount of Last Payment ($)</label>
                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.LastPayment" min="0" />

                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-4">
                                            <label class="form-label" style="align-items: center;display: flex;height: 36px;">Written Lease?</label>
                                            <div class="d-flex justify-content-start align-items-center  gap-2">
                                                <InputRadioGroup @bind-Value="legalcaseDto.WrittenLease">
                                                    <div class="form-check d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input" Value="true" style="font-size:15px" />
                                                        <label class="form-check-label">Yes</label>
                                                    </div>
                                                    <div class="form-check  d-flex justify-content-center gap-2">
                                                        <InputRadio class="form-check-input " Value="false" style="font-size:15px" />
                                                        <label class="form-check-label">No</label>
                                                    </div>
                                                </InputRadioGroup>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label " style="align-items: center;display: flex;height: 36px;">Tenancy Type</label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.TenancyTypeId" @bind-Value:after="CalcNoticeDays" style="cursor:pointer;">
                                                <option value="">-- Select --</option>
                                                @foreach (var l in TenancyTypeList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                            <ValidationMessage For="() => legalcaseDto.TenancyTypeId" />
                                        </div>
                                        <!-- Oral Start -->
                                        <div class="col-md-4">
                                            <label class="form-label ">Assistance (Section 8 / SCRIE/DRIE / other) </label>
                                            <InputText class="form-control" @bind-Value="legalcaseDto.Assistance" />

                                        </div>


                                    </div>

                                    <div class="row g-2 mt-2">
                                        <div class="col">
                                            <label class="form-label">Arrear Ledger</label>
                                            <div class="total-box mt-2">
                                                <label class="form-label " style="font-size:14px; font-weight:300; margin-bottom:0px;">Total Owed: $ @(legalcaseDto.TotalOwed ?? 00)</label>
                                            </div>

                                            @foreach (var item in Rows)
                                            {
                                                <div class="row mb-3">
                                                    <div class="col-3">
                                                        <label class="form-label ">Month (YYYY-MM) </label>
                                                        <InputSelect class="form-select holdover-form"
                                                                     @bind-Value="item.Month"
                                                                     @bind-Value:after="(() => OnMonthChanged(item))">

                                                            <option value="">Select month</option>

                                                            @foreach (var m in MonthOptions)
                                                            {
                                                                <option value="@m.Value">@m.Display</option>
                                                            }

                                                        </InputSelect>
                                                    </div>
                                                    <div class="col-3">
                                                        <label class="form-label  ">Amount ($) </label>
                                                        <InputNumber @bind-Value="item.Amount" @bind-Value:after="RecalculateTotal"
                                                                     class="form-control" />
                                                    </div>

                                                    <div class="col-3">
                                                        <label class="form-label  ">Notes </label>
                                                        <InputText @bind-Value="item.Notes"
                                                                   class="form-control" placeholder="Partial, vouchers, etc." />
                                                    </div>

                                                    <div class="col-3" style="justify-content:end; display:flex;">
                                                        <button class="remove-btn" @onclick="(() => RemoveRow(item))">
                                                            × Remove
                                                        </button>
                                                    </div>


                                                </div>
                                            }

                                            <button class="add-btn" @onclick="AddRow">
                                                + Add Month
                                            </button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="col-md-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          TenancyTypeList="TenancyTypeList"
                                          DateRentList="DateRentList"
                                          CaseProgramList="CaseProgramList"
                                          CurrentStep="CurrentStep"
                                          Steps="Steps" />
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }



            @if (Steps[CurrentStep].Name == "Review")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col" style="overflow:auto; height:570px;">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div style="font-weight:700" class="head">Review</div>
                                </div>
                                <div class="card-body">
                                    <!--caseandclient-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header fw-bold head">Case Information</div>
                                                <div class="card-body">
                                                    <div class="row g-3">



                                                        <div class=" p-3 position-relative mt-3">


                                                            <div class="row g-3">
                                                                <div class="col-4">
                                                                    <label class="form-label  ">Client Name</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Name"
                                                                               @bind-Value="legalcaseDto.ClientName" disabled />
                                                                    <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label">Phone</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Number"
                                                                               @bind-Value="legalcaseDto.ClientPhone" disabled />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label  ">Client Type</label>
                                                                    <InputSelect class="form-select"
                                                                                 @bind-Value="legalcaseDto.ClientTypeId" disabled>
                                                                        <option value="">-- Select --</option>
                                                                        @foreach (var Own in ClientTypeList)
                                                                        {
                                                                            <option value="@Own.Id">@Own.Name</option>
                                                                        }
                                                                    </InputSelect>
                                                                    <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                                </div>





                                                                <div class="col-6">
                                                                    <label class="form-label  ">Email</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Email"
                                                                               @bind-Value="legalcaseDto.ClientEmail" disabled />
                                                                    <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label">Reference #</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Reference"
                                                                               @bind-Value="legalcaseDto.Reference" disabled />
                                                                </div>



                                                                @if (IsNewClient)
                                                                {
                                                                    <div class="col-9">
                                                                        <label class="form-label">Address</label>
                                                                        <InputText class="form-control"
                                                                                   placeholder="Enter Address"
                                                                                   @bind-Value="legalcaseDto.ClientAddress" />
                                                                    </div>
                                                                }
                                                            </div>
                                                        </div>



                                                        @*  <!-- NEW CLIENT TEXTBOX FORM -->
                                                    @if (showClientTextbox)
                                                    {


                                                        <div class="card p-3 position-relative">
                                                            <button type="button"
                                                                    class="btn-close position-absolute top-0 end-0 m-2"
                                                                    @onclick="ClearSelectedClient" title=" Click here for lanlord reset">
                                                            </button>

                                                            <div class="row g-3">

                                                                <div class="col-4">
                                                                    <label class="form-label  ">Client Name</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Name"
                                                                               @bind-Value="legalcaseDto.ClientName" />
                                                                    <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label">Phone</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Number"
                                                                               @bind-Value="legalcaseDto.ClientPhone" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label  ">Client Type</label>
                                                                    <InputSelect class="form-select"
                                                                                 @bind-Value="legalcaseDto.ClientTypeId">
                                                                        <option value="">-- Select Type --</option>
                                                                        @foreach (var Own in ClientTypeList)
                                                                        {
                                                                            <option value="@Own.Id">@Own.Name</option>
                                                                        }
                                                                    </InputSelect>
                                                                    <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                                </div>
                                                                <div class="col-6">
                                                                    <label class="form-label  ">Email</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Email"
                                                                               @bind-Value="legalcaseDto.ClientEmail" />
                                                                    <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label">Reference #</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Reference"
                                                                               @bind-Value="legalcaseDto.Reference" />
                                                                </div>

                                                                @if (IsNewClient)
                                                                {
                                                                    <div class="col-8">
                                                                        <label class="form-label">Address</label>
                                                                        <InputText class="form-control"
                                                                                   placeholder="Enter Address"
                                                                                   @bind-Value="legalcaseDto.ClientAddress" />
                                                                    </div>
                                                                }

                                                            </div>
                                                        </div>
                                                    } *@

                                                    </div>



                                                </div>
                                            </div>
                                        </div>

                                        <!-- Right side summary -->

                                    </div>

                                    <!--Landlord-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header fw-bold head">Landlord Information</div>
                                                <div class="card-body ">


                                                    <div class="row mt-2 align-items-center">

                                                        <!-- align-items-end vertically bottom align -->
                                                        <div class="col-md-6 position-relative" @onfocusout="HideLandlordsDropDown">
                                                            <label class="form-label  ">Landlord / Owner Name</label>

                                                            <InputText type="text" class="form-control"
                                                                       placeholder="Enter Landlord name"
                                                                       @bind-value="searchlandlordText"
                                                                       @onblur="saveLandLordName" disabled />

                                                        </div>

                                                    </div>

                                                    <div class=@(selectedlandlord != null ? " p-3 position-relative " : " position-relative")>

                                                        <div class="row mt-1">
                                                            <div class="col-md-6">
                                                                <label class="form-label   ">Contact Person </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.ContactPersonName" placeholder="Enter Contact Person" disabled />
                                                                @if (!IsLandlordSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.ContactPersonName" />
                                                                }
                                                            </div>
                                                            <div class="col-md-6 ">
                                                                <label class="form-label   ">Landlord Address </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.LandlordAddress" placeholder="Enter Address" disabled />
                                                                @if (!IsLandlordSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.LandlordAddress" />
                                                                }
                                                            </div>

                                                        </div>

                                                    </div>


                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--Building-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header fw-bold head ">Building Information</div>
                                                <div class="card-body row ">


                                                    @* <div class="row mt-2">

                                                    @if (!IsNewBuilding && !isBuildingSelected)
                                                    {
                                                        <div class="col-md-6 position-relative" @onfocusout="HideBuildingDropdown">
                                                            <label class="form-label   ">Building</label>
                                                            <input type="text" class="form-control"
                                                                   placeholder="Search by Building Address or code..."
                                                                   @bind-value="searchBuildingText"
                                                                   @oninput="OnSearchBuildingInput"
                                                                   @onclick="ShowAllBuildings" />
                                                            @if (filteredBuildings?.Any() == true)
                                                            {
                                                                <ul class="dropdown-menu show" style="position: absolute; width:94% !important; cursor:pointer;">
                                                                    @foreach (var c in filteredBuildings)
                                                                    {
                                                                        <li class="dropdown-item" @onclick="() => SelectBuilding(c)">
                                                                            @c.Address1 / @c.BuildingCode
                                                                        </li>
                                                                    }
                                                                </ul>
                                                            }
                                                            <div style="min-height:1.5em; margin-top:4px">

                                                                <ValidationMessage For="() => legalcaseDto.BuildingId" />
                                                            </div>

                                                        </div>
                                                        <div class="col-md-4 d-flex align-items-center">
                                                            <!-- bottom align -->
                                                            @if (!showBuildingfields)
                                                            {
                                                                <div class="w-100 d-flex gap-3  align-items-center">
                                                                    <span class="fw-bold mt-1">OR</span>
                                                                    <button type="button" class="btn"
                                                                            style="background-color:#1F365D; color:white"
                                                                            @onclick="OnBindBuldingAfter">
                                                                        + ADD
                                                                    </button>
                                                                </div>
                                                            }
                                                        </div>

                                                    }



                                                </div> *@


                                                    <div class=" p-2 position-relative">

                                                        <div class="row mt-2">
                                                            <div class="col-6">
                                                                <label class="form-label   ">Street Address </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.BuildingAddress" placeholder="Enter Address" disabled />

                                                                @if (!isBuildingSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.BuildingAddress" />
                                                                }
                                                            </div>

                                                            <div class="col-md-6">
                                                                <label class="form-label   ">MDR Number </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.Mdr" placeholder="Enter MDR Number" disabled />

                                                                @if (!isBuildingSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.Mdr" />
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="row mt-4">
                                                            <div class="col-md-4">
                                                                <label class="form-label   ">County </label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.BoroughorCityId" style="cursor:pointer;" disabled>
                                                                    <option value="">-- Select --</option>
                                                                    @foreach (var s in CityList)
                                                                    {
                                                                        <option value="@s.Id">@s.Name</option>
                                                                    }
                                                                </InputSelect>
                                                                @if (!isBuildingSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.BoroughorCityId" />
                                                                }
                                                            </div>

                                                            <div class="col-md-4">
                                                                <label class="form-label  ">Units </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.Units" placeholder="Enter Units" disabled />

                                                                @if (!isBuildingSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.Units" />
                                                                }
                                                            </div>
                                                            <div class="col-4">
                                                                <label class="form-label   ">Rent Regulation </label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.RegulationStatusId" style="cursor:pointer;" disabled>
                                                                    <option value="">-- Select --</option>
                                                                    @foreach (var l in RegulationList)
                                                                    {
                                                                        <option value="@l.Id">@l.Name</option>
                                                                    }
                                                                </InputSelect>
                                                                @if (!isBuildingSelected)
                                                                {
                                                                    <ValidationMessage For="() => legalcaseDto.RegulationStatusId" />
                                                                }

                                                            </div>
                                                        </div>
                                                        @if (IsNewBuilding)
                                                        {
                                                            <div class="row mt-4">
                                                                <div class="col-md-6">
                                                                    <label class="form-label   ">State </label>
                                                                    <InputSelect class="form-select" @bind-Value="legalcaseDto.BuildingStateId" style="cursor:pointer;" disabled>
                                                                        <option value="">-- Select --</option>
                                                                        @foreach (var s in StateList)
                                                                        {
                                                                            <option value="@s.Id">@s.Name</option>
                                                                        }
                                                                    </InputSelect>
                                                                    <ValidationMessage For="() => legalcaseDto.BuildingStateId" />
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="form-label   ">Zipcode </label>
                                                                    <InputText class="form-control" @bind-Value="legalcaseDto.BuildingZip" placeholder="Enter ZipCode" disabled />
                                                                    <ValidationMessage For="() => legalcaseDto.BuildingZip" />
                                                                </div>
                                                            </div>
                                                        }

                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <!--Tenant-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card">
                                                <div class="card-header">
                                                    <div style="font-weight:700" class="head">Tenant / Occupant</div>
                                                </div>

                                                <div class="card-body">
                                                    <!-- Unit / Apt -->
                                                    <div class="row">

                                                        <div class="col-md-6 position-relative" @onfocusout="HideTenantDropDown">
                                                            <label class="form-label   ">Unit / Apt # (confirm)</label>
                                                            <InputText type="text" class="form-control"
                                                                       placeholder="Search or Enter Unit / Apt"
                                                                       @bind-value="searchTenantText"
                                                                       @oninput="OnSearchTenantInput" @onblur="SelectTenant" @onclick="ShowAllTenantForHoldover" disabled />

                                                        </div>
                                                    </div>

                                                    <div class="row mt-3">
                                                        <div class="col-12">
                                                            <label class="lbl  ">Tenants</label>
                                                            @if (Tenants.Count > 0)
                                                            {

                                                                @foreach (var tenant in Tenants.Select((t, i) => new { t, i }))
                                                                {
                                                                    if (!string.IsNullOrEmpty(tenant.t))
                                                                    {
                                                                        <input class="form-control mb-2"
                                                                               placeholder="Tenant Full Name"
                                                                               @bind-value="Tenants[tenant.i]"
                                                                               @onblur="() => OnchangeAdditionalTenant(tenant.i)" disabled />
                                                                    }
                                                                }


                                                            }
                                                        </div>

                                                        <div class="col-12 mt-3">
                                                            <label class="lbl">Undertenants / Other Occupants</label>
                                                            @if (Undertenants.Count > 0)
                                                            {

                                                                @foreach (var undertenant in Undertenants.Select((t, i) => new { t, i }))
                                                                {
                                                                    if (!string.IsNullOrEmpty(undertenant.t))
                                                                    {
                                                                        <input class="form-control mb-2"
                                                                               placeholder="Other Occupant Full Name"
                                                                               @bind-value="Undertenants[undertenant.i]"
                                                                               @onblur="() => OnchangeAdditionalOccupants(undertenant.i)" disabled />
                                                                    }
                                                                }
                                                            }

                                                        </div>
                                                    </div>

                                                    <div class="row mt-3 g-3">
                                                        <div class="col-md-4">
                                                            <label class="form-label ">Rent Due Frequency</label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.RentDueEachMonthOrWeekId" disabled>
                                                                <option value="">-- Select --</option>
                                                                @foreach (var l in DateRentList)
                                                                {
                                                                    <option value="@l.Id">@l.Name</option>
                                                                }
                                                            </InputSelect>
                                                            <ValidationMessage For="() => legalcaseDto.RentDueEachMonthOrWeekId" />
                                                        </div>

                                                        <div class="col-md-4">
                                                            <label class="form-label ">Monthly Rent ($)</label>
                                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.MonthlyRent" disabled />
                                                            @* <ValidationMessage For="() => noticeModel.MonthlyRent" /> *@

                                                        </div>

                                                        <div class="col-md-4">
                                                            <label class="form-label">Tenant's Share ($)</label>
                                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.TenantShare" disabled />
                                                        </div>

                                                        <div class="col-md-4">
                                                            <label class="form-label ">Tenancy Type</label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.TenancyTypeId" @bind-Value:after="CalcNoticeDays" disabled>
                                                                <option value="">-- Select --</option>
                                                                @foreach (var t in TenancyTypeList)
                                                                {
                                                                    <option value="@t.Id">@t.Name</option>
                                                                }
                                                            </InputSelect>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <label class="form-label">Last Payment Date</label>
                                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " disabled  @bind-Value="legalcaseDto.LastPaymentDate" @bind-Value:after="GenerateMonths" />
                                                        </div>

                                                        <div class="col-md-4">
                                                            <label class="form-label">Last Payment Amount ($)</label>
                                                            <InputNumber class="form-control" @bind-Value="legalcaseDto.LastPayment" disabled />
                                                        </div>
                                                        @if (legalcaseDto.CaseTypeName == "NonPayment")
                                                        {
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Lease Start </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " disabled @bind-Value="legalcaseDto.LeaseStart" />

                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Lease End </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " disabled @bind-Value="legalcaseDto.LeaseEnd" />

                                                            </div>
                                                            @*  <div class="col-md-4">
                                                <label class="form-label" style="align-items: center;display: flex;height: 36px;">Written Lease?</label>
                                                <div class="d-flex justify-content-start align-items-center  gap-2">
                                                    <InputRadioGroup @bind-Value="legalcaseDto.WrittenLease">
                                                        <div class="form-check d-flex justify-content-center gap-2">
                                                            <InputRadio class="form-check-input" Value="true" style="font-size:15px" />
                                                            <label class="form-check-label">Yes</label>
                                                        </div>
                                                        <div class="form-check  d-flex justify-content-center gap-2">
                                                            <InputRadio class="form-check-input " Value="false" style="font-size:15px" />
                                                            <label class="form-check-label">No</label>
                                                        </div>
                                                    </InputRadioGroup>
                                                </div>
                                            </div> *@
                                                        }

                                                    </div>

                                                    <div class="row g-2 mt-2">
                                                        <div class="col">
                                                            <label class="form-label">Rent Breakup</label>
                                                            <div class="total-box mt-1">
                                                                <label class="form-label " style="font-size:14px; font-weight:300; margin-bottom:0px;">Total Owed: $ @(legalcaseDto.TotalOwed ?? 00)</label>
                                                            </div>

                                                            @foreach (var item in Rows)
                                                            {
                                                                <div class="row mb-3">
                                                                    <div class="col-4">
                                                                        <label class="form-label ">Month (YYYY-MM) </label>
                                                                        <InputSelect class="form-select holdover-form" disabled
                                                                                     @bind-Value="item.Month"
                                                                                     @bind-Value:after="(() => OnMonthChanged(item))">

                                                                            <option value="">Select month</option>

                                                                            @foreach (var m in MonthOptions)
                                                                            {
                                                                                <option value="@m.Value">@m.Display</option>
                                                                            }

                                                                        </InputSelect>
                                                                    </div>
                                                                    <div class="col-3">
                                                                        <label class="form-label  ">Amount ($) </label>
                                                                        <InputNumber @bind-Value="item.Amount" @bind-Value:after="RecalculateTotal" disabled
                                                                                     class="form-control" />
                                                                    </div>

                                                                    <div class="col-3">
                                                                        <label class="form-label  ">Notes </label>
                                                                        <InputText @bind-Value="item.Notes"
                                                                                   class="form-control" placeholder="Partial, vouchers, etc." disabled />
                                                                    </div>

                                                                    @*  <div class="col-2" style="justify-content:end; display:flex;">
                                                                        <button type="button" class="remove-btn" @onclick="(() => RemoveRow(item))">
                                                                            <i class="fa-solid fa-xmark"></i>
                                                                        </button>
                                                                    </div> *@


                                                                </div>
                                                            }

                                                            @* <button type="button" class="add-btn" @onclick="AddRow">
                                                                + Add Month
                                                            </button> *@
                                                        </div>
                                                    </div>



                                                </div>
                                            </div>



                                        </div>

                                    </div>
                                    @if (legalcaseDto.CaseTypeName == "NonPayment")
                                    {
                                        <!--Lease-->
                                        <div class="row mt-2">
                                            <div class="col">
                                                <div class="card mb-3">
                                                    <div class="card-header">
                                                        <div style="font-weight:700" class="head"> Lease & Assistance</div>
                                                        @* <div class="hint">Used to populate petition & notices</div> *@
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="row g-2 mb-3">

                                                            <!-- Written Lease -->
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Lease Start </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LeaseStart" disabled />

                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Lease End </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LeaseEnd" disabled />

                                                            </div>


                                                            <!-- Monthly Rent -->
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Monthly Rent ($) </label>
                                                                <InputNumber class="form-control" @bind-Value="legalcaseDto.MonthlyRent" disabled />
                                                                <ValidationMessage For="() => legalcaseDto.MonthlyRent" />
                                                            </div>
                                                        </div>
                                                        <div class="row g-2 mb-3">
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Date Rent  Due (Month/Week) </label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.RentDueEachMonthOrWeekId" style="cursor:pointer;" disabled>
                                                                    <option value="">-- Select --</option>
                                                                    @foreach (var l in DateRentList)
                                                                    {
                                                                        <option value="@l.Id">@l.Name</option>
                                                                    }
                                                                </InputSelect>
                                                                <ValidationMessage For="() => legalcaseDto.RentDueEachMonthOrWeekId" />
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Date of Last Payment </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LastPaymentDate" @bind-Value:after="GenerateMonths" disabled />

                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label">Amount of Last Payment ($)</label>
                                                                <InputNumber class="form-control" @bind-Value="legalcaseDto.LastPayment" min="0" disabled />

                                                            </div>
                                                        </div>
                                                        <div class="row g-2">
                                                            <div class="col-md-4">
                                                                <label class="form-label" style="align-items: center;display: flex;">Written Lease?</label>
                                                                <div class="d-flex justify-content-start align-items-center  gap-2">
                                                                    <InputRadioGroup @bind-Value="legalcaseDto.WrittenLease">
                                                                        <div class="form-check d-flex justify-content-center gap-2">
                                                                            <InputRadio class="form-check-input" Value="true" style="font-size:15px" disabled />
                                                                            <label class="form-check-label">Yes</label>
                                                                        </div>
                                                                        <div class="form-check  d-flex justify-content-center gap-2">
                                                                            <InputRadio class="form-check-input " Value="false" style="font-size:15px" disabled />
                                                                            <label class="form-check-label">No</label>
                                                                        </div>
                                                                    </InputRadioGroup>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label " style="align-items: center;display: flex;">Tenancy Type</label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.TenancyTypeId" @bind-Value:after="CalcNoticeDays" style="cursor:pointer;" disabled>
                                                                    <option value="">-- Select --</option>
                                                                    @foreach (var l in TenancyTypeList)
                                                                    {
                                                                        <option value="@l.Id">@l.Name</option>
                                                                    }
                                                                </InputSelect>
                                                                <ValidationMessage For="() => legalcaseDto.TenancyTypeId" />
                                                            </div>
                                                            <!-- Oral Start -->
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Assistance (Section 8 / SCRIE/DRIE / other) </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.Assistance" disabled />

                                                            </div>


                                                        </div>

                                                        <div class="row g-2 mt-2">
                                                            <div class="col">
                                                                <label class="form-label">Arrear Ledger</label>
                                                                <div class="total-box mt-2">
                                                                    <label class="form-label " style="font-size:14px; font-weight:300; margin-bottom:0px;">Total Owed: $ @(legalcaseDto.TotalOwed ?? 00)</label>
                                                                </div>

                                                                @foreach (var item in Rows)
                                                                {
                                                                    <div class="row mb-3">
                                                                        <div class="col-3">
                                                                            <label class="form-label ">Month (YYYY-MM) </label>
                                                                            <InputSelect class="form-select holdover-form"
                                                                                         @bind-Value="item.Month"
                                                                                         @bind-Value:after="(() => OnMonthChanged(item))" disabled>

                                                                                <option value="">Select month</option>

                                                                                @foreach (var m in MonthOptions)
                                                                                {
                                                                                    <option value="@m.Value">@m.Display</option>
                                                                                }

                                                                            </InputSelect>
                                                                        </div>
                                                                        <div class="col-3">
                                                                            <label class="form-label  ">Amount ($) </label>
                                                                            <InputNumber @bind-Value="item.Amount" @bind-Value:after="RecalculateTotal" disabled
                                                                                         class="form-control" />
                                                                        </div>

                                                                        <div class="col-3">
                                                                            <label class="form-label  ">Notes </label>
                                                                            <InputText @bind-Value="item.Notes"
                                                                                       class="form-control" placeholder="Partial, vouchers, etc." disabled />
                                                                        </div>

                                                                        @* <div class="col-3" style="justify-content:end; display:flex;">
                                                                        <button class="remove-btn" @onclick="(() => RemoveRow(item))">
                                                                            × Remove
                                                                        </button>
                                                                    </div> *@


                                                                    </div>
                                                                }

                                                                @* <button class="add-btn" @onclick="AddRow">
                                                                + Add Month
                                                            </button> *@

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>



                                        </div>

                                        <!--notices-->
                                        @*  <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header">
                                                    <div style="font-weight:700" class="head"> Predicate Notice Planner</div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-2 mb-3">

                                                        <!-- Notice type -->
                                                        <div class="col-md-4">
                                                            <label class="form-label ">Notice Type </label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.NoticeId" style="cursor:pointer;" disabled>
                                                                <option value="">-- Select Type --</option>
                                                                @foreach (var l in FilteredFormTypeList)
                                                                {
                                                                    <option value="@l.Id">@l.Name</option>
                                                                }
                                                            </InputSelect>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label ">Service Method </label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.ServiceMethodId" style="cursor:pointer;" disabled>
                                                                <option value="">-- Select Type --</option>
                                                                @foreach (var l in ServiceMethodList)
                                                                {
                                                                    <option value="@l.Id">@l.Name</option>
                                                                }
                                                            </InputSelect>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label ">Planned Service Date </label>
                                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.PlannedServiceDate" disabled />

                                                        </div>

                                                    </div>
                                                    <div class="row g-2 mb-3">
                                                        <div class="col-md-4">
                                                            <label class="form-label ">Deemed Service (Auto) </label>
                                                            <InputText class="form-control" @bind-Value="legalcaseDto.DeemedService" style="cursor:pointer;" disabled />

                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label ">Expiry (auto) </label>
                                                            <InputText class="form-control" Style="width:100%; box-shadow:none" @bind-Value="legalcaseDto.Expiry" disabled />

                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label">Roll to Next Business Day</label>
                                                            <div class="d-flex justify-content-start align-items-center  gap-2">
                                                                <InputRadioGroup @bind-Value="legalcaseDto.NextBussinessday" disabled>
                                                                    <div class="form-check d-flex justify-content-center gap-2">
                                                                        <InputRadio class="form-check-input" Value="true" style="font-size:15px" disabled />
                                                                        <label class="form-check-label">Yes</label>
                                                                    </div>
                                                                    <div class="form-check  d-flex justify-content-center gap-2">
                                                                        <InputRadio class="form-check-input " Value="false" style="font-size:15px" disabled />
                                                                        <label class="form-check-label">No</label>
                                                                    </div>
                                                                </InputRadioGroup>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row g-2">
                                                        <div class="hint">Add-ons: Personal +0 • Overnight +1 • Mail +5 • Posting+Mail +5. Expiry counts from deemed date.</div>
                                                        <div class="col-auto">
                                                            <label class="form-label" style="    padding: 10px;
                                                                                                                                                                                                                                                                                            border: 1px solid;
                                                                                                                                                                                                                                                                                            border-radius: 25px;
                                                                                                                                                                                                                                                                                            align-items: center;
                                                                                                                                                                                                                                                                                            display: flex;
                                                                                                                                                                                                                                                                                             ">Live Expiry : --</label>

                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>



                                    </div>

                                    <!-- good cause-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header">
                                                    <div style="font-weight:700" class="head">Documents & Remarks</div>

                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-2 mb-3">

                                                        <!-- Notice type -->
                                                        <div class="col-md-3">

                                                            <div class="form-check d-flex justify-content-center gap-2">
                                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.leasedAttached" disabled />
                                                                <label class="form-check-label"> Leased Attached </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-3">
                                                            <div class="form-check d-flex justify-content-center gap-2">
                                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.ledgerAttached" disabled />
                                                                <label class="form-check-label"> Ledger attached </label>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-3">

                                                            <div class="form-check d-flex justify-content-center gap-2">
                                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.NoticeproofAttached" disabled />
                                                                <label class="form-check-label"> Notices proof attached </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">

                                                            <div class="form-check d-flex justify-content-center gap-2">
                                                                <InputCheckbox class="form-check-input" style="font-size:15px" @bind-Value="legalcaseDto.RegistrationRentAttached" disabled />
                                                                <label class="form-check-label">Registration/Rent history attached</label>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="row g-2 mb-3">

                                                        <div class="col-md-6">
                                                            <label class="form-label">Good Cause Exemption Notice attached</label>
                                                            <div class="d-flex justify-content-start align-items-center  gap-2">
                                                                <InputRadioGroup @bind-Value="legalcaseDto.GoodCauseExempt" disabled>
                                                                    <div class="form-check d-flex justify-content-center gap-2">
                                                                        <InputRadio class="form-check-input" Value="true" style="font-size:15px" disabled />
                                                                        <label class="form-check-label">Yes</label>
                                                                    </div>
                                                                    <div class="form-check  d-flex justify-content-center gap-2">
                                                                        <InputRadio class="form-check-input " Value="false" style="font-size:15px" disabled />
                                                                        <label class="form-check-label">No</label>
                                                                    </div>
                                                                </InputRadioGroup>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6">
                                                            <label class="form-label ">Additional Comments </label>
                                                            <InputText class="form-control" @bind-Value="legalcaseDto.AdditionalComments" style="cursor:pointer;" disabled />

                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>



                                    </div> *@


                                    }
                                    @if (legalcaseDto.CaseTypeName == "Holdover")
                                    {
                                        <!--Term-->
                                        <div class="row mt-3">
                                            <div class="col">
                                                <div class="card mb-3">
                                                    <div class="card-header">
                                                        <div style="font-weight:700" class="head">Terms</div>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="row g-2">

                                                            <!-- Written Lease -->
                                                            <div class="col-md-4">
                                                                <label class="form-label">Written Lease?</label>
                                                                <div class="d-flex justify-content-start align-items-center  gap-2">
                                                                    <InputRadioGroup @bind-Value="legalcaseDto.WrittenLease">
                                                                        <div class="form-check d-flex justify-content-center gap-2">
                                                                            <InputRadio class="form-check-input" Value="true" style="font-size:15px" disabled />
                                                                            <label class="form-check-label">Yes</label>
                                                                        </div>
                                                                        <div class="form-check  d-flex justify-content-center gap-2">
                                                                            <InputRadio class="form-check-input " Value="false" style="font-size:15px" disabled />
                                                                            <label class="form-check-label">No</label>
                                                                        </div>
                                                                    </InputRadioGroup>
                                                                </div>
                                                            </div>


                                                            <div class="col-md-4">
                                                                <label class="form-label">Oral Aggrement</label>
                                                                <div class="d-flex justify-content-start align-items-center  gap-2" style="cursor:pointer;">
                                                                    <InputRadioGroup @bind-Value="legalcaseDto.OralAgreeMent">
                                                                        <div class="form-check d-flex justify-content-center gap-2">
                                                                            <InputRadio class="form-check-input" Value="true" style="font-size:15px" disabled />
                                                                            <label class="form-check-label">Yes</label>
                                                                        </div>
                                                                        <div class="form-check  d-flex justify-content-center gap-2">
                                                                            <InputRadio class="form-check-input " Value="false" style="font-size:15px" disabled />
                                                                            <label class="form-check-label">No</label>
                                                                        </div>
                                                                    </InputRadioGroup>
                                                                </div>
                                                            </div>

                                                            <!-- Oral End -->
                                                            <div class="col-md-4">
                                                                <label class="form-label">Program</label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.CaseProgramId" style="cursor:pointer;" disabled>
                                                                    <option value="">-- Select --</option>
                                                                    @foreach (var l in CaseProgramList)
                                                                    {
                                                                        <option value="@l.Id">@l.Name</option>
                                                                    }
                                                                </InputSelect>
                                                                <ValidationMessage For="() => legalcaseDto.CaseProgramId" />
                                                            </div>

                                                        </div>
                                                        <div class="row g-2 mt-2">
                                                            <!-- Date Tenant Moved -->
                                                            <div class="col-md-4">
                                                                <label class="form-label">Good Cause Applies?</label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.GoodCauseApplies" style="cursor:pointer;" disabled>
                                                                    <option value="false">No (Exempt)</option>
                                                                    <option value="true">Yes (Owner ≥ 10)</option>
                                                                </InputSelect>

                                                            </div>

                                                            <!-- Rent Due Day -->
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Move In Date </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%" @bind-Value="legalcaseDto.DateTenantMoved" Max="@DateTime.Today" @bind-Value:after="CalcNoticeDays" disabled />
                                                                <ValidationMessage For="() => legalcaseDto.DateTenantMoved" />
                                                            </div>

                                                            <!-- Monthly Rent -->
                                                            <div class="col-md-4">
                                                                <label class="form-label ">Lease End (If any) </label>
                                                                <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.LeaseEnd" disabled />

                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>



                                        </div>



                                    }



                                </div>
                            </div>
                        </div>


                        @* <div class="col-md-4">
                        <CasesSummary LegalCase="legalcaseDto"
                                      TenancyTypeList="TenancyTypeList"
                                      DateRentList="DateRentList"
                                      CaseProgramList="CaseProgramList"
                                      CurrentStep="CurrentStep"
                                      Steps="Steps" />
                        <TipsSummary />
                    </div> *@
                    </div>
                </div>

            }

        }

        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Per Diem" || legalcaseDto.CaseTypeName == "Illegal Lockout")
        {
            @if (Steps[CurrentStep].Name == "CaseAndclient")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card mb-3">
                                <div class="card-header fw-bold head">Case Information</div>
                                <div class="card-body">
                                    <div class="row g-3">

                                        @if (!HideCaseAndClientSection)
                                        {
                                            <!-- CASE TYPE -->
                                            <div class="col-3 ">
                                                <label class="form-label required-label">Case Type</label>
                                                <InputSelect class="form-select holdover-form"
                                                             @bind-Value="legalcaseDto.CaseTypeId"
                                                             @bind-Value:after="BuildSteps">

                                                    @foreach (var l in CaseTypeList)
                                                    {
                                                        <option value="@l.Id">@l.Name</option>
                                                    }
                                                </InputSelect>
                                                <ValidationMessage For="() => legalcaseDto.CaseTypeId" />
                                            </div>

                                            <!-- CLIENT SEARCH BOX -->
                                            <div class="col-6">
                                                @if (!IsNewClient)
                                                {
                                                    <div class="position-relative" @onfocusout="HideClientDropDown">
                                                        <label class="form-label required-label">Client</label>

                                                        <InputText type="text" class="form-control"
                                                                   placeholder="Search by client name or code..."
                                                                   @bind-value="searchText"
                                                                   @bind-value:after="OnBindClientAfter"
                                                                   @oninput="OnSearchInput"
                                                                   @onclick="ShowAllClients" />

                                                        @if (filteredClients?.Any() == true)
                                                        {
                                                            <ul class="dropdown-menu show"
                                                                style="position:absolute; width:100%; cursor:pointer; z-index:2000;">
                                                                @foreach (var c in filteredClients)
                                                                {
                                                                    <li class="dropdown-item"
                                                                        @onclick="() => SelectClient(c)">
                                                                        @c.FirstName @c.LastName / @c.ClientCode
                                                                    </li>
                                                                }
                                                            </ul>
                                                        }
                                                        <div style="min-height:1.5em;">
                                                            <ValidationMessage For="() => legalcaseDto.ClientId" />
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        }


                                        @if (!showClientTextbox && legalcaseDto.ClientId.HasValue
                                                                        && legalcaseDto.CaseTypeId.HasValue)
                                        {
                                            <div class="card p-3 position-relative mt-3">
                                                <button type="button"
                                                        class="btn-close position-absolute top-0 end-0 m-2"
                                                        @onclick="ClearSelectedClient" title=" Click here for Client reset">
                                                </button>

                                                <div class="row g-3">
                                                    <div class="col-4">
                                                        <label class="form-label required-label">Client Name</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Name"
                                                                   @bind-Value="legalcaseDto.ClientName" disabled />
                                                        <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Phone</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Number"
                                                                   @bind-Value="legalcaseDto.ClientPhone" disabled />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label required-label">Client Type</label>
                                                        <InputSelect class="form-select"
                                                                     @bind-Value="legalcaseDto.ClientTypeId" disabled>
                                                            <option value="">-- Select --</option>
                                                            @foreach (var Own in ClientTypeList)
                                                            {
                                                                <option value="@Own.Id">@Own.Name</option>
                                                            }
                                                        </InputSelect>
                                                        <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                    </div>





                                                    <div class="col-6">
                                                        <label class="form-label required-label">Email</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Email"
                                                                   @bind-Value="legalcaseDto.ClientEmail" disabled />
                                                        <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Reference #</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Reference"
                                                                   @bind-Value="legalcaseDto.Reference" disabled />
                                                    </div>



                                                    @if (IsNewClient)
                                                    {
                                                        <div class="col-9">
                                                            <label class="form-label">Address</label>
                                                            <InputText class="form-control"
                                                                       placeholder="Enter Address"
                                                                       @bind-Value="legalcaseDto.ClientAddress" />
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        }


                                        <!-- NEW CLIENT TEXTBOX FORM -->
                                        @if (showClientTextbox)
                                        {


                                            <div class="card p-3 position-relative">
                                                <button type="button"
                                                        class="btn-close position-absolute top-0 end-0 m-2"
                                                        @onclick="ClearSelectedClient" title=" Click here for lanlord reset">
                                                </button>

                                                <div class="row g-3">

                                                    <div class="col-4">
                                                        <label class="form-label required-label">Client Name</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Name"
                                                                   @bind-Value="legalcaseDto.ClientName" />
                                                        <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Phone</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Number"
                                                                   @bind-Value="legalcaseDto.ClientPhone" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label required-label">Client Type</label>
                                                        <InputSelect class="form-select"
                                                                     @bind-Value="legalcaseDto.ClientTypeId">
                                                            <option value="">-- Select --</option>
                                                            @foreach (var Own in ClientTypeList)
                                                            {
                                                                <option value="@Own.Id">@Own.Name</option>
                                                            }
                                                        </InputSelect>
                                                        <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                    </div>
                                                    <div class="col-6">
                                                        <label class="form-label required-label">Email</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Email"
                                                                   @bind-Value="legalcaseDto.ClientEmail" />
                                                        <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="form-label">Reference #</label>
                                                        <InputText class="form-control"
                                                                   placeholder="Enter Reference"
                                                                   @bind-Value="legalcaseDto.Reference" />
                                                    </div>

                                                    @if (IsNewClient)
                                                    {
                                                        <div class="col-8">
                                                            <label class="form-label">Address</label>
                                                            <InputText class="form-control"
                                                                       placeholder="Enter Address"
                                                                       @bind-Value="legalcaseDto.ClientAddress" />
                                                        </div>
                                                    }

                                                </div>
                                            </div>
                                        }

                                    </div>



                                </div>
                            </div>
                        </div>

                        <!-- Right side summary -->
                        <div class="col-4">
                            <CasesSummary LegalCase="legalcaseDto"
                                          ClientList="selectedClient"
                                          CaseTypeList="CaseTypeList"
                                          CurrentStep="CurrentStep" Steps="Steps" />
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }
            @if (Steps[CurrentStep].Name == "Attorney" && legalcaseDto.CaseTypeName == "Per Diem")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Attorney Assigning Case -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Attorney Assigning Case
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <!-- Hiring Attorney / Firm -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Hiring Attorney / Firm <span class="text-danger">*</span></label>
                                            <InputText name="hiringFirm" class="form-control" @bind-Value="legalcaseDto.Attrney" />
                                            <ValidationMessage For="() => legalcaseDto.Attrney" />
                                        </div>

                                        <!-- Contact Person -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Contact Person</label>
                                            <InputText name="contactPerson" class="form-control" @bind-Value="legalcaseDto.AttrneyContactInfo" />

                                        </div>

                                        <!-- Phone / Email -->
                                        <div class="col-md-12">
                                            <label class="form-label fw-semibold">Phone / Email</label>
                                            <InputText name="contactPhoneEmail" class="form-control" placeholder="(555) 555-5555 / name@example.com" @bind-Value="legalcaseDto.AttrneyEmail" />

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right side summary -->
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }

            @if (Steps[CurrentStep].Name == "CaseInfo")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header d-flex justify-content-between ">
                                    <div class="fw-bold head">
                                        Case Information
                                    </div>
                                    @if (legalcaseDto.CaseTypeName == "Per Diem")
                                    {
                                        <a href="https://iapps.courts.state.ny.us/webcivilLocal/LCMain" target="_blank" class="lookup-link"><i class="fa-solid fa-book" style="margin-right:5px;"></i>lookup</a>
                                    }
                                </div>

                                <div class="card-body">
                                    <!-- Case Type -->
                                    <div class="row">
                                        <div class="col-12">
                                        </div><label class="form-label fw-semibold">Case Type <span class="text-danger">*</span></label>
                                    </div>
                                    @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                    {
                                        <div class="row mt-1">
                                            @if (CaseTypeHPDList != null && CaseTypeHPDList.Any())
                                            {
                                                @foreach (var caseType in CaseTypeHPDList)
                                                {
                                                    <div class="col-auto">
                                                        <div class="form-check">
                                                            <input type="checkbox"
                                                                   class="form-check-input bigger-checkbox"
                                                                   @bind="caseType.IsSelected" />
                                                            <label class="form-check-label">@caseType.Name</label>
                                                        </div>
                                                    </div>
                                                }
                                                <ValidationMessage For="() => legalcaseDto.CaseTypeHPDId" />
                                            }

                                        </div>
                                    }
                                    @if (legalcaseDto.CaseTypeName == "Per Diem")
                                    {
                                        <div class="row mt-1">
                                            @if (CaseTypePerDiemList != null && CaseTypePerDiemList.Any())
                                            {
                                                @foreach (var caseType in CaseTypePerDiemList)
                                                {
                                                    <div class="col-auto">
                                                        <div class="form-check">
                                                            <input type="checkbox"
                                                                   class="form-check-input bigger-checkbox"
                                                                   @bind="caseType.IsSelected" />
                                                            <label class="form-check-label">@caseType.Name</label>
                                                        </div>
                                                    </div>
                                                }
                                                <ValidationMessage For="() => legalcaseDto.CaseTypePerDiemId" />
                                            }


                                        </div>
                                    }
                                    <!-- Case Details -->
                                    <div class="row g-3 mt-2">

                                        <div class=@(showCountyDropdown ? "col-md-3" : "col-md-6")>
                                            <label class="form-label ">Court Type </label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CourtTypeId" style="cursor:pointer;" @bind-Value:after="SelectCourtType">
                                                @foreach (var l in CourtTypeList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <!-- Court Location -->

                                        <div class=@(showCountyDropdown ? "col-md-3" : "d-none")>

                                            <label class="form-label fw-semibold">County </label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CountyId" style="cursor:pointer;" @bind-Value:after="SelectCounty">
                                                @foreach (var l in CountyList)
                                                {
                                                    <option value="@l.Id">@l.Name</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Court <span class="text-danger">*</span></label>
                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CourtLocationId" style="cursor:pointer;" @onmousedown="ShowAllCourts" @bind-Value:after="SelectCourt">
                                                <option value="">-- Select --</option>
                                                @foreach (var l in filteredCourts)
                                                {
                                                    <option value="@l.Id">@l.Court</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <!-- Part / Room # -->
                                        @if (!showCourtPartDropdown)
                                        {
                                            <div class="col-md-6">
                                                <label class="form-label fw-semibold">Part / Room #</label>
                                                <InputText type="text" name="partRoom" class="form-control" @bind-Value="legalcaseDto.CourtRoom" />
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="col-md-6">
                                                <label class="form-label fw-semibold">Part / Room #</label>
                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.CourtPartId" style="cursor:pointer;">
                                                    <option value="">-- Select --</option>
                                                    @foreach (var l in CourtPartList)
                                                    {
                                                        <option value="@l.Id">@l.Part - @l.RoomNo</option>
                                                    }
                                                </InputSelect>
                                            </div>
                                        }



                                        <!-- Index / LT Docket # -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Index / LT Docket #</label>
                                            <InputText type="text" name="docket" class="form-control" @bind-Value="legalcaseDto.Index" />
                                        </div>

                                        @if (legalcaseDto.CaseTypeName == "Per Diem")
                                        {
                                            <div class="row mt-3">
                                                <div class="col-12">
                                                    <label class="form-label fw-semibold">
                                                        Representing <span class="text-danger">*</span>
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="row">
                                                @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                {
                                                    @if (PartyRepresentPerDiemList != null && PartyRepresentPerDiemList.Any())
                                                    {
                                                        <InputRadioGroup @bind-Value="legalcaseDto.PartyRepresentPerDiemId" class="d-flex flex-wrap">
                                                            @foreach (var partyType in PartyRepresentPerDiemList)
                                                            {
                                                                <div class="col-auto">
                                                                    <div class="form-check mb-2">
                                                                        <InputRadio class="form-check-input"
                                                                                    id="@($"partyType_{partyType.Id}")"
                                                                                    Value="@partyType.Id" style="font-size:15px" />
                                                                        <label class="form-check-label"
                                                                               for="@($"partyType_{partyType.Id}")">@partyType.Name</label>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </InputRadioGroup>
                                                        <ValidationMessage For="() => legalcaseDto.PartyRepresentPerDiemId" />
                                                    }
                                                }
                                            </div>

                                            <!-- Party Details -->
                                            <div class="row g-3">

                                                @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                {
                                                    <!-- Managing Agent -->
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-semibold">Party Name(s)</label>
                                                        <InputText name="Partynames" class="form-control" @bind-Value="legalcaseDto.Partynames" />
                                                    </div>

                                                    <!-- Opposing Counsel -->
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-semibold">Opposing Counsel (if any)</label>
                                                        <InputText type="text" name="opposingCounsel" class="form-control" @bind-Value="legalcaseDto.OpposingCounsel" />
                                                    </div>

                                                }



                                            </div>

                                            <div class="row g-3 mb-4 mt-3">
                                                <!-- Date of Appearance -->
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold">
                                                        Date of Appearance <span class="text-danger">*</span>
                                                    </label>
                                                    <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false"  ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; " @bind-Value="legalcaseDto.AppearanceDate" />
                                                    <ValidationMessage For="() => legalcaseDto.AppearanceDate" />
                                                </div>

                                                <!-- Time of Appearance -->
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold">
                                                        Time of Appearance <span class="text-danger">*</span>
                                                    </label>
                                                    <input type="time" name="appearanceTime" class="form-control" @bind="legalcaseDto.AppearanceTime" />
                                                    <ValidationMessage For="() => legalcaseDto.AppearanceTime" />
                                                </div>
                                            </div>

                                            <!-- Type of Appearance -->
                                            <div class="mb-3 row">

                                                <label class="form-label fw-semibold">
                                                    Type of Appearance <span class="text-danger">*</span>
                                                </label>

                                                <div id="appearanceTypeGroup" style="display:flex; align-items:ceneter ; flex-wrap:wrap">
                                                    <!-- Checkboxes -->
                                                    @* @if (legalcaseDto.CaseTypeName == "HPD")
                                            {

                                                @if (AppearanceTypesList != null && AppearanceTypesList.Any())
                                                {
                                                    @foreach (var Type in AppearanceTypesList)
                                                    {
                                                        <div class="col-6">
                                                            <div class="form-check form-check-inline me-3">
                                                                <input type="checkbox"
                                                                       class="form-check-input bigger-checkbox"
                                                                       checked="@legalcaseDto.SelectedAppearanceTypeIds.Contains(Type.Id)"
                                                                       @onchange="e => OnHPDAppearanceChanged(Type.Id, e)" />
                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                            </div>
                                                        </div>
                                                    }
                                                }

                                                <ValidationMessage For="() => legalcaseDto.AppearanceTypeId" />
                                            }
 *@
                                                    @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                    {
                                                        @if (AppearanceTypesPerDiemList != null && AppearanceTypesPerDiemList.Any())
                                                        {
                                                            @foreach (var Type in AppearanceTypesPerDiemList)
                                                            {

                                                                <div class="form-check form-check-inline me-3">
                                                                    <input type="checkbox"
                                                                           class="form-check-input"
                                                                           @bind="Type.IsSelected" />
                                                                    <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                </div>

                                                            }
                                                        }

                                                        <ValidationMessage For="() => legalcaseDto.AppearanceTypePerdiemId" />
                                                    }


                                                </div>


                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right side summary -->
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Party")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold head">
                                    Party Representation
                                </div>

                                <div class="card-body">
                                    <!-- Representing -->
                                    <div class="row">
                                        <div class="col-12">
                                            <label class="form-label fw-semibold">
                                                Representing <span class="text-danger">*</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="row">
                                        @if (legalcaseDto.CaseTypeName == "Per Diem")
                                        {
                                            @if (PartyRepresentPerDiemList != null && PartyRepresentPerDiemList.Any())
                                            {
                                                <InputRadioGroup @bind-Value="legalcaseDto.PartyRepresentPerDiemId" class="d-flex flex-wrap">
                                                    @foreach (var partyType in PartyRepresentPerDiemList)
                                                    {
                                                        <div class="col-auto">
                                                            <div class="form-check mb-2">
                                                                <InputRadio class="form-check-input"
                                                                            id="@($"partyType_{partyType.Id}")"
                                                                            Value="@partyType.Id" style="font-size:15px" />
                                                                <label class="form-check-label"
                                                                       for="@($"partyType_{partyType.Id}")">@partyType.Name</label>
                                                            </div>
                                                        </div>
                                                    }
                                                </InputRadioGroup>
                                                <ValidationMessage For="() => legalcaseDto.PartyRepresentPerDiemId" />
                                            }
                                        }
                                        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                        {
                                            @if (PartyRepresentList != null && PartyRepresentList.Any())
                                            {
                                                <InputRadioGroup @bind-Value="legalcaseDto.PartyRepresentId" class="d-flex flex-wrap">
                                                    @foreach (var partyType in PartyRepresentList)
                                                    {
                                                        <div class="col-auto">
                                                            <div class="form-check mb-2">
                                                                <InputRadio class="form-check-input"
                                                                            id="@($"partyType_{partyType.Id}")"
                                                                            Value="@partyType.Id" style="font-size:15px" />
                                                                <label class="form-check-label"
                                                                       for="@($"partyType_{partyType.Id}")">@partyType.Name</label>
                                                            </div>
                                                        </div>
                                                    }
                                                </InputRadioGroup>
                                                <ValidationMessage For="() => legalcaseDto.PartyRepresentId" />
                                            }
                                        }

                                    </div>



                                    <!-- Party Details -->
                                    <div class="row g-3">
                                        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                        {


                                            <div class="col-md-12">
                                                <label class="form-label fw-semibold">Petitioner / Tenant Name(s)  <span class="text-danger">*</span></label>

                                                <div class="row mt-2 ">
                                                    @if (showTenantfields)
                                                    {
                                                        <button class=" position-absolute top-3  end-0 m-2" style="background: transparent; border: none; width: auto; "
                                                                @onclick="CancelTenants">
                                                            <i class="fa-solid fa-arrow-left"></i> Back
                                                        </button>
                                                    }

                                                    <div class="col-md-8 position-relative" @onfocusout="HideTenantsDropDown">

                                                        @if (showTenantfields && selectedtenant == null)
                                                        {


                                                            <InputText class="form-control"
                                                                       placeholder="Enter Tenant name"
                                                                       @bind-value="searchTenantText"
                                                                       @onblur="saveTenantName" />
                                                        }
                                                        else
                                                        {


                                                            <InputText class="form-control "
                                                                       placeholder="Search by  name or code..."
                                                                       @bind-value="searchTenantText"
                                                                       @oninput="OnSearchTenantHpdInput" @onblur="saveTenantName" @onclick="ShowAllTenant" @onfocus="OnTenantInputFocus" />
                                                        }


                                                        @if (filteredTenant?.Any() == true)
                                                        {
                                                            <ul class="dropdown-menu show mt-2 " style="position: absolute; width:94% !important; cursor:pointer;">
                                                                @foreach (var c in filteredTenant)
                                                                {
                                                                    <li class="dropdown-item" @onclick="() => SelectTenanthpd(c)">
                                                                        @c.FirstName @c.LastName / @c.TenantCode
                                                                    </li>
                                                                }
                                                            </ul>
                                                        }
                                                        <ValidationMessage For="() => legalcaseDto.TenantId" />


                                                    </div>

                                                    @if (!showTenantfields)
                                                    {


                                                        <div class="col-md-1 d-flex justify-content-center align-items-center">
                                                            <div>
                                                                OR
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2 d-flex align-items-center">
                                                            <button type="button" class="btn" style="background-color:#1F365D !important;height:20px; width:20px ;  display:flex; justify-content:center; align-items:center; color:white" @onclick="SelectTenants">+ </button>
                                                        </div>

                                                    }
                                                    @if (AdditionalPetitioners.Count > 0)
                                                    {
                                                        @* <label class="mt-2 fw-semibold">Additional Petitioner(s)</label> *@

                                                        @foreach (var t in AdditionalPetitioners)
                                                        {
                                                            <div class="row mt-2">
                                                                <div class="col-md-8">
                                                                    <InputText class="form-control" placeholder="Enter Additional Petitioner"
                                                                               @bind-Value="t.Name" />
                                                                </div>

                                                                <div class="col-md-1">
                                                                    <button class="btn btn-danger" style="border:none;" @onclick="() => RemoveAdditionalPetitioner(t)">
                                                                        X
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        }
                                                    }

                                                </div>
                                                <button class="btn btn-sm btn-primary btn-tenant mt-2" @onclick="AddAdditionalPetitioner">＋ Add Petitioner</button>
                                            </div>

                                            <div class="col-md-12">
                                                <label class="form-label fw-semibold">Respondent / Landlord Name(s) <span class="text-danger">*</span></label>

                                                <div class="row mt-2 ">
                                                    @if (showLandlordfields)
                                                    {
                                                        <button class=" position-absolute top-3 end-0 m-2" style="background: transparent; border: none; width: auto;"
                                                                @onclick="CancelLandlords">
                                                            <i class="fa-solid fa-arrow-left"></i> Back
                                                        </button>
                                                    }
                                                    <div class="col-md-8 position-relative" @onfocusout="HideLandlordsDropDown">

                                                        @if (showLandlordfields && selectedlandlord == null)
                                                        {
                                                            <InputText type="text" class="form-control"
                                                                       placeholder="Enter Landlord name"
                                                                       @bind-value="searchlandlordText"
                                                                       @onblur="saveLandLordName" />
                                                        }
                                                        else
                                                        {
                                                            <InputText type="text" class="form-control "
                                                                       placeholder="Search by  name or code..."
                                                                       @bind-value="searchlandlordText"
                                                                       @oninput="OnSearchLandlordInput" @onblur="saveLandLordName" @onclick="ShowAlllandlords" />
                                                        }


                                                        @if (filteredLandlords?.Any() == true)
                                                        {
                                                            <ul class="dropdown-menu show mt-2 " style="position: absolute; width:94% !important; cursor:pointer;">
                                                                @foreach (var c in filteredLandlords)
                                                                {
                                                                    <li class="dropdown-item" @onclick="() => SelectLandlordhpd(c)">
                                                                        @c.FirstName @c.LastName / @c.LandLordCode
                                                                    </li>
                                                                }
                                                            </ul>
                                                        }
                                                        <ValidationMessage For="() => legalcaseDto.LandlordId" />
                                                    </div>

                                                    @if (!showLandlordfields)
                                                    {


                                                        <div class="col-md-1 d-flex justify-content-center align-items-center">
                                                            <div>
                                                                OR
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3 d-flex align-items-center">
                                                            <button type="button" class="btn" style="background-color:#1F365D !important;height:20px; width:20px ;  display:flex; justify-content:center; align-items:center; color:white" @onclick="SelectLandlords">+ </button>
                                                        </div>

                                                    }
                                                    @if (AdditionalRespondent.Count > 0)
                                                    {
                                                        @* <label class="mt-2 fw-semibold">Additional Petitioner(s)</label> *@

                                                        @foreach (var t in AdditionalRespondent)
                                                        {
                                                            <div class="row mt-2">
                                                                <div class="col-md-8">
                                                                    <InputText class="form-control" placeholder="Enter Additional Petitioner"
                                                                               @bind-Value="t.Name" />
                                                                </div>

                                                                <div class="col-md-1">
                                                                    <button class="btn btn-danger" style="border:none;" @onclick="() => RemoveAdditionalRespondent(t)">
                                                                        X
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        }
                                                    }
                                                </div>
                                                <button class="btn btn-sm btn-primary btn-tenant mt-2" @onclick="AddAdditionalRespondent">＋ Add Respondent</button>
                                            </div>



                                            <!-- Managing Agent -->
                                            <div class="col-md-6">
                                                <label class="form-label fw-semibold">Managing Agent (if applicable)</label>
                                                <InputText name="managingAgent" class="form-control" @bind-Value="legalcaseDto.ManagingAgent" />
                                            </div>

                                            <!-- Opposing Counsel -->
                                            <div class="col-md-6">
                                                <label class="form-label fw-semibold">Opposing Counsel (if any)</label>
                                                <InputText type="text" name="opposingCounsel" class="form-control" @bind-Value="legalcaseDto.OpposingCounsel" />
                                            </div>

                                        }
                                        @if (legalcaseDto.CaseTypeName == "Per Diem")
                                        {
                                            <!-- Managing Agent -->
                                            <div class="col-md-6">
                                                <label class="form-label fw-semibold">Party Name(s)</label>
                                                <InputText name="Partynames" class="form-control" @bind-Value="legalcaseDto.Partynames" />
                                            </div>

                                            <!-- Opposing Counsel -->
                                            <div class="col-md-6">
                                                <label class="form-label fw-semibold">Opposing Counsel (if any)</label>
                                                <InputText type="text" name="opposingCounsel" class="form-control" @bind-Value="legalcaseDto.OpposingCounsel" />
                                            </div>

                                        }



                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Building")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card mb-3">
                                <div class="card-header fw-bold head">Building Information</div>
                                <div class="card-body row ">


                                    <div class="row mt-2 d-flex align-items-center">

                                        @if (!IsExistingBuildingSelected && !IsNewBuilding)
                                        {

                                            <div class="col-md-6 position-relative" @onfocusout="HideBuildingDropdown">
                                                <label class="form-label  required-label">Building</label>
                                                <input type="text" class="form-control"
                                                       placeholder="Search by Building Address or code..."
                                                       @bind-value="searchBuildingText"
                                                       @oninput="OnSearchBuildingInput" />

                                                @if (filteredBuildings?.Any() == true)
                                                {
                                                    <ul class="dropdown-menu show" style="position: absolute; width:94% !important; cursor:pointer;">
                                                        @foreach (var c in filteredBuildings)
                                                        {
                                                            <li class="dropdown-item" @onclick="() => SelectBuilding(c)">
                                                                @c.ApartmentCode @c.CityName / @c.BuildingCode
                                                            </li>
                                                        }
                                                    </ul>
                                                }

                                                <div style="min-height:1.5em; margin-top:4px">
                                                    <ValidationMessage For="() => legalcaseDto.BuildingId" />
                                                </div>

                                            </div>

                                        }

                                        <div class="col-md-4 d-flex align-items-end">
                                            <!-- bottom align -->
                                            @if (!showBuildingfields)
                                            {
                                                <div class="w-100 d-flex gap-3  align-items-center">
                                                    <span class="fw-bold mt-1">OR</span>
                                                    <button type="button" class="btn"
                                                            style="background-color:#1F365D; color:white"
                                                            @onclick="OnBindBuldingAfter">
                                                        + ADD
                                                    </button>
                                                </div>
                                            }

                                        </div>


                                    </div>

                                    @if (showBuildingfields)
                                    {
                                        <div class=@(selectedbuilding != null ? "card mt-3 p-3 position-relative" : "mt-3 position-relative")>
                                            @if (showBuildingfields)
                                            {
                                                <button type="button" class="btn-close position-absolute top-3 end-0 m-2"
                                                        aria-label="Close"
                                                        style="top:3px"
                                                        title="Click here for building reset"
                                                        @onclick="OnBindBuldingCancel">
                                                </button>
                                            }
                                            <div class="row">
                                                <div class="col-6">
                                                    <label class="form-label  required-label">Building Address </label>
                                                    <InputText class="form-control" @bind-Value="legalcaseDto.BuildingAddress" placeholder="Enter BuildingAddress" disabled="@IsExistingBuildingSelected" />


                                                    @if (!IsExistingBuildingSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.BuildingAddress" />
                                                    }
                                                </div>
                                                <div class="col-6">
                                                    <label class="form-label  required-label">Units </label>
                                                    <InputText class="form-control" @bind-Value="legalcaseDto.Units" placeholder="Enter Units" disabled="@IsExistingBuildingSelected" />

                                                    @if (!IsExistingBuildingSelected)
                                                    {
                                                        <ValidationMessage For="() => legalcaseDto.Units" />
                                                    }
                                                </div>


                                            </div>

                                            <div class="row mt-4">

                                                <div class="col-md-5">

                                                    <label class="form-label fw-semibold">
                                                        Building Type <span class="text-danger">*</span>
                                                    </label>
                                                    @if (PremiseTypesList != null && PremiseTypesList.Any())
                                                    {
                                                        <div class="row" style="display: flex;flex-wrap: wrap; margin-left:10px;">
                                                            <InputRadioGroup @bind-Value="legalcaseDto.PremiseTypeId" class="d-flex gap-4 flex-wrap mt-2">

                                                                @foreach (var Type in PremiseTypesList)
                                                                {
                                                                    <div class="form-check d-flex align-items-center gap-1 col-6">
                                                                        <InputRadio class="form-check-input"
                                                                                    id="@($"Type_{Type.Id}")"
                                                                                    Value="@Type.Id" disabled="@IsExistingBuildingSelected" />

                                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                    </div>
                                                                }

                                                            </InputRadioGroup>

                                                            @if (!IsExistingBuildingSelected)
                                                            {
                                                                <ValidationMessage For="() => legalcaseDto.PremiseTypeId" />
                                                            }


                                                        </div>
                                                    }
                                                </div>

                                                <div class="col-md-7">
                                                    <label class="form-label fw-semibold">
                                                        Registration Status (HPD/DOF) <span class="text-danger">*</span>
                                                    </label>

                                                    <div class="row mt-1">
                                                        @if (RegistrationstatusList != null && RegistrationstatusList.Any())
                                                        {
                                                            <div style="display: flex;flex-wrap: wrap; column-gap: 33px;">
                                                                <InputRadioGroup @bind-Value="legalcaseDto.RegistrationStatusTypeId" class="d-flex flex-wrap">
                                                                    @foreach (var Type in RegistrationstatusList)
                                                                    {
                                                                        <div class="col-12">
                                                                            <div class="form-check">
                                                                                <InputRadio class="form-check-input"
                                                                                            id="@($"RegStatus_{Type.Id}")"
                                                                                            Value="@Type.Id" />
                                                                                <label class="form-check-label" for="@($"RegStatus_{Type.Id}")">@Type.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                </InputRadioGroup>
                                                                <ValidationMessage For="() => legalcaseDto.RegistrationStatusTypeId" />
                                                                @*                         @if (!IsExistingBuildingSelected)
                                                {
                                                                
                                                } *@

                                                            </div>
                                                        }
                                                    </div>
                                                </div>


                                            </div>

                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="col-4">



                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Petitioner")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold  ">
                                    Allegations of Harassment (Petitioner / Tenant)
                                </div>

                                <div class="card-body">
                                    <label class="form-label fw-semibold">
                                        Please select applicable Harassment
                                    </label>
                                    <div class="mb-3" id="allegationsGroup">
                                        <!-- Repeated interruptions -->
                                        @if (HarassmentTypesList != null && HarassmentTypesList.Any())
                                        {
                                            @foreach (var Type in HarassmentTypesList)
                                            {
                                                <div class="col-12">
                                                    <div class="form-check">
                                                        <input type="checkbox"
                                                               class="form-check-input"
                                                               @bind="Type.IsSelected" />
                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        @* <ValidationMessage For="() => legalcaseDto.HarassmentTypeId" /> *@


                                    </div>


                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Respondent")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold">
                                    Defense / Position (Respondent / Landlord)
                                </div>

                                <div class="card-body">
                                    <label class="form-label fw-semibold">
                                        Please select applicable defenses
                                    </label>

                                    <div id="defensesGroup" class="mb-3">
                                        @if (DefenseTypesList != null && DefenseTypesList.Any())
                                        {
                                            @foreach (var Type in DefenseTypesList)
                                            {
                                                <div class="col-6">
                                                    <div class="form-check">
                                                        <input type="checkbox"
                                                               class="form-check-input"
                                                               @bind="Type.IsSelected" />
                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        <ValidationMessage For="() => legalcaseDto.DefenseTypeId" />

                                    </div>


                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Appearance")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Appearance Details
                                </div>

                                <div class="card-body">
                                    <!-- Date & Time -->
                                    <div class="row g-3 mb-4">
                                        <!-- Date of Appearance -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">
                                                Date of Appearance <span class="text-danger">*</span>
                                            </label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" name="appearanceDate" Style="width:100%;" @bind-Value="legalcaseDto.AppearanceDate" />
                                            <ValidationMessage For="() => legalcaseDto.AppearanceDate" />
                                        </div>

                                        <!-- Time of Appearance -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">
                                                Time of Appearance <span class="text-danger">*</span>
                                            </label>
                                            <input type="time" name="appearanceTime" class="form-control" @bind="legalcaseDto.AppearanceTime" />
                                            <ValidationMessage For="() => legalcaseDto.AppearanceTime" />
                                        </div>
                                    </div>

                                    <!-- Type of Appearance -->
                                    <div class="mb-3 row">

                                        <label class="form-label fw-semibold">
                                            Type of Appearance <span class="text-danger">*</span>
                                        </label>

                                        <div id="appearanceTypeGroup" style="display:flex; align-items:ceneter ; flex-wrap:wrap">
                                            <!-- Checkboxes -->
                                            @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                            {

                                                @if (AppearanceTypesList != null && AppearanceTypesList.Any())
                                                {
                                                    @foreach (var Type in AppearanceTypesList)
                                                    {
                                                        <div class="col-12">
                                                            <div class="form-check form-check-inline me-3">
                                                                <input type="checkbox"
                                                                       class="form-check-input"
                                                                       @bind="Type.IsSelected" />
                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                            </div>
                                                        </div>
                                                    }
                                                }

                                                <ValidationMessage For="() => legalcaseDto.AppearanceTypeId" />
                                            }

                                            @if (legalcaseDto.CaseTypeName == "Per Diem")
                                            {

                                                @if (AppearanceTypesPerDiemList != null && AppearanceTypesPerDiemList.Any())
                                                {
                                                    @foreach (var Type in AppearanceTypesPerDiemList)
                                                    {

                                                        <div class="form-check form-check-inline me-3">
                                                            <input type="checkbox"
                                                                   class="form-check-input"
                                                                   @bind="Type.IsSelected" />
                                                            <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                        </div>

                                                    }
                                                }

                                                <ValidationMessage For="() => legalcaseDto.AppearanceTypePerdiemId" />
                                            }


                                        </div>


                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Relief")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Relief Requested
                                </div>

                                <div class="card-body">
                                    <div class="row g-4">
                                        <!-- Petitioner / Tenant -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Petitioner / Tenant  <span class="text-danger">*</span></label>

                                            <div id="reliefPetitionerGroup">
                                                @if (ReliefPetitionerTypesList != null && ReliefPetitionerTypesList.Any())
                                                {
                                                    @foreach (var Type in ReliefPetitionerTypesList)
                                                    {
                                                        <div class="col-12">
                                                            <div class="form-check">
                                                                <input type="checkbox"
                                                                       class="form-check-input"
                                                                       @bind="Type.IsSelected" />
                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                <ValidationMessage For="() => legalcaseDto.ReliefPetitionerTypeId" />

                                            </div>
                                        </div>

                                        <!-- Respondent / Landlord -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Respondent / Landlord  <span class="text-danger">*</span></label>

                                            <div id="reliefRespondentGroup">
                                                @if (ReliefRespondentTypesList != null && ReliefRespondentTypesList.Any())
                                                {
                                                    @foreach (var Type in ReliefRespondentTypesList)
                                                    {
                                                        <div class="col-12">
                                                            <div class="form-check">
                                                                <input type="checkbox"
                                                                       class="form-check-input"
                                                                       @bind="Type.IsSelected" />
                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                <ValidationMessage For="() => legalcaseDto.ReliefRespondentTypeId" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Billing")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    <div class=" fw-bold ">
                                        @(legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout"
                                                                        ? "Billing Information (if per diem)"
                                                                        : "Billing")
                                                                                </div>

                                </div>

                                <div class="card-body">
                                    <!-- Billing Type -->
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">
                                            @(legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout"
                                                                                ? "Billing Type"
                                                                                : "Rate / Compensation")  <span class="text-danger">*</span>
                                </label>

                                @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                        {
                                            <div id="billingRadio" class="d-flex flex-wrap align-items-center gap-3">
                                                @if (BilingTypesList != null && BilingTypesList.Any())
                                                {
                                                    <InputRadioGroup @bind-Value="legalcaseDto.BilingTypeId" class="d-flex flex-wrap">
                                                        <div class="d-flex align-items-center gap-4">

                                                            @foreach (var Type in BilingTypesList)
                                                            {
                                                                <div class="d-flex align-items-center">

                                                                    <!-- Radio -->
                                                                    <InputRadio class="form-check-input me-2"
                                                                                Value="@Type.Id"
                                                                                checked="@(legalcaseDto.BilingTypeId == Type.Id)"
                                                                                @onchange="() => OnBilingTypeHpdChanged(Type.Id)"
                                                                                id="@($"Type_{Type.Id}")" />

                                                                    <!-- Label -->
                                                                    <label class="form-check-label me-3" for="@($"Type_{Type.Id}")">
                                                                        @Type.Name
                                                                    </label>
                                                                </div>
                                                            }

                                                        </div>
                                                    </InputRadioGroup>
                                                    <ValidationMessage For="() => legalcaseDto.BilingTypeId" />
                                                }

                                            </div>


                                            <!-- Invoice To -->
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold">Invoice To</label>
                                                    <InputText type="text" class="form-control" name="invoiceTo" placeholder="Name or Organization" @bind-Value="legalcaseDto.InvoiceTo" />
                                                </div>
                                            </div>
                                        }
                                        else
                                        {

                                            <div class="row">
                                                <div class="col-12">
                                                    @if (BilingTypesList != null && BilingTypesList.Any())
                                                    {
                                                        <InputRadioGroup @bind-Value="legalcaseDto.BilingTypeId" class="d-flex flex-wrap">
                                                            <div class="d-flex align-items-center gap-4">

                                                                @foreach (var Type in BilingTypesList)
                                                                {
                                                                    <div class="d-flex align-items-center">

                                                                        <!-- Radio -->
                                                                        <InputRadio class="form-check-input me-2"
                                                                                    Value="@Type.Id"
                                                                                    id="@($"Type_{Type.Id}")"
                                                                                    @onclick="@(() => OnBillingTypeChanged(Type.Id))" />

                                                                        <!-- Label -->
                                                                        <label class="form-check-label me-3" for="@($"Type_{Type.Id}")">
                                                                            @Type.Name
                                                                        </label>

                                                                        <!-- Input box (same horizontal line) -->
                                                                        @if (legalcaseDto.BilingTypeId == Type.Id)
                                                                        {
                                                                            <input type="number"
                                                                                   class="form-control"
                                                                                   style="width: 180px;"
                                                                                   placeholder="@(Type.Name == "Flat Rate" ? "$" : "$ / hr")"
                                                                                   @bind="legalcaseDto.BilingTypeInputValue" />
                                                                        }

                                                                    </div>
                                                                }

                                                            </div>


                                                        </InputRadioGroup>
                                                        <ValidationMessage For="() => legalcaseDto.BilingTypeId" />
                                                    }
                                                </div>
                                            </div>
                                            <div class="row mt-4">
                                                <div class="col-6">
                                                    <label class="form-label fw-semibold mb-3">Travel / Other Expenses </label>
                                                    <InputText class="form-control" placeholder="Optional" @bind-Value="legalcaseDto.TravelExpense" />
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold">Payment Method  <span class="text-danger">*</span></label>

                                                    <div id="reliefRespondentGroup " class="d-flex">
                                                        @if (PaymentMethodDtoList != null && PaymentMethodDtoList.Any())
                                                        {
                                                            <InputRadioGroup @bind-Value="legalcaseDto.PaymentMethodId" class="d-flex flex-wrap">
                                                                @foreach (var method in PaymentMethodDtoList)
                                                                {
                                                                    <div class="col-6 ">
                                                                        <div class="form-check mb-2">
                                                                            <InputRadio class="form-check-input"
                                                                                        id="@($"partyType_{method.Id}")"
                                                                                        Value="@method.Id" />
                                                                            <label class="form-check-label"
                                                                                   for="@($"method{method.Id}")">@method.Name</label>
                                                                        </div>
                                                                    </div>
                                                                }
                                                            </InputRadioGroup>
                                                            <ValidationMessage For="() => legalcaseDto.PaymentMethodId" />
                                                        }
                                                    </div>
                                                </div>
                                            </div>

                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }
            @if (Steps[CurrentStep].Name == "Review")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col" style="height: 560px; overflow:auto;">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold head ">
                                    Review
                                </div>

                                <div class="card-body">
                                    <!--client-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header fw-bold head">Case Information</div>
                                                <div class="card-body">
                                                    <div class="row g-3">

                                                        <div class=" p-3 position-relative mt-3">


                                                            <div class="row g-3">
                                                                <div class="col-4">
                                                                    <label class="form-label required-label">Client Name</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Name"
                                                                               @bind-Value="legalcaseDto.ClientName" disabled />
                                                                    <ValidationMessage For="() => legalcaseDto.ClientName" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label">Phone</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Number"
                                                                               @bind-Value="legalcaseDto.ClientPhone" disabled />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label required-label">Client Type</label>
                                                                    <InputSelect class="form-select"
                                                                                 @bind-Value="legalcaseDto.ClientTypeId" disabled>
                                                                        <option value="">-- Select --</option>
                                                                        @foreach (var Own in ClientTypeList)
                                                                        {
                                                                            <option value="@Own.Id">@Own.Name</option>
                                                                        }
                                                                    </InputSelect>
                                                                    <ValidationMessage For="() => legalcaseDto.ClientTypeId" />
                                                                </div>





                                                                <div class="col-6">
                                                                    <label class="form-label required-label">Email</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Email"
                                                                               @bind-Value="legalcaseDto.ClientEmail" disabled />
                                                                    <ValidationMessage For="() => legalcaseDto.ClientEmail" />
                                                                </div>
                                                                <div class="col-4">
                                                                    <label class="form-label">Reference #</label>
                                                                    <InputText class="form-control"
                                                                               placeholder="Enter Reference"
                                                                               @bind-Value="legalcaseDto.Reference" disabled />
                                                                </div>



                                                                @if (IsNewClient)
                                                                {
                                                                    <div class="col-9">
                                                                        <label class="form-label">Address</label>
                                                                        <InputText class="form-control"
                                                                                   placeholder="Enter Address"
                                                                                   @bind-Value="legalcaseDto.ClientAddress" />
                                                                    </div>
                                                                }
                                                            </div>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                    <!--case info-->
                                    <div class="row">
                                        <!-- Left side: Case Information -->
                                        <div class="col">
                                            <div class="card mb-3 shadow-sm rounded-3">
                                                <div class="card-header d-flex justify-content-between ">
                                                    <div class="fw-bold head">
                                                        Case Information
                                                    </div>

                                                </div>

                                                <div class="card-body">
                                                    <!-- Case Type -->
                                                    <div class="row">
                                                        <div class="col-12">
                                                        </div><label class="form-label fw-semibold">Case Type <span class="text-danger">*</span></label>
                                                    </div>
                                                    @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                                    {
                                                        <div class="row mt-1">
                                                            @if (CaseTypeHPDList != null && CaseTypeHPDList.Any())
                                                            {
                                                                @foreach (var caseType in CaseTypeHPDList)
                                                                {
                                                                    <div class="col-auto">
                                                                        <div class="form-check">
                                                                            <input type="checkbox"
                                                                                   class="form-check-input bigger-checkbox"
                                                                                   @bind="caseType.IsSelected" disabled />
                                                                            <label class="form-check-label">@caseType.Name</label>
                                                                        </div>
                                                                    </div>
                                                                }

                                                            }

                                                        </div>
                                                    }
                                                    @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                    {
                                                        <div class="row mt-1">
                                                            @if (CaseTypePerDiemList != null && CaseTypePerDiemList.Any())
                                                            {
                                                                @foreach (var caseType in CaseTypePerDiemList)
                                                                {
                                                                    <div class="col-auto">
                                                                        <div class="form-check">
                                                                            <input type="checkbox"
                                                                                   class="form-check-input bigger-checkbox"
                                                                                   @bind="caseType.IsSelected" disabled />
                                                                            <label class="form-check-label">@caseType.Name</label>
                                                                        </div>
                                                                    </div>
                                                                }
                                                            }


                                                        </div>
                                                    }
                                                    <!-- Case Details -->
                                                    <div class="row g-3 mt-2">

                                                        <div class=@(showCountyDropdown ? "col-md-3" : "col-md-6")>
                                                            <label class="form-label ">Court Type </label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CourtTypeId" style="cursor:pointer;" @bind-Value:after="SelectCourtType" disabled>
                                                                <option value="">-- Select --</option>
                                                                @foreach (var l in CourtTypeList)
                                                                {
                                                                    <option value="@l.Id">@l.Name</option>
                                                                }
                                                            </InputSelect>
                                                        </div>
                                                        <!-- Court Location -->

                                                        <div class=@(showCountyDropdown ? "col-md-3" : "d-none")>

                                                            <label class="form-label fw-semibold">County </label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CountyId" style="cursor:pointer;" @bind-Value:after="SelectCounty" disabled>
                                                                <option value="">-- Select --</option>
                                                                @foreach (var l in CountyList)
                                                                {
                                                                    <option value="@l.Id">@l.Name</option>
                                                                }
                                                            </InputSelect>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">Court <span class="text-danger">*</span></label>
                                                            <InputSelect class="form-select" @bind-Value="legalcaseDto.CourtLocationId" style="cursor:pointer;" @onmousedown="ShowAllCourts" @bind-Value:after="SelectCourt" disabled>
                                                                <option value="">-- Select --</option>
                                                                @foreach (var l in filteredCourts)
                                                                {
                                                                    <option value="@l.Id">@l.Court</option>
                                                                }
                                                            </InputSelect>
                                                        </div>
                                                        <!-- Part / Room # -->
                                                        @if (!showCourtPartDropdown)
                                                        {
                                                            <div class="col-md-6">
                                                                <label class="form-label fw-semibold">Part / Room #</label>
                                                                <InputText type="text" name="partRoom" class="form-control" @bind-Value="legalcaseDto.CourtRoom" disabled />
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div class="col-md-6">
                                                                <label class="form-label fw-semibold">Part / Room #</label>
                                                                <InputSelect class="form-select" @bind-Value="legalcaseDto.CourtPartId" style="cursor:pointer;" disabled>
                                                                    <option value="">-- Select --</option>
                                                                    @foreach (var l in CourtPartList)
                                                                    {
                                                                        <option value="@l.Id">@l.Part - @l.RoomNo</option>
                                                                    }
                                                                </InputSelect>
                                                            </div>
                                                        }



                                                        <!-- Index / LT Docket # -->
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">Index / LT Docket #</label>
                                                            <InputText type="text" name="docket" class="form-control" @bind-Value="legalcaseDto.Index" disabled />
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                    <!--party-->
                                    <div class="row">
                                        <!-- Left side: Case Information -->
                                        <div class="col">
                                            <div class="card mb-3 shadow-sm rounded-3">
                                                <div class="card-header fw-bold head">
                                                    Party Representation
                                                </div>

                                                <div class="card-body">
                                                    <!-- Representing -->
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <label class="form-label fw-semibold">
                                                                Representing <span class="text-danger">*</span>
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                        {
                                                            @if (PartyRepresentPerDiemList != null && PartyRepresentPerDiemList.Any())
                                                            {
                                                                <InputRadioGroup @bind-Value="legalcaseDto.PartyRepresentPerDiemId" class="d-flex flex-wrap">
                                                                    @foreach (var partyType in PartyRepresentPerDiemList)
                                                                    {
                                                                        <div class="col-auto">
                                                                            <div class="form-check mb-2">
                                                                                <InputRadio class="form-check-input"
                                                                                            id="@($"partyType_{partyType.Id}")"
                                                                                            Value="@partyType.Id" style="font-size:15px" disabled />
                                                                                <label class="form-check-label"
                                                                                       for="@($"partyType_{partyType.Id}")">@partyType.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                </InputRadioGroup>
                                                            }
                                                        }
                                                        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                                        {
                                                            @if (PartyRepresentList != null && PartyRepresentList.Any())
                                                            {
                                                                <InputRadioGroup @bind-Value="legalcaseDto.PartyRepresentId" class="d-flex flex-wrap">
                                                                    @foreach (var partyType in PartyRepresentList)
                                                                    {
                                                                        <div class="col-auto">
                                                                            <div class="form-check mb-2">
                                                                                <InputRadio class="form-check-input"
                                                                                            id="@($"partyType_{partyType.Id}")"
                                                                                            Value="@partyType.Id" style="font-size:15px" disabled />
                                                                                <label class="form-check-label"
                                                                                       for="@($"partyType_{partyType.Id}")">@partyType.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                </InputRadioGroup>
                                                            }
                                                        }

                                                    </div>



                                                    <!-- Party Details -->
                                                    <div class="row g-3">
                                                        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                                        {


                                                            <div class="col-md-12">
                                                                <label class="form-label fw-semibold">Petitioner / Tenant Name(s)  <span class="text-danger">*</span></label>

                                                                <div class="row mt-2 ">


                                                                    <div class="col-md-8 position-relative" @onfocusout="HideTenantsDropDown">

                                                                        @if (showTenantfields && selectedtenant == null)
                                                                        {


                                                                            <InputText class="form-control"
                                                                                       placeholder="Enter Tenant name"
                                                                                       @bind-value="searchTenantText"
                                                                                       @onblur="saveTenantName" disabled />
                                                                        }
                                                                        else
                                                                        {


                                                                            <InputText class="form-control "
                                                                                       placeholder="Search by  name or code..."
                                                                                       @bind-value="searchTenantText"
                                                                                       @oninput="OnSearchTenantHpdInput" @onblur="saveTenantName" @onclick="ShowAllTenant" @onfocus="OnTenantInputFocus" disabled />
                                                                        }





                                                                    </div>


                                                                    @if (AdditionalPetitioners.Count > 0)
                                                                    {
                                                                        @* <label class="mt-2 fw-semibold">Additional Petitioner(s)</label> *@

                                                                        @foreach (var t in AdditionalPetitioners)
                                                                        {
                                                                            <div class="row mt-2">
                                                                                <div class="col-md-8">
                                                                                    <InputText class="form-control" placeholder="Enter Additional Petitioner" disabled
                                                                                               @bind-Value="t.Name" />
                                                                                </div>


                                                                            </div>
                                                                        }
                                                                    }

                                                                </div>

                                                            </div>

                                                            <div class="col-md-12">
                                                                <label class="form-label fw-semibold">Respondent / Landlord Name(s) <span class="text-danger">*</span></label>

                                                                <div class="row mt-2 ">

                                                                    <div class="col-md-8 position-relative" @onfocusout="HideLandlordsDropDown">

                                                                        @if (showLandlordfields && selectedlandlord == null)
                                                                        {
                                                                            <InputText type="text" class="form-control"
                                                                                       placeholder="Enter Landlord name"
                                                                                       @bind-value="searchlandlordText"
                                                                                       @onblur="saveLandLordName" disabled />
                                                                        }
                                                                        else
                                                                        {
                                                                            <InputText type="text" class="form-control "
                                                                                       placeholder="Search by  name or code..."
                                                                                       @bind-value="searchlandlordText"
                                                                                       @oninput="OnSearchLandlordInput" @onblur="saveLandLordName" @onclick="ShowAlllandlords" disabled />
                                                                        }



                                                                    </div>


                                                                    @if (AdditionalRespondent.Count > 0)
                                                                    {
                                                                        @* <label class="mt-2 fw-semibold">Additional Petitioner(s)</label> *@

                                                                        @foreach (var t in AdditionalRespondent)
                                                                        {
                                                                            <div class="row mt-2">
                                                                                <div class="col-md-8">
                                                                                    <InputText class="form-control" placeholder="Enter Additional Petitioner" disabled
                                                                                               @bind-Value="t.Name" />
                                                                                </div>


                                                                            </div>
                                                                        }
                                                                    }
                                                                </div>

                                                            </div>



                                                            <!-- Managing Agent -->
                                                            <div class="col-md-6">
                                                                <label class="form-label fw-semibold">Managing Agent (if applicable)</label>
                                                                <InputText name="managingAgent" class="form-control" @bind-Value="legalcaseDto.ManagingAgent" disabled />
                                                            </div>

                                                            <!-- Opposing Counsel -->
                                                            <div class="col-md-6">
                                                                <label class="form-label fw-semibold">Opposing Counsel (if any)</label>
                                                                <InputText type="text" name="opposingCounsel" class="form-control" @bind-Value="legalcaseDto.OpposingCounsel" disabled />
                                                            </div>

                                                        }
                                                        @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                        {
                                                            <!-- Managing Agent -->
                                                            <div class="col-md-6">
                                                                <label class="form-label fw-semibold">Party Name(s)</label>
                                                                <InputText name="Partynames" class="form-control" @bind-Value="legalcaseDto.Partynames" disabled />
                                                            </div>

                                                            <!-- Opposing Counsel -->
                                                            <div class="col-md-6">
                                                                <label class="form-label fw-semibold">Opposing Counsel (if any)</label>
                                                                <InputText type="text" name="opposingCounsel" class="form-control" @bind-Value="legalcaseDto.OpposingCounsel" disabled />
                                                            </div>

                                                        }



                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--Building-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="card mb-3">
                                                <div class="card-header fw-bold head">Building Information</div>
                                                <div class="card-body row ">

                                                    <div class="mt-3 p-3 position-relative">

                                                        <div class="row">
                                                            <div class="col-6">
                                                                <label class="form-label  required-label">Building Address </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.BuildingAddress" placeholder="Enter BuildingAddress" disabled />



                                                            </div>
                                                            <div class="col-6">
                                                                <label class="form-label  required-label">Units </label>
                                                                <InputText class="form-control" @bind-Value="legalcaseDto.Units" placeholder="Enter Units" disabled />


                                                            </div>


                                                        </div>

                                                        <div class="row mt-4">

                                                            <div class="col-md-5">

                                                                <label class="form-label fw-semibold">
                                                                    Building Type <span class="text-danger">*</span>
                                                                </label>
                                                                @if (PremiseTypesList != null && PremiseTypesList.Any())
                                                                {
                                                                    <div class="row" style="display: flex;flex-wrap: wrap; margin-left:10px;">
                                                                        <InputRadioGroup @bind-Value="legalcaseDto.PremiseTypeId" class="d-flex gap-4 flex-wrap mt-2">

                                                                            @foreach (var Type in PremiseTypesList)
                                                                            {
                                                                                <div class="form-check d-flex align-items-center gap-1 col-6">
                                                                                    <InputRadio class="form-check-input"
                                                                                                id="@($"Type_{Type.Id}")"
                                                                                                Value="@Type.Id" disabled />

                                                                                    <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                                </div>
                                                                            }

                                                                        </InputRadioGroup>




                                                                    </div>
                                                                }
                                                            </div>

                                                            <div class="col-md-7">
                                                                <label class="form-label fw-semibold">
                                                                    Registration Status (HPD/DOF) <span class="text-danger">*</span>
                                                                </label>

                                                                <div class="row mt-1">
                                                                    @if (RegistrationstatusList != null && RegistrationstatusList.Any())
                                                                    {
                                                                        <div style="display: flex;flex-wrap: wrap; column-gap: 33px;">
                                                                            <InputRadioGroup @bind-Value="legalcaseDto.RegistrationStatusTypeId" class="d-flex flex-wrap">
                                                                                @foreach (var Type in RegistrationstatusList)
                                                                                {
                                                                                    <div class="col-12">
                                                                                        <div class="form-check">
                                                                                            <InputRadio class="form-check-input"
                                                                                                        id="@($"RegStatus_{Type.Id}")" disabled
                                                                                                        Value="@Type.Id" />
                                                                                            <label class="form-check-label" for="@($"RegStatus_{Type.Id}")">@Type.Name</label>
                                                                                        </div>
                                                                                    </div>
                                                                                }
                                                                            </InputRadioGroup>


                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>


                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--Petitioner-->
                                    <div class="row">
                                        <!-- Left side: Case Information -->
                                        <div class="col">
                                            <div class="card mb-3 shadow-sm rounded-3">
                                                <div class="card-header fw-bold  ">
                                                    Allegations of Harassment (Petitioner / Tenant)
                                                </div>

                                                <div class="card-body">
                                                    <label class="form-label fw-semibold">
                                                        Please select applicable Harassment
                                                    </label>
                                                    <div class="mb-3" id="allegationsGroup">
                                                        <!-- Repeated interruptions -->
                                                        @if (HarassmentTypesList != null && HarassmentTypesList.Any())
                                                        {
                                                            @foreach (var Type in HarassmentTypesList)
                                                            {
                                                                <div class="col-12">
                                                                    <div class="form-check">
                                                                        <input type="checkbox"
                                                                               class="form-check-input" disabled
                                                                               @bind="Type.IsSelected" />
                                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                    </div>
                                                                </div>
                                                            }
                                                        }



                                                    </div>


                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--Respondent-->
                                    <div class="row">
                                        <!-- Left side: Case Information -->
                                        <div class="col">
                                            <div class="card mb-3 shadow-sm rounded-3">
                                                <div class="card-header fw-bold">
                                                    Defense / Position (Respondent / Landlord)
                                                </div>

                                                <div class="card-body">
                                                    <label class="form-label fw-semibold">
                                                        Please select applicable defenses
                                                    </label>

                                                    <div id="defensesGroup" class="mb-3">
                                                        @if (DefenseTypesList != null && DefenseTypesList.Any())
                                                        {
                                                            @foreach (var Type in DefenseTypesList)
                                                            {
                                                                <div class="col-6">
                                                                    <div class="form-check">
                                                                        <input type="checkbox"
                                                                               class="form-check-input" disabled
                                                                               @bind="Type.IsSelected" />
                                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                    </div>
                                                                </div>
                                                            }
                                                        }

                                                    </div>


                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--Appearance-->
                                    <div class="row">
                                        <!-- Left side: Case Information -->
                                        <div class="col">
                                            <div class="card mb-3 shadow-sm rounded-3">
                                                <div class="card-header fw-bold ">
                                                    Appearance Details
                                                </div>

                                                <div class="card-body">
                                                    <!-- Date & Time -->
                                                    <div class="row g-3 mb-4">
                                                        <!-- Date of Appearance -->
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">
                                                                Date of Appearance <span class="text-danger">*</span>
                                                            </label>
                                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" name="appearanceDate" Style="width:100%;" @bind-Value="legalcaseDto.AppearanceDate" disabled />

                                                        </div>

                                                        <!-- Time of Appearance -->
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">
                                                                Time of Appearance <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="time" name="appearanceTime" class="form-control" @bind="legalcaseDto.AppearanceTime" disabled />

                                                        </div>
                                                    </div>

                                                    <!-- Type of Appearance -->
                                                    <div class="mb-3 row">

                                                        <label class="form-label fw-semibold">
                                                            Type of Appearance <span class="text-danger">*</span>
                                                        </label>

                                                        <div id="appearanceTypeGroup" style="display:flex; align-items:ceneter ; flex-wrap:wrap">
                                                            <!-- Checkboxes -->
                                                            @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                                            {

                                                                @if (AppearanceTypesList != null && AppearanceTypesList.Any())
                                                                {
                                                                    @foreach (var Type in AppearanceTypesList)
                                                                    {
                                                                        <div class="col-12">
                                                                            <div class="form-check form-check-inline me-3">
                                                                                <input type="checkbox"
                                                                                       class="form-check-input" disabled
                                                                                       @bind="Type.IsSelected" />
                                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                }


                                                            }

                                                            @if (legalcaseDto.CaseTypeName == "Per Diem")
                                                            {

                                                                @if (AppearanceTypesPerDiemList != null && AppearanceTypesPerDiemList.Any())
                                                                {
                                                                    @foreach (var Type in AppearanceTypesPerDiemList)
                                                                    {

                                                                        <div class="form-check form-check-inline me-3">
                                                                            <input type="checkbox"
                                                                                   class="form-check-input" disabled
                                                                                   @bind="Type.IsSelected" />
                                                                            <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                        </div>

                                                                    }
                                                                }


                                                            }


                                                        </div>


                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--Relief-->
                                    <div class="row">
                                        <!-- Left side: Case Information -->
                                        <div class="col">
                                            <div class="card mb-3 shadow-sm rounded-3">
                                                <div class="card-header fw-bold ">
                                                    Relief Requested
                                                </div>

                                                <div class="card-body">
                                                    <div class="row g-4">
                                                        <!-- Petitioner / Tenant -->
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">Petitioner / Tenant  </label>

                                                            <div id="reliefPetitionerGroup">
                                                                @if (ReliefPetitionerTypesList != null && ReliefPetitionerTypesList.Any())
                                                                {
                                                                    @foreach (var Type in ReliefPetitionerTypesList)
                                                                    {
                                                                        <div class="col-12">
                                                                            <div class="form-check">
                                                                                <input type="checkbox"
                                                                                       class="form-check-input" disabled
                                                                                       @bind="Type.IsSelected" />
                                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                }


                                                            </div>
                                                        </div>

                                                        <!-- Respondent / Landlord -->
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">Respondent / Landlord  </label>

                                                            <div id="reliefRespondentGroup">
                                                                @if (ReliefRespondentTypesList != null && ReliefRespondentTypesList.Any())
                                                                {
                                                                    @foreach (var Type in ReliefRespondentTypesList)
                                                                    {
                                                                        <div class="col-12">
                                                                            <div class="form-check">
                                                                                <input type="checkbox"
                                                                                       class="form-check-input" disabled
                                                                                       @bind="Type.IsSelected" />
                                                                                <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                }

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <!--Biling-->
                                <div class="row">
                                    <!-- Left side: Case Information -->
                                    <div class="col">
                                        <div class="card mb-3 shadow-sm rounded-3">
                                            <div class="card-header fw-bold ">
                                                <div class=" fw-bold ">
                                                    @(legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout"
                                                                                                    ? "Billing Information (if per diem)"
                                                                                                    : "Billing")
                                                                                                            </div>

                                            </div>

                                            <div class="card-body">
                                                <!-- Billing Type -->
                                                <div class="mb-3">
                                                    <label class="form-label fw-semibold">
                                                        @(legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout"
                                                                                                            ? "Billing Type"
                                                                                                            : "Rate / Compensation")  <span class="text-danger">*</span>
                                                </label>

                                                @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
                                                        {
                                                            <div id="billingRadio" class="d-flex flex-wrap align-items-center gap-3">
                                                                @if (BilingTypesList != null && BilingTypesList.Any())
                                                                {
                                                                    <InputRadioGroup @bind-Value="legalcaseDto.BilingTypeId" class="d-flex flex-wrap">
                                                                        <div class="d-flex align-items-center gap-4">

                                                                            @foreach (var Type in BilingTypesList)
                                                                            {
                                                                                <div class="d-flex align-items-center">

                                                                                    <!-- Radio -->
                                                                                    <InputRadio class="form-check-input me-2"
                                                                                                Value="@Type.Id"
                                                                                                checked="@(legalcaseDto.BilingTypeId == Type.Id)"
                                                                                                @onchange="() => OnBilingTypeHpdChanged(Type.Id)" disabled
                                                                                                id="@($"Type_{Type.Id}")" />

                                                                                    <!-- Label -->
                                                                                    <label class="form-check-label me-3" for="@($"Type_{Type.Id}")">
                                                                                        @Type.Name
                                                                                    </label>
                                                                                </div>
                                                                            }

                                                                        </div>
                                                                    </InputRadioGroup>
                                                                    <ValidationMessage For="() => legalcaseDto.BilingTypeId" />
                                                                }

                                                            </div>


                                                            <!-- Invoice To -->
                                                            <div class="row mt-3">
                                                                <div class="col-md-6">
                                                                    <label class="form-label fw-semibold">Invoice To</label>
                                                                    <InputText type="text" class="form-control" name="invoiceTo" placeholder="Name or Organization" @bind-Value="legalcaseDto.InvoiceTo" disabled />
                                                                </div>
                                                            </div>
                                                        }
                                                        else
                                                        {

                                                            <div class="row">
                                                                <div class="col-12">
                                                                    @if (BilingTypesList != null && BilingTypesList.Any())
                                                                    {
                                                                        <InputRadioGroup @bind-Value="legalcaseDto.BilingTypeId" class="d-flex flex-wrap">
                                                                            <div class="d-flex align-items-center gap-4">

                                                                                @foreach (var Type in BilingTypesList)
                                                                                {
                                                                                    <div class="d-flex align-items-center">

                                                                                        <!-- Radio -->
                                                                                        <InputRadio class="form-check-input me-2"
                                                                                                    Value="@Type.Id" disabled
                                                                                                    id="@($"Type_{Type.Id}")"
                                                                                                    @onclick="@(() => OnBillingTypeChanged(Type.Id))" />

                                                                                        <!-- Label -->
                                                                                        <label class="form-check-label me-3" for="@($"Type_{Type.Id}")">
                                                                                            @Type.Name
                                                                                        </label>

                                                                                        <!-- Input box (same horizontal line) -->
                                                                                        @if (legalcaseDto.BilingTypeId == Type.Id)
                                                                                        {
                                                                                            <input type="number"
                                                                                                   class="form-control"
                                                                                                   style="width: 180px;"
                                                                                                   placeholder="@(Type.Name == "Flat Rate" ? "$" : "$ / hr")"
                                                                                                   @bind="legalcaseDto.BilingTypeInputValue" disabled />
                                                                                        }

                                                                                    </div>
                                                                                }

                                                                            </div>


                                                                        </InputRadioGroup>

                                                                    }
                                                                </div>
                                                            </div>
                                                            <div class="row mt-4">
                                                                <div class="col-6">
                                                                    <label class="form-label fw-semibold mb-3">Travel / Other Expenses </label>
                                                                    <InputText class="form-control" placeholder="Optional" @bind-Value="legalcaseDto.TravelExpense" disabled />
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="form-label fw-semibold">Payment Method  <span class="text-danger">*</span></label>

                                                                    <div id="reliefRespondentGroup " class="d-flex">
                                                                        @if (PaymentMethodDtoList != null && PaymentMethodDtoList.Any())
                                                                        {
                                                                            <InputRadioGroup @bind-Value="legalcaseDto.PaymentMethodId" class="d-flex flex-wrap">
                                                                                @foreach (var method in PaymentMethodDtoList)
                                                                                {
                                                                                    <div class="col-6 ">
                                                                                        <div class="form-check mb-2">
                                                                                            <InputRadio class="form-check-input"
                                                                                                        id="@($"partyType_{method.Id}")"
                                                                                                        Value="@method.Id" disabled />
                                                                                            <label class="form-check-label"
                                                                                                   for="@($"method{method.Id}")">@method.Name</label>
                                                                                        </div>
                                                                                    </div>
                                                                                }
                                                                            </InputRadioGroup>
                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            }
            @if (Steps[CurrentStep].Name == "Background")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Case BackGround (Brief)
                                </div>

                                <div class="card-body">

                                    <div class="mb-3 row">
                                        <div class="col-md-12">
                                            <label class="form-label fw-semibold">Key Facts to Know (bullet points) <span class="text-danger">*</span></label>
                                            <InputTextArea class="form-control" name="CaseBackground" placeholder="Enter Your Case In Brief" @bind-Value="legalcaseDto.CaseBackground" />
                                            <ValidationMessage For="() => legalcaseDto.CaseBackground" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }

            @if (Steps[CurrentStep].Name == "Document")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Documents & Instructions
                                </div>

                                <div class="card-body">
                                    <div id="appearanceTypeGroup" style="display:flex; align-items:center ; flex-wrap:wrap">
                                        @if (DocumentInstructionPerDiemList != null && DocumentInstructionPerDiemList.Any())
                                        {
                                            @foreach (var Type in DocumentInstructionPerDiemList)
                                            {
                                                <div class="col-4">
                                                    <div class="form-check form-check-inline me-3 ">
                                                        <input type="checkbox"
                                                               class="form-check-input"
                                                               id="@($"Type_{Type.Id}")"
                                                               @bind="Type.IsSelected" />
                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>




                                    <div class="mb-3 row mt-3">
                                        <div class="col-md-12">
                                            <label class="form-label fw-semibold">Special Instructions from Hiring Attorney</label>
                                            <InputTextArea class="form-control" name="CaseBackground" placeholder="Enter Your Case In Brief" @bind-Value="legalcaseDto.SpecialInstruction" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }
            @if (Steps[CurrentStep].Name == "Reporting")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Reporting Requirements
                                </div>

                                <div class="card-body">
                                    <div class="mb-3 row">
                                        <div class="col-md-12 d-flex flex-wrap">
                                            @if (ReportingRequirementPerDiemList != null && ReportingRequirementPerDiemList.Any())
                                            {
                                                @foreach (var Type in ReportingRequirementPerDiemList)
                                                {
                                                    <div class="form-check form-check-inline me-3 col-12">
                                                        <input type="checkbox"
                                                               class="form-check-input"
                                                               id="@($"Type_{Type.Id}")"
                                                               @bind="Type.IsSelected" />
                                                        <label class="form-check-label" for="@($"Type_{Type.Id}")">@Type.Name</label>
                                                    </div>
                                                }
                                            }
                                        </div>
                                    </div>



                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>

            }
            @if (Steps[CurrentStep].Name == "Acknowledgment")
            {
                <div class="container tenant-scroll-container">
                    <div class="row">
                        <!-- Left side: Case Information -->
                        <div class="col-md-8">
                            <div class="card mb-3 shadow-sm rounded-3">
                                <div class="card-header fw-bold ">
                                    Acknowledgment
                                </div>

                                <div class="card-body">
                                    <h6>I, (Per Diem Attorney) accept responsibility to appear and represent the above party in accordance with instructions provided.</h6>
                                    <div class="mb-3 row mt-2">
                                        <div class="col-md-4 ">

                                            <label class="form-label fw-semibold">Per Diem Attorney (Name)<span class="text-danger">*</span></label>
                                            <InputText type="text" class="form-control" @bind-Value="legalcaseDto.PerDiemAttorneyname" placeholder="Enter Attorney Name" />
                                            <ValidationMessage For="() => legalcaseDto.PerDiemAttorneyname" />

                                        </div>
                                        <div class="col-md-4 ">

                                            <label class="form-label fw-semibold">Signature<span class="text-danger">*</span></label>
                                            <InputText type="text" class="form-control" placeholder="Type Full Name" @bind-Value="legalcaseDto.PerDiemSignature" />
                                            <ValidationMessage For="() => legalcaseDto.PerDiemSignature" />

                                        </div>
                                        <div class="col-md-4 ">

                                            <label class="form-label fw-semibold">Date<span class="text-danger">*</span></label>
                                            <RadzenDatePicker DateFormat="@DateFormats.Default" AllowInput="false" ShowButton="true" Style="width:100%; box-shadow:none; cursor:pointer; "  @bind-Value="legalcaseDto.PerDiemDate" />
                                            <ValidationMessage For="() => legalcaseDto.PerDiemDate" />

                                        </div>
                                    </div>



                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <TipsSummary />
                        </div>
                    </div>
                </div>
            }

        }




        @if (legalcaseDto.CaseTypeName == "Holdover")
        {
            <div class="d-flex justify-content-between border-top pt-3 mt-3" style="position: fixed; bottom: 25px; left: 260px; right: 10px;">
                <button type="button" class="btn btn-outline-secondary" style="height: 45px; width: 115px;" @onclick="Prev" disabled="@( Steps[CurrentStep].Name == "CaseAndclient")">← Back</button>
                @if (Steps[CurrentStep].Name != "Review")
                {
                    <button type="button" class="btn" style="height: 45px; width: 115px;background-color:#1F365D !important; color:white" @onclick="Next">Next →</button>
                }
                else
                {
                    <button type="button" class="btn btn-success" @onclick="UpdateAsync">Submit</button>
                }


            </div>
        }
        @if (legalcaseDto.CaseTypeName == "NonPayment")
        {
            <div class="d-flex justify-content-between border-top pt-3 mt-3" style="position: fixed; bottom: 25px; left: 260px; right: 10px;">
                <button type="button" class="btn btn-outline-secondary" style="height: 45px; width: 115px;" @onclick="Prev" disabled="@( Steps[CurrentStep].Name == "CaseAndclient")">← Back</button>
                @if (Steps[CurrentStep].Name != "Review")

                {
                    <button type="button" class="btn" style="background-color:#1F365D !important; color:white;height: 45px; width: 115px;" @onclick="Next">Next →</button>
                }
                else
                {
                    <button type="button" class="btn btn-success" style="height: 45px; width: 115px;" @onclick="UpdateAsync">Submit</button>
                }


            </div>
        }

        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
        {
            <div class="d-flex justify-content-between border-top pt-3 mt-3" style="position: fixed; bottom: 25px; left: 260px; right: 10px;">
                <button type="button" class="btn btn-outline-secondary" style="height: 45px; width: 115px;" @onclick="Prev" disabled="@( Steps[CurrentStep].Name == "CaseAndclient")">← Back</button>
                @if (Steps[CurrentStep].Name != "Review")
                {
                    <button type="button" class="btn" style="background-color:#1F365D !important; color:white;height: 45px; width: 115px;" @onclick="Next">Next →</button>
                }
                else
                {
                    <button type="button" class="btn btn-success" style="height: 45px; width: 115px;" @onclick="UpdateAsync">Submit</button>
                }


            </div>



        }

        @if (legalcaseDto.CaseTypeName == "Per Diem")
        {
            <div class="d-flex justify-content-between border-top pt-3 mt-3" style="position: fixed; bottom: 25px; left: 260px; right: 10px;">
                <button type="button" class="btn btn-outline-secondary" style="height: 45px; width: 115px;" @onclick="Prev" disabled="@( Steps[CurrentStep].Name == "CaseAndclient")">← Back</button>
                @if (Steps[CurrentStep].Name != "Billing")
                {
                    <button type="button" class="btn" style="background-color:#1F365D !important; color:white;height: 45px; width: 115px;" @onclick="Next">Next →</button>
                }
                else
                {
                    <button type="button" class="btn btn-success" style="height: 45px; width: 115px;" @onclick="UpdateAsync">Submit</button>
                }


            </div>
        }
    </EditForm>


</div>

@code {
    [Parameter]
    public Guid caseId { get; set; }
    bool IsDisabled = true;
    // public List<Step> Steps { get; set; } = Enum.GetValues<Step>().ToList();
    public List<StepItems> Steps { get; set; } = new();
    public int Tracker { get; set; }

    private string ClientName { get; set; } = "";
    private string Tenancy { get; set; } = "";
    private DateTime? MovedIn { get; set; }
    private string RentDueDate { get; set; } = "1";
    private int CalcNoticeLength { get; set; }
    private List<CourtDto> filteredCourts = new();
    private List<EditToCountyDto> CountyList = new();

    private string searchCourtText;
    bool HideCaseAndClientSection =>
 legalcaseDto.CaseTypeId != null
 && legalcaseDto.CaseTypeId != Guid.Empty
 && legalcaseDto.ClientId != null
 && legalcaseDto.ClientId != Guid.Empty;
    bool IsLandlordSelected => selectedlandlord != null;



    // Merge preview
    private NoticeMergeModel MergeData { get; set; } = new NoticeMergeModel();

    private CancellationTokenSource _cts;
    bool isBuildingSelected = false;
    bool IsExistingBuildingSelected => selectedbuilding != null;
    private bool IsTenantSelected => selectedtenant != null;
    private string searchCountyText;
    private List<EditToCountyDto> filteredCounties = new();


    private IntakeModel legalcaseDto = new IntakeModel();
    public int CurrentStep { get; set; }
    private EditContext _editContext;
    private ValidationMessageStore messageStore;
    public List<IsUnitIllegal> IsUnitIllegalList = new();
    private List<RegulationStatus> RegulationList = new();
    private List<LandlordType> LandLordTypeList = new();
    private List<State> StateList = new();
    private IEnumerable<City> CityList = new List<City>();
    private List<ClientRole> ClientTypeList = new();
    private List<CaseType> CaseTypeList = new();
    private IEnumerable<SubCaseType> SubCaseTypeList = new List<SubCaseType>();
    private List<TenancyType> TenancyTypeList = new();
    private List<DateRent> DateRentList = new();
    private List<CaseProgram> CaseProgramList = new();
    private List<EditToClientDto> ClientList = new();
    private List<EditToLandlordDto> LandlordList = new();
    private List<EditToBuildingDto> BuildingList = new();
    private List<EditToTenantDto> TenantList = new();
    private List<EditToTenantDto> filteredTenantList = new();
    private List<AddtionalTenantDto> AdditionalTenantList = new();
    private List<AdditionalOccupantDto> AdditionalOccupantsList = new();
    private List<AdditioanlTenants> AdditionalTenantfromDbList = new();
    private List<CaseAdditionalTenants> CaseAdditionalTenantfromDbList = new();
    private string? loggedInUserId;
    private bool isAdmin = false;
    private bool IsNewTenants = false;
    private CreateToTenantDto newTenant = new();
    private bool? canbool = null;
    private bool showLandlordfields = false;
    private bool showTenantfields = false;
    private bool showBuildingfields = false;
    private int currentPage = 1;
    private int pageSize = 10;
    private string searchTerm = "";
    private string LastrentPaid = "";
    private bool isLoading = true;

    private List<CaseTypePerDiemDto> CaseTypePerDiemList = new();
    private List<PremiseType> PremiseTypesList = new();
    private List<CaseTypeHPDDto> CaseTypeHPDList = new();
    private List<PartyRepresent> PartyRepresentList = new();
    private List<PartyRepresentPerDiem> PartyRepresentPerDiemList = new();
    private List<BuildingType> BuildingTypesList = new();
    private List<Registrationstatus> RegistrationstatusList = new();
    private List<HarassmentTypeDto> HarassmentTypesList = new();
    private List<DefenseTypeDto> DefenseTypesList = new();
    private List<ApperenceTypeDto> AppearanceTypesList = new();
    private List<CourtDto> CourtLocationList = new();
    private List<ApperenceTypeDto> AppearanceTypesPerDiemList = new();
    private List<ReliefPetitionerTypeDto> ReliefPetitionerTypesList = new();
    private List<ReliefRespondentTypeDto> ReliefRespondentTypesList = new();
    private List<BilingType> BilingTypesList = new();
    private List<DocumentInstructionPerDiemDto> DocumentInstructionPerDiemList = new();
    private List<ReportingRequirementPerDiemDto> ReportingRequirementPerDiemList = new();
    private List<PaymentMethod> PaymentMethodDtoList = new();
    bool tenantLoadedFromLandlord = false;
    private List<EditToTenantDto> filteredTenants = new();
    private List<EditToTenantDto> masterTenantList = new();
    private List<FormAddEditViewModelDto> FilteredFormTypeList = new();
    private IEnumerable<ExemptionBasic> ExemptionBasicList = new List<ExemptionBasic>();
    private IEnumerable<ExemptionReason> ExemptionReasonList = new List<ExemptionReason>();
    private IEnumerable<TenancyTypeForBuilding> TenancyTypeForBuildingList = new List<TenancyTypeForBuilding>();

    bool ShowExemptionBasic =>
    RegulationList.Any(r =>
        r.Id == legalcaseDto.RegulationStatusId &&
        r.Name == "Exempt");

    bool ShowExemptionOther =>
      ExemptionBasicList.Any(r =>
          r.Id == legalcaseDto.ExemptionBasisId &&
          r.Name == "Other");

    bool ShowRentOther =>
RegulationList.Any(r =>
r.Id == legalcaseDto.RegulationStatusId &&
r.Name == "Other");
    string ColumnClass => ShowExemptionBasic || ShowRentOther ? "col-md-4" : "col-md-6";

    protected override async Task OnInitializedAsync()
    {
        spinnerservice.Show();
        legalcaseDto = new IntakeModel();
        _editContext = new EditContext(legalcaseDto);
        messageStore = new ValidationMessageStore(_editContext);
        legalcaseDto = await _legalCaseService.GetCaseByIdAsync(caseId);

        CaseTypeList = await CaseTypeRepository.GetAllCaseType();
        SubCaseTypeList = await _legalCaseService.GetSubCaseList();
        var defaultCaseType = CaseTypeList.FirstOrDefault(x =>
                     x.Name.Equals("Holdover", StringComparison.OrdinalIgnoreCase));

        if (defaultCaseType != null && (legalcaseDto.CaseTypeId == null || legalcaseDto.CaseTypeId == Guid.Empty))
        {
            legalcaseDto.CaseTypeId = defaultCaseType.Id;
            legalcaseDto.CaseTypeName = defaultCaseType.Name;
        }

        ClientTypeList = await ClientRoleRepository.GetAllClientRole();
        ClientList = await _clientService.GetAllClient(loggedInUserId, isAdmin);
        // showClientTextbox = true;
        searchText = legalcaseDto.ClientName;
        selectedClient = ClientList.Where(e => e.Id == legalcaseDto.ClientId).FirstOrDefault() ?? new EditToClientDto();

        // CaseTypeHPDList = await CaseTypeRepository.GetAllCaseTypeHPD();
        // CaseTypePerDiemList = await CaseTypeRepository.GetAllCaseTypePerDiem();
        // PartyRepresentList = await CaseTypeRepository.GetAllpartyRepresenting();
        // PartyRepresentPerDiemList = await CaseTypeRepository.GetAllpartyRepresentingPerDiem();
        // DocumentInstructionPerDiemList = await CaseTypeRepository.GetAllDocumentInstructionPerDiem();
        // ReportingRequirementPerDiemList = await CaseTypeRepository.GetAllReportingRequirementPerDiem();
        // PaymentMethodDtoList = await CaseTypeRepository.GetAllPaymentMethod();
        // BuildingTypesList = await CaseTypeRepository.GetAllBuildingTypes();
        // RegistrationstatusList = await CaseTypeRepository.GetAllRegistrationstatus();
        // HarassmentTypesList = await CaseTypeRepository.GetAllHarassmentTypes();
        // DefenseTypesList = await CaseTypeRepository.GetAllDefenseTypes();
        // AppearanceTypesList = await CaseTypeRepository.GetAllAppearanceTypes();
        // AppearanceTypesPerDiemList = await CaseTypeRepository.GetAllAppearanceTypesPerDiem();
        // PremiseTypesList = await PremiseTypeRepository.GetAllPremiseType();
        // ReliefPetitionerTypesList = await CaseTypeRepository.GetAllReliefPetitionerTypes();
        // ReliefRespondentTypesList = await CaseTypeRepository.GetAllReliefRespondentTypes();
        // BilingTypesList = await CaseTypeRepository.GetAllBilingTypes();
        LandLordTypeList = await LandlordTypeRepository.GetAllLandLordType();
        IsUnitIllegalList = await UnitIllegalRepository.GetAllUnitIllegal();
        // RegulationList = await RegulationStatusRepository.GetAllRegulationStatus();
        // TenancyTypeList = await TenancyTypeRepository.GetAllTenancyType();
        // CourtLocationList = await _courtService.GetAllCourtDataAsync();
        // DateRentList = await DateRentRepository.GetAllDateRent();
        // StateList = await _stateRepository.GetAllState();
        CountyList = await _countyService.GetAllCounty();
        // ClientTypeList = await ClientRoleRepository.GetAllClientRole();
        // CaseProgramList = await _caseprogram.GetAllCaseProgram();
        // FilteredFormTypeList = await _FormService.GetFormTypesByCaseTypeAsync(legalcaseDto.CaseTypeId);
        // FilingMethodList = await _legalCaseService.FilingMethodList();
        // ServiceMethodList = await _legalCaseService.ServiceMethodList();
        // Rows = legalcaseDto.ArrearLedgers;
        searchCourtText = legalcaseDto.CourtName;
        searchCountyText = legalcaseDto.CountyName;




        // searchlandlordText = legalcaseDto.landlordName;
        // showLandlordfields = true;

        // LandlordList = await _landlordService.GetAllLandLordsAsync();
        // selectedlandlord = LandlordList.Where(e => e.Id == legalcaseDto.LandlordId).FirstOrDefault() ?? new EditToLandlordDto();
        // legalcaseDto.LandLordTypeId = selectedlandlord.LandlordTypeId;



        // if (legalcaseDto.BuildingId != null && legalcaseDto.BuildingId != Guid.Empty)
        // {
        //     TenantList = await _tenantService.GetTenantsByClientIdAsync(legalcaseDto.BuildingId!.Value);
        //     selectedtenant = TenantList.Where(e => e.Id == legalcaseDto.TenantId).FirstOrDefault() ?? new EditToTenantDto();
        //     Tenants.Add($"{selectedtenant.FirstName} {selectedtenant.LastName}");

        // }

        // if (legalcaseDto.TenantId != null && legalcaseDto.TenantId != Guid.Empty)
        // {
        //     AdditionalTenantfromDbList = await _additionalTenant.GetAllAdditionalTenantsAsync(legalcaseDto.TenantId);
        //     AdditionalOccupantsList = await _additionalOccupant.GetAllAdditionalOccupantsAsync(legalcaseDto.Id);
        // }


        // if (AdditionalTenantfromDbList.Any())
        // {
        //     Tenants.AddRange(AdditionalTenantfromDbList.Select(e => $"{e.FirstName} {e.LastName}").ToList());
        //     AdditionalTenantList.AddRange(AdditionalTenantfromDbList.Select(e => new AddtionalTenantDto
        //         {
        //             FirstName = e.FirstName,
        //             LastName = e.LastName,
        //             Id = e.Id,
        //             TenantId = e.TenantId
        //         }).ToList());
        // }

        // if(AdditionalOccupantsList.Any())
        // {
        //     Undertenants.AddRange(AdditionalOccupantsList.Select(e => e.Name).ToList());
        // }
        //LastrentPaid = legalcaseDto.LastRentPaid;

        if (!string.IsNullOrEmpty(legalcaseDto.LastRentPaid))
        {
            if (DateTime.TryParseExact(legalcaseDto.LastRentPaid, "MMMM yyyy", null, System.Globalization.DateTimeStyles.None, out var dt))
            {
                LastrentPaid = dt.ToString("yyyy-MM");
            }
        }

        // LandLordTypeList = await LandlordTypeRepository.GetAllLandLordType();
        // IsUnitIllegalList = await UnitIllegalRepository.GetAllUnitIllegal();
        // RegulationList = await RegulationStatusRepository.GetAllRegulationStatus();
        // TenancyTypeList = await TenancyTypeRepository.GetAllTenancyType();
        // DateRentList = await DateRentRepository.GetAllDateRent();
        // StateList = await _stateRepository.GetAllState();

        // ClientTypeList = await ClientRoleRepository.GetAllClientRole();
        // CaseProgramList = await _caseprogram.GetAllCaseProgram();


        var authState = await _authStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity != null && user.Identity.IsAuthenticated)
        {
            loggedInUserId = user.Claims.FirstOrDefault(c => c.Type == ClaimTypes.NameIdentifier)?.Value;
            isAdmin = user.Claims.Any(c => c.Type == ClaimTypes.Role && c.Value == "Admin");
        }

        // foreach (var item in CaseTypeHPDList)
        // {
        //     if (legalcaseDto.SelectedCaseTypeHPDIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }
        // foreach (var item in CaseTypePerDiemList)
        // {
        //     if (legalcaseDto.SelectedCaseTypePerDiemIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }
        // foreach (var item in DefenseTypesList)
        // {
        //     if (legalcaseDto.SelectedDefenseTypeIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // foreach (var item in HarassmentTypesList)
        // {
        //     if (legalcaseDto.SelectedHarassmentTypeIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // foreach (var item in AppearanceTypesList)
        // {
        //     if (legalcaseDto.SelectedAppearanceTypeIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // foreach (var item in AppearanceTypesPerDiemList)
        // {
        //     if (legalcaseDto.SelectedAppearanceTypePerDiemIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }
        // foreach (var item in ReliefPetitionerTypesList)
        // {
        //     if (legalcaseDto.SelectedReliefPetitionerTypeIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // foreach (var item in ReliefRespondentTypesList)
        // {
        //     if (legalcaseDto.SelectedReliefRespondentTypeIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // foreach (var item in DocumentInstructionPerDiemList)
        // {
        //     if (legalcaseDto.SelectedDocumentInstructionPerDiemIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // foreach (var item in ReportingRequirementPerDiemList)
        // {
        //     if (legalcaseDto.SelectedReportingRequirementPerDiemIds.Contains(item.Id))
        //     {
        //         item.IsSelected = true;   // UI checkbox checked hoga
        //     }
        // }

        // if (legalcaseDto.ClientId.HasValue)
        // {
        //     showClientTextbox = false;
        //     IsNewClient = false;
        // }

        // if (legalcaseDto.BuildingId.HasValue)
        // {
        //     isBuildingSelected = true;
        //     showBuildingfields = false;
        //     IsNewBuilding = false;
        // }

        ExemptionBasicList = await ExemptionBasicRepository.GetAllAsync();
        ExemptionReasonList = await ExemptionReasonRepository.GetAllAsync();
        TenancyTypeForBuildingList = await TenancyTypeForBuildingRepository.GetAllAsync();

        GenerateMonths();
        await BuildSteps();
        spinnerservice.Hide();

    }
    bool tenantStepLoaded = false;
    bool buildingStepLoaded = false;
    bool landlordStepLoaded = false;
    bool caseInfoStepLoaded = false;
    bool noticeStepLoaded = false;
    bool CaseTypeStepLoaded = false;
    bool AppearanceStepLoaded = false;
    bool AppearanceStepLoaded1 = false;
    bool PetitionerStepLoaded = false;
    bool RespondedStepLoaded = false;
    bool ReliefStepLoaded = false;
    bool DocumentStepLoaded = false;
    bool ReportingStepLoaded = false;
    bool PartyStepLoaded = false;
    bool showCountyDropdown = false;
    bool showCourtPartDropdown = false;
    private IEnumerable<CourtType> CourtTypeList = new List<CourtType>();
    private List<CourtPartDto> CourtPartList = new();
    private List<CaseAdditionalPetitioner> AdditionalPetitioners { get; set; } = new();
    private List<CaseAdditionalPetitioner> AdditionalPetitionersDelete { get; set; } = new();
    private List<CaseAdditionalRespondent> AdditionalRespondent { get; set; } = new();
    private List<CaseAdditionalRespondent> AdditionalRespondentDelete { get; set; } = new();

    private async Task Next()
    {

        if (!await ValidateCurrentStep()) return;
        spinnerservice.Show();
        //legalcaseDto.LandLordTypeName = LandLordTypeList.FirstOrDefault(x => x.Id == legalcaseDto.LandLordTypeId)?.Name;
        //legalcaseDto.RegulationStatusName = RegulationList.FirstOrDefault(x => x.Id == legalcaseDto.RegulationStatusId)?.Name;
        //legalcaseDto.IsUnitIllegalName = IsUnitIllegalList.FirstOrDefault(x => x.Id == legalcaseDto.IsUnitIllegalId)?.Name;
        //legalcaseDto.TenancyTypeName = TenancyTypeList.FirstOrDefault(x => x.Id == legalcaseDto.TenancyTypeId)?.Name;

        //CalcNoticeLength = CalcNoticeDays(Tenancy, MovedIn);
        var dueDay = ParseDueDay(RentDueDate);
        // await GetAllLists();

        @if (legalcaseDto.CaseTypeName == "Holdover" || legalcaseDto.CaseTypeName == "NonPayment")
        {
            if (CurrentStep < Steps.Count() - 1)
            {

                CurrentStep++;
                Tracker++;

            }

            // if (CurrentStep == Step.Notice)
            // {
            //     //BuildNoticeMerge();
            // }
        }

        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
        {
            if (CurrentStep < Steps.Count() - 1)
            {

                CurrentStep++;
                Tracker++;

            }


        }

        @if (legalcaseDto.CaseTypeName == "Per Diem")
        {
            if (CurrentStep < Steps.Count() - 1)
            {

                CurrentStep++;
                Tracker++;

            }


        }

        if (Steps[CurrentStep].Name == "Building" && !buildingStepLoaded)
        {
            showBuildingfields = true;
            isBuildingSelected = true;
            IsNewBuilding = false;
            searchBuildingText = legalcaseDto.Buildingcode ?? string.Empty;
            if (legalcaseDto.LandlordId != null && legalcaseDto.LandlordId != Guid.Empty)
            {
                if (!BuildingList.Any()) BuildingList = await _buildingService.GetBuildingsByLandlordIdAsync(legalcaseDto.LandlordId!.Value);
                if (selectedbuilding == null) selectedbuilding = BuildingList.Where(e => e.Id == legalcaseDto.BuildingId).FirstOrDefault() ?? new EditToBuildingDto();
            }
            if (!StateList.Any()) StateList = await _stateRepository.GetAllState();

            if (!CityList.Any()) CityList = await _legalCaseService.GetAllCitiesList();
            if (!BuildingTypesList.Any()) BuildingTypesList = await CaseTypeRepository.GetAllBuildingTypes();
            if (!PremiseTypesList.Any()) PremiseTypesList = await PremiseTypeRepository.GetAllPremiseType();
            if (!RegistrationstatusList.Any()) RegistrationstatusList = await CaseTypeRepository.GetAllRegistrationstatus();
            if (!RegulationList.Any()) RegulationList = await RegulationStatusRepository.GetAllRegulationStatus();


            legalcaseDto.StateId = StateList.Where(e => e.Name.Contains("New York")).Select(e => e.Id).FirstOrDefault();
            legalcaseDto.BuildingStateId = StateList.Where(e => e.Name.Contains("New York")).Select(e => e.Id).FirstOrDefault();

            buildingStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Terms")
        {
            if (!CaseProgramList.Any()) CaseProgramList = await _caseprogram.GetAllCaseProgram();
        }

        if (Steps[CurrentStep].Name == "Tenant" && !tenantStepLoaded)
        {
            if (!TenancyTypeList.Any()) TenancyTypeList = await TenancyTypeRepository.GetAllTenancyType();
            if (!DateRentList.Any()) DateRentList = await DateRentRepository.GetAllDateRent();
            if (legalcaseDto.BuildingId != null && legalcaseDto.BuildingId != Guid.Empty)
            {
                if (!TenantList.Any()) TenantList = await _tenantService.GetTenantsByClientIdAsync(legalcaseDto.BuildingId!.Value);
                if (selectedtenant == null)
                {
                    selectedtenant = TenantList.Where(e => e.Id == legalcaseDto.TenantId).FirstOrDefault() ?? new EditToTenantDto();
                    searchTenantText = legalcaseDto.UnitOrApartmentNumber;
                    Tenants.Add($"{selectedtenant.FirstName} {selectedtenant.LastName}");
                }

            }

            if (legalcaseDto.TenantId != null && legalcaseDto.TenantId != Guid.Empty)
            {
                if (!CaseAdditionalTenantfromDbList.Any()) CaseAdditionalTenantfromDbList = await _caseAdditionalTenant.GetAllAdditionalCaseTenantsAsync(legalcaseDto.Id);
                if (!AdditionalOccupantsList.Any()) AdditionalOccupantsList = await _additionalOccupant.GetAllAdditionalOccupantsAsync(legalcaseDto.Id);
            }


            if (CaseAdditionalTenantfromDbList.Any())
            {
                Tenants.AddRange(CaseAdditionalTenantfromDbList.Select(e => $"{e.FirstName} {e.LastName}").ToList());
                AdditionalTenantList.AddRange(CaseAdditionalTenantfromDbList.Select(e => new AddtionalTenantDto
                {
                    FirstName = e.FirstName,
                    LastName = e.LastName,
                    Id = e.Id,
                    LegalCaseId = e.LegalCaseId
                }).ToList());
            }

            if (AdditionalOccupantsList.Any())
            {
                Undertenants.AddRange(AdditionalOccupantsList.Select(e => e.Name).ToList());
            }
            var undertanants = new List<string>() { "John Doe", "Jane Doe" };
            Undertenants.AddRange(undertanants);
            searchTenantText = $"{legalcaseDto?.UnitOrApartmentNumber} / {legalcaseDto?.TenantName} ";
            Rows = legalcaseDto.ArrearLedgers;
            legalcaseDto.TotalOwed = legalcaseDto.ArrearLedgers?.Sum(e => e.Amount) ?? 0;
            tenantStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Landlord" && !landlordStepLoaded)
        {
            searchlandlordText = legalcaseDto.landlordName;
            showLandlordfields = true;

            if (!LandlordList.Any()) LandlordList = await _landlordService.GetAllLandLordsAsync();
            if (selectedlandlord == null) selectedlandlord = LandlordList.Where(e => e.Id == legalcaseDto.LandlordId).FirstOrDefault() ?? new EditToLandlordDto();
            legalcaseDto.LandLordTypeId = selectedlandlord.LandlordTypeId;

            landlordStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Case")
        {
            if (!TenancyTypeList.Any()) TenancyTypeList = await TenancyTypeRepository.GetAllTenancyType();

        }

        if (Steps[CurrentStep].Name == "Rent")
        {
            if (!DateRentList.Any()) DateRentList = await DateRentRepository.GetAllDateRent();

        }

        if (Steps[CurrentStep].Name == "Lease")
        {
            if (!TenancyTypeList.Any()) TenancyTypeList = await TenancyTypeRepository.GetAllTenancyType();
            if (!DateRentList.Any()) DateRentList = await DateRentRepository.GetAllDateRent();
        }

        if (Steps[CurrentStep].Name == "Notice")
        {
            if (legalcaseDto.CaseTypeId != null || legalcaseDto.CaseTypeId != Guid.Empty)
            {
                if (!FilteredFormTypeList.Any()) FilteredFormTypeList = await _FormService.GetFormTypesByCaseTypeAsync(legalcaseDto.CaseTypeId);
            }
            if (!ServiceMethodList.Any()) ServiceMethodList = await _legalCaseService.ServiceMethodList();

        }

        if (Steps[CurrentStep].Name == "CaseInfo" && !CaseTypeStepLoaded)
        {
            if (!CaseTypeHPDList.Any()) CaseTypeHPDList = await CaseTypeRepository.GetAllCaseTypeHPD();
            if (!CaseTypePerDiemList.Any()) CaseTypePerDiemList = await CaseTypeRepository.GetAllCaseTypePerDiem();
            if (!CourtTypeList.Any()) CourtTypeList = await _legalCaseService.CourtTypeList();
            if (!CourtLocationList.Any()) CourtLocationList = await _courtService.GetAllCourtDataAsync();
            if (!CourtPartList.Any()) CourtPartList = CourtLocationList.Where(e => e.Id == legalcaseDto.CourtLocationId).FirstOrDefault().CourtPart;
            foreach (var item in CaseTypeHPDList)
            {
                if (legalcaseDto.SelectedCaseTypeHPDIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            foreach (var item in CaseTypePerDiemList)
            {
                if (legalcaseDto.SelectedCaseTypePerDiemIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            if (legalcaseDto.CourtTypeId != null && legalcaseDto.CourtTypeId != Guid.Empty)
            {
                var casetype = CourtTypeList.Where(e => e.Id == legalcaseDto.CourtTypeId).FirstOrDefault();
                if (casetype.Name.Contains("NYC"))
                {
                    showCountyDropdown = true;
                    showCourtPartDropdown = true;
                }
            }
            await ShowAllCourts();
            CaseTypeStepLoaded = true;

            if (legalcaseDto.CaseTypeName == "Per Diem")
            {
                if (!PartyRepresentPerDiemList.Any()) PartyRepresentPerDiemList = await CaseTypeRepository.GetAllpartyRepresentingPerDiem();
                if (!AppearanceTypesPerDiemList.Any()) AppearanceTypesPerDiemList = await CaseTypeRepository.GetAllAppearanceTypesPerDiem();
                foreach (var item in AppearanceTypesPerDiemList)
                {
                    if (legalcaseDto.SelectedAppearanceTypePerDiemIds.Contains(item.Id))
                    {
                        item.IsSelected = true;   // UI checkbox checked hoga
                    }
                }

                foreach (var item in AppearanceTypesPerDiemList)
                {
                    if (legalcaseDto.SelectedAppearanceTypePerDiemIds.Contains(item.Id))
                    {
                        item.IsSelected = true;   // UI checkbox checked hoga
                    }
                }
            }
        }

        if (Steps[CurrentStep].Name == "Party")
        {
            if (!PartyRepresentList.Any()) PartyRepresentList = await CaseTypeRepository.GetAllpartyRepresenting();
            if (!PartyRepresentPerDiemList.Any()) PartyRepresentPerDiemList = await CaseTypeRepository.GetAllpartyRepresentingPerDiem();
            if (!LandlordList.Any()) LandlordList = await _landlordService.GetAllLandLordsAsync();
            if (selectedlandlord == null) selectedlandlord = LandlordList.Where(e => e.Id == legalcaseDto.LandlordId).FirstOrDefault() ?? new EditToLandlordDto();
            if (!TenantList.Any()) TenantList = await _tenantService.GetTenantsByClientIdAsync(legalcaseDto.BuildingId!.Value);
            if (selectedtenant == null)
            {
                selectedtenant = TenantList.Where(e => e.Id == legalcaseDto.TenantId).FirstOrDefault() ?? new EditToTenantDto();
                // Tenants.Add($"{selectedtenant.FirstName} {selectedtenant.LastName}");
            }
            var petitioners = await _legalCaseService.GetAdditionalpetitioner(legalcaseDto.TenantId.Value);
            if (petitioners != null)
            {
                AdditionalPetitioners.AddRange(petitioners);
                AdditionalPetitionersDelete = AdditionalPetitioners.ToList();
            }
            var respondents = await _legalCaseService.GetAdditionalrespondent(legalcaseDto.LandlordId.Value);
            if (respondents != null)
            {
                foreach (var r in respondents)
                {
                    // Check for existing entry by Id (or any unique field)
                    if (!AdditionalRespondent.Any(x => x.Id == r.Id))
                    {
                        AdditionalRespondent.Add(r);

                    }
                }
                AdditionalRespondentDelete = AdditionalRespondent.ToList();
            }
            searchlandlordText = legalcaseDto.landlordName;
            showLandlordfields = true;

            searchTenantText = legalcaseDto.TenantName;
            showTenantfields = true;
        }
        if (Steps[CurrentStep].Name == "Petitioner" && !PetitionerStepLoaded)
        {
            if (!HarassmentTypesList.Any()) HarassmentTypesList = await CaseTypeRepository.GetAllHarassmentTypes();
            foreach (var item in HarassmentTypesList)
            {
                if (legalcaseDto.SelectedHarassmentTypeIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            PetitionerStepLoaded = true;


        }

        if (Steps[CurrentStep].Name == "Respondent" && !RespondedStepLoaded)
        {
            if (!DefenseTypesList.Any()) DefenseTypesList = await CaseTypeRepository.GetAllDefenseTypes();
            foreach (var item in DefenseTypesList)
            {
                if (legalcaseDto.SelectedDefenseTypeIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            RespondedStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Appearance" && !AppearanceStepLoaded)
        {
            if (!AppearanceTypesList.Any()) AppearanceTypesList = await CaseTypeRepository.GetAllAppearanceTypes();
            if (!AppearanceTypesPerDiemList.Any()) AppearanceTypesPerDiemList = await CaseTypeRepository.GetAllAppearanceTypesPerDiem();

            foreach (var item in AppearanceTypesList)
            {
                if (legalcaseDto.SelectedAppearanceTypeIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }

            foreach (var item in AppearanceTypesPerDiemList)
            {
                if (legalcaseDto.SelectedAppearanceTypePerDiemIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }

            AppearanceStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Relief" && !ReliefStepLoaded)
        {
            if (!ReliefPetitionerTypesList.Any()) ReliefPetitionerTypesList = await CaseTypeRepository.GetAllReliefPetitionerTypes();
            if (!ReliefRespondentTypesList.Any()) ReliefRespondentTypesList = await CaseTypeRepository.GetAllReliefRespondentTypes();
            foreach (var item in ReliefPetitionerTypesList)
            {
                if (legalcaseDto.SelectedReliefPetitionerTypeIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            foreach (var item in ReliefRespondentTypesList)
            {
                if (legalcaseDto.SelectedReliefRespondentTypeIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            ReliefStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Billing")
        {
            if (!BilingTypesList.Any()) BilingTypesList = await CaseTypeRepository.GetAllBilingTypes();
        }

        if (Steps[CurrentStep].Name == "Document" && !DocumentStepLoaded)
        {
            if (!DocumentInstructionPerDiemList.Any()) DocumentInstructionPerDiemList = await CaseTypeRepository.GetAllDocumentInstructionPerDiem();
            foreach (var item in DocumentInstructionPerDiemList)
            {
                if (legalcaseDto.SelectedDocumentInstructionPerDiemIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            DocumentStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Reporting" && !ReportingStepLoaded)
        {
            if (!ReportingRequirementPerDiemList.Any()) ReportingRequirementPerDiemList = await CaseTypeRepository.GetAllReportingRequirementPerDiem();
            foreach (var item in ReportingRequirementPerDiemList)
            {
                if (legalcaseDto.SelectedReportingRequirementPerDiemIds.Contains(item.Id))
                {
                    item.IsSelected = true;   // UI checkbox checked hoga
                }
            }
            ReportingStepLoaded = true;
        }

        if (Steps[CurrentStep].Name == "Billing")
        {
            if (!PaymentMethodDtoList.Any()) PaymentMethodDtoList = await CaseTypeRepository.GetAllPaymentMethod();

        }

        spinnerservice.Hide();
    }

    public record MonthItem(string Value, string Display);
    private List<MonthItem> MonthOptions = new();
    private List<ArrearLedgerDto> Rows = new();
    private List<ArrearLedgerDto> DeleteableRows = new();
    private IEnumerable<FilingMethod> FilingMethodList = new List<FilingMethod>();
    private IEnumerable<ServiceMethod> ServiceMethodList = new List<ServiceMethod>();
    // private decimal TotalOwed => Rows.Sum(x => x.Amount);
    private void OnMonthChanged(ArrearLedgerDto row)
    {
        StateHasChanged();
    }
    private void GenerateMonths()
    {
        MonthOptions.Clear();

        if (legalcaseDto.LastPaymentDate is null)
            return;

        DateTime start = new DateTime(
            legalcaseDto.LastPaymentDate.Value.Year,
            legalcaseDto.LastPaymentDate.Value.Month,
            1);

        DateTime end = new DateTime(
            DateTime.Today.Year,
            DateTime.Today.Month,
            1);

        // Iterate month-by-month
        for (DateTime dt = start; dt <= end; dt = dt.AddMonths(1))
        {
            string value = $"{dt:yyyy-MM}"; // stored value
            string display = $"{dt:yyyy}-{CultureInfo.CurrentCulture.DateTimeFormat.GetAbbreviatedMonthName(dt.Month)}";

            MonthOptions.Add(new MonthItem(value, display));
        }

    }
    private void RecalculateTotal()
    {
        legalcaseDto.TotalOwed = Rows.Sum(x => x.Amount);
        StateHasChanged();
    }

    private void AddRow()
    {
        Rows.Add(new ArrearLedgerDto());
    }

    private void RemoveRow(ArrearLedgerDto row)
    {
        Rows.Remove(row);
        DeleteableRows.Add(row);
    }

    private void OnAmountChanged(ArrearLedgerDto row, double value)
    {

        row.Amount = value;
        StateHasChanged();
    }


    async Task HideCourtDropDown(FocusEventArgs e)
    {
        // Small delay to allow click on dropdown item to register before hiding
        await Task.Delay(300);
        if (filteredCourts.Any())
        {
            filteredCourts.Clear();

        }
        StateHasChanged();
    }

    async Task HideCountyDropDown(FocusEventArgs e)
    {
        // Small delay to allow click on dropdown item to register before hiding
        await Task.Delay(300);
        if (filteredCounties.Any())
        {
            filteredCounties.Clear();

        }
        StateHasChanged();
    }

    // private async Task OnSearchCourtInput(ChangeEventArgs e)
    // {
    //     searchCourtText = e.Value?.ToString() ?? "";

    //     // 🟢 Court clear → County clear
    //     if (string.IsNullOrWhiteSpace(searchCourtText))
    //     {
    //         legalcaseDto.Court = null;
    //         legalcaseDto.County = null;
    //         filteredCourts = new List<CourtDto>();
    //         return;
    //     }

    //     // 🟢 Search only when 3+ characters
    //     if (searchCourtText.Length >= 3)
    //     {
    //         filteredCourts = await _courtService.SearchCourt(searchCourtText);
    //     }
    //     else
    //     {
    //         // 🟢 Local filter on <3 chars
    //         filteredCourts = filteredCourts
    //             ?.Where(c => c.Court.Contains(searchCourtText, StringComparison.OrdinalIgnoreCase))
    //             .ToList() ?? new List<CourtDto>();
    //     }
    // }

    private async Task OnSearchCourtInput(ChangeEventArgs e)
    {
        searchCourtText = e.Value?.ToString() ?? "";
        legalcaseDto.CourtLocationId = Guid.Empty;
        // legalcaseDto.CountyId = Guid.Empty;

        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {

            await Task.Delay(300, _cts.Token);
            // ⭐ Court input empty → reset Court & County + clear list
            if (string.IsNullOrWhiteSpace(searchCourtText))
            {
                searchCountyText = null;
                await ShowAllCourts();
                return;
            }

            // ⭐ Jab tak 3 characters nahi — full court list dikhado
            if (searchCourtText.Length < 3)
            {

                await ShowAllCourts();   // <-- yeh method bana lenge niche
                return;
            }

            // ⭐ 3 characters hote hi — server search
            filteredCourts = await _courtService.SearchCourt(searchCourtText);
        }
        catch (TaskCanceledException)
        {
            // Old task cancelled → ignore
        }
    }

    private async Task OnSearchCountyInput(ChangeEventArgs e)
    {
        searchCountyText = e.Value?.ToString() ?? "";
        legalcaseDto.CourtLocationId = Guid.Empty;
        legalcaseDto.CountyId = Guid.Empty;
        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {

            await Task.Delay(300, _cts.Token);
            // ⭐ Court input empty → reset Court & County + clear list
            if (string.IsNullOrWhiteSpace(searchCountyText))
            {
                legalcaseDto.CountyId = Guid.Empty;
                // searchCourtText = null;
                await ShowAllCounty();
                await ShowAllCourts();
                return;

            }

            // ⭐ Jab tak 3 characters nahi — full court list dikhado
            if (searchCountyText.Length < 3)
            {
                await ShowAllCounty();   // <-- yeh method bana lenge niche
                return;
            }

            // ⭐ 3 characters hote hi — server search
            filteredCounties = await _countyService.SearchCounty(searchCountyText);
        }
        catch (TaskCanceledException)
        {
            // Old task cancelled → ignore
        }
    }

    public async Task BuildSteps()
    {
        spinnerservice.Show();

        var caseTypeName = CaseTypeList
            .FirstOrDefault(x => x.Id == legalcaseDto.CaseTypeId)?.Name;

        legalcaseDto.CaseTypeName = caseTypeName;

        Steps.Clear();

        if (caseTypeName == "Holdover")
        {
            Steps = Enum.GetValues<StepHoldover>()
                        .Select(x => new StepItems { Id = (int)x, Name = x.ToString() })
                        .ToList();
        }
        else if (caseTypeName == "NonPayment")
        {
            Steps = Enum.GetValues<StepNonPayment>()
                        .Select(x => new StepItems { Id = (int)x, Name = x.ToString() })
                        .ToList();
        }
        else if (caseTypeName == "HPD")
        {
            Steps = Enum.GetValues<StepHPD>()
                        .Select(x => new StepItems { Id = (int)x, Name = x.ToString() })
                        .ToList();
        }
        else if (caseTypeName == "Per Diem")
        {
            Steps = Enum.GetValues<StepPerDiem>()
                        .Select(x => new StepItems { Id = (int)x, Name = x.ToString() })
                        .ToList();
        }
        else if (caseTypeName == "Illegal Lockout")
        {
            Steps = Enum.GetValues<StepIllegalLockout>()
                        .Select(x => new StepItems { Id = (int)x, Name = x.ToString() })
                        .ToList();
        }
        // reset current step ALWAYS to avoid out-of-bound
        CurrentStep = 0;

        await Task.Delay(300);

        isLoading = false;
        spinnerservice.Hide();
        await InvokeAsync(StateHasChanged);
    }

    private async void ClearSelecteedTenant()
    {
        // Null-safe list clear
        Tenants?.Clear();
        filteredTenant?.Clear();

        selectedtenant = null;
        searchTenantText = string.Empty;

        legalcaseDto.ApartmentNumber = null;
        legalcaseDto.TenantName = null;
        legalcaseDto.TenantId = null;


        StateHasChanged();
    }


    private async void CancelTenants()
    {
        showTenantfields = false;
        searchTenantText = null;
        selectedtenant = null;
        legalcaseDto.TenantId = null;
        legalcaseDto.TenantName = searchTenantText;
        // legalcaseDto.LandlordId = null;
        // legalcaseDto.landlordName = string.Empty;
        // searchlandlordText = string.Empty;
        AdditionalPetitioners.Clear();
        AdditionalPetitionersDelete.Clear();
        // filteredLandlords?.Clear();

        // Building reset
        // legalcaseDto.BuildingId = null;
        // legalcaseDto.BuildingAddress = string.Empty;
        // filteredBuildings?.Clear();


    }







    private async Task ShowAllTenant()
    {
        if (legalcaseDto.LandlordId != null && legalcaseDto.LandlordId != Guid.Empty)
        {
            masterTenantList = (await _tenantService
                .GetTenantsByLandlordIdAsync(legalcaseDto.LandlordId.Value))
                .ToList();

            filteredTenant = masterTenantList.ToList();
            tenantLoadedFromLandlord = true;
            return;
        }

        // No landlord → client ke basis par tenants
        masterTenantList = (await _tenantService
            .GetTenantsByClientIdAsync(legalcaseDto.ClientId))
            .ToList();

        filteredTenant = masterTenantList.ToList();
        tenantLoadedFromLandlord = false;
    }
    private void RemoveAdditionalPetitioner(CaseAdditionalPetitioner p)
    {
        AdditionalPetitioners.Remove(p);
    }
    private void AddAdditionalPetitioner()
    {
        AdditionalPetitioners.Add(new CaseAdditionalPetitioner
        {
            Name = "",     // To be filled by user
        });

        StateHasChanged();
    }
    private void AddAdditionalRespondent()
    {
        AdditionalRespondent.Add(new CaseAdditionalRespondent
        {
            Name = "",     // To be filled by user
        });

        StateHasChanged();
    }
    private void RemoveAdditionalRespondent(CaseAdditionalRespondent p)
    {
        AdditionalRespondent.Remove(p);
    }

    private async Task SelectTenanthpd(EditToTenantDto tenant)
    {
        selectedtenant = tenant;
        showTenantfields = true;
        showLandlordfields = true;
        // Tenant fill
        searchTenantText = $"{tenant.FirstName} {tenant.LastName}";
        legalcaseDto.TenantId = tenant.Id;
        legalcaseDto.TenantName = searchTenantText;
        filteredTenant = new List<EditToTenantDto>();
        var petitioner = await _legalCaseService.GetAdditionalpetitioner(tenant.Id);
        if (petitioner != null)
        {
            foreach (var r in petitioner)
            {
                // Check for existing entry by Id (or any unique field)
                if (!AdditionalPetitioners.Any(x => x.Id == r.Id))
                {
                    AdditionalPetitioners.Add(r);
                }
            }
        }

        var data = await _tenantService.GetLandlordBuildingByTenantAsync(tenant.Id);
        if (data.landlord != null)
        {
            legalcaseDto.LandlordId = data.landlord.Id;
            legalcaseDto.landlordName = $"{data.landlord.FirstName} {data.landlord.LastName}";
            searchlandlordText = legalcaseDto.landlordName;
            filteredLandlords = new List<EditToLandlordDto>();
            showLandlordfields = true;
            var respondents = await _legalCaseService.GetAdditionalrespondent(data.landlord.Id);
            if (respondents != null)
            {
                foreach (var r in respondents)
                {
                    // Check for existing entry by Id (or any unique field)
                    if (!AdditionalRespondent.Any(x => x.Id == r.Id))
                    {
                        AdditionalRespondent.Add(r);
                    }
                }
            }
        }
        // ---- Auto Fill Building ----
        if (data.building != null)
        {
            legalcaseDto.BuildingId = data.building.Id;
            legalcaseDto.Units = data.building.BuildingUnits;
            legalcaseDto.BuildingAddress = data.building.Address1;
            legalcaseDto.PremiseTypeId = data.building.PremiseTypeId;
            legalcaseDto.RegistrationStatusTypeId = data.building.RegistrationStatusId;
            searchBuildingText = $"{data.building.Address1} / {data.building.BuildingCode}";
            filteredBuildings = new List<EditToBuildingDto>();
            selectedbuilding = data.building;
            IsNewBuilding = false;
            showBuildingfields = true;
        }
        StateHasChanged();
    }
    private async Task SelectTenants()
    {
        showTenantfields = true;
        selectedtenant = null;
        searchTenantText = null;
        legalcaseDto.TenantId = null;
        legalcaseDto.TenantName = searchTenantText;
        filteredTenant?.Clear();




    }

    private void saveTenantName()
    {
        legalcaseDto.TenantName = searchTenantText;
    }
    private void OnTenantInputFocus()
    {
        // 👉 Agar landlord ke tenants 0 the → dropdown hide
        if (!tenantLoadedFromLandlord)
        {
            filteredTenant = new List<EditToTenantDto>();   // clear dropdown
        }

        StateHasChanged();
    }


    private async Task OnSearchTenantHpdInput(ChangeEventArgs e)
    {
        searchTenantText = e.Value?.ToString() ?? "";

        // Empty → reset full list
        if (string.IsNullOrWhiteSpace(searchTenantText))
        {
            filteredTenant = masterTenantList.ToList();
            return;
        }

        // Local filter only
        filteredTenant = masterTenantList
            .Where(c =>
                (c.UnitOrApartmentNumber ?? "").Contains(searchTenantText, StringComparison.OrdinalIgnoreCase) ||
                (c.FirstName ?? "").Contains(searchTenantText, StringComparison.OrdinalIgnoreCase) ||
                (c.LastName ?? "").Contains(searchTenantText, StringComparison.OrdinalIgnoreCase) ||
                (c.TenantCode ?? "").Contains(searchTenantText, StringComparison.OrdinalIgnoreCase)
            )
            .ToList();
    }

    async Task HideTenantsDropDown(FocusEventArgs e)
    {
        // Small delay to allow click on dropdown item to register before hiding
        await Task.Delay(500);
        if (filteredTenant.Any())
        {

            filteredTenant.Clear();

        }
        StateHasChanged();
    }

    private async Task OnStepClick(int step)
    {
        if (step <= Steps.Count() - 1)
        {
            CurrentStep = step;
            await InvokeAsync(StateHasChanged);
        }
    }

    public string UnitNumber { get; set; }

    public List<string> Tenants { get; set; } = new();
    public List<string> Undertenants { get; set; } = new();

    public string UnitNo { get; set; } = "";

    public void FormatLastRentPaid()
    {
        var formatted = DateTime.ParseExact(LastrentPaid, "yyyy-MM", null)
                        .ToString("MMMM yyyy");

        legalcaseDto.LastRentPaid = formatted;

    }
    async Task HideBuildingDropdown(FocusEventArgs e)
    {
        // Small delay to allow click on dropdown item to register before hiding
        await Task.Delay(200);
        filteredBuildings.Clear();
        StateHasChanged();
    }


    async Task HideTenantDropDown(FocusEventArgs e)
    {
        await Task.Delay(300);

        if (filteredTenant != null && filteredTenant.Any())
        {
            filteredTenant = null; // best option
        }

        StateHasChanged();
    }


    async Task HideClientDropDown(FocusEventArgs e)
    {
        // Small delay to allow click on dropdown item to register before hiding
        await Task.Delay(200);
        filteredClients.Clear();
        StateHasChanged();
    }

    async Task HideLandlordsDropDown(FocusEventArgs e)
    {
        // Small delay to allow click on dropdown item to register before hiding
        await Task.Delay(200);
        filteredLandlords.Clear();
        StateHasChanged();
    }


    void AddTenant()
    {
        Tenants.Add(string.Empty);
    }
    void DeleteAdditionalTenant(int index)
    {
        // Index 0 = primary tenant → never delete
        if (index <= 0 || index >= Tenants.Count)
            return;

        var name = Tenants[index]?.Trim();

        // Remove UI row
        Tenants.RemoveAt(index);

        if (string.IsNullOrWhiteSpace(name))
            return;

        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        var firstName = parts.FirstOrDefault() ?? "";
        var lastName = parts.Length > 1 ? parts.Last() : "";

        var occupant = AdditionalTenantList
            .FirstOrDefault(x =>
                x.FirstName == firstName &&
                x.LastName == lastName &&
                x.IsDeleted != true);

        if (occupant == null)
            return;

        // Persisted → soft delete
        if (occupant.Id != Guid.Empty)
        {
            occupant.IsDeleted = true;
            occupant.IsActive = false;
            occupant.IsVisible = false;
        }
        else
        {
            // New → hard delete
            AdditionalTenantList.Remove(occupant);
        }
    }

    void OnchangeAdditionalTenant(int index)
    {
        // index 0 = primary tenant
        if (index <= 0 || index >= Tenants.Count)
        {
            if (legalcaseDto.TenantName == null)
            {
                legalcaseDto.TenantName = Tenants[0];
            }
            return;

        }

        var name = Tenants[index]?.Trim();
        if (string.IsNullOrWhiteSpace(name))
            return;

        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        var firstName = parts.FirstOrDefault() ?? "";
        var lastName = parts.Length > 1 ? parts.Last() : "";

        // Map UI row → ACTIVE additional tenants only
        int activeIndex = index - 1;

        var activeTenants = AdditionalTenantList
            .Where(x => x.IsDeleted != true)
            .ToList();

        if (activeIndex < activeTenants.Count)
        {
            // RENAME / UPDATE existing tenant
            var dto = activeTenants[activeIndex];

            dto.FirstName = firstName;
            dto.LastName = lastName;
            dto.BuildingId = legalcaseDto.BuildingId;
            dto.UnitorApartmentNumber = legalcaseDto.UnitOrApartmentNumber;
        }
        else
        {
            // NEW additional tenant
            AdditionalTenantList.Add(new AddtionalTenantDto
            {
                FirstName = firstName,
                LastName = lastName,
                TenantId = legalcaseDto?.TenantId ?? Guid.Empty,
                BuildingId = legalcaseDto.BuildingId,
                UnitorApartmentNumber = legalcaseDto.UnitOrApartmentNumber,
                CreatedOn = DateTime.Now,
                IsActive = true,
                IsDeleted = false,
                IsVisible = true
            });
        }
    }

    int defaultCount = 2;
    void AddUnder()
    {
        int insertIndex = Undertenants.Count - defaultCount;
        Undertenants.Insert(insertIndex, string.Empty);
    }
    void DeleteAdditionalOccupant(int index)
    {
        // Safety check
        if (index < 0 || index >= Undertenants.Count)
            return;

        // Remove from UI text list
        Undertenants.RemoveAt(index);

        // Remove or mark deleted in DTO list
        if (index < AdditionalOccupantsList.Count)
        {
            var occupant = AdditionalOccupantsList[index];

            // If it already exists in DB → soft delete
            if (occupant.Id != Guid.Empty)
            {
                occupant.IsDeleted = true;
                occupant.IsActive = false;
                occupant.IsVisible = false;
            }
            else
            {
                // New, unsaved → remove completely
                AdditionalOccupantsList.RemoveAt(index);
            }
        }
    }

    void OnchangeAdditionalOccupants(int index)
    {
        var name = Undertenants[index];

        // If cleared, remove from AdditionalTenantList
        if (string.IsNullOrWhiteSpace(name))
        {
            var existing = AdditionalOccupantsList.ElementAtOrDefault(index);
            if (existing != null)
            {
                AdditionalOccupantsList.RemoveAt(index);
            }
            return;
        }

        // Update or add
        if (index < AdditionalOccupantsList.Count)
        {
            AdditionalOccupantsList[index].Name = name;
        }
        else
        {
            var additional = new AdditionalOccupantDto()
            {
                Name = name,
                CreatedOn = DateTime.Now,
                IsActive = true,
                IsDeleted = false, // better to keep false
                IsVisible = true
            };

            AdditionalOccupantsList.Add(additional);
        }


    }

    //void AddUnder() => Undertenants.Add(string.Empty);



    private string Progress => (((int)CurrentStep + 1) * 100.0 / Steps.Count).ToString("0");




    // private void BuildNoticeMerge()
    // {
    //     Guid parsedClientTypeId;
    //     MergeData = new NoticeMergeModel
    //         {
    //             // --- Client ---
    //             ClientName = legalcaseDto.ClientName ?? "(Unknown Client)",
    //             ClientType = legalcaseDto.ClientTypeId != null ? ClientTypeList.FirstOrDefault(x => x.Id == legalcaseDto.ClientTypeId)?.Name : " ",
    //             ClientEmail = legalcaseDto.ClientEmail ?? "",
    //             ClientPhone = legalcaseDto.ClientPhone ?? "",
    //             ClientRef = legalcaseDto.Reference ?? "",

    //             // --- Landlord ---
    //             LandlordName = legalcaseDto.landlordName ?? "",
    //             Contact = legalcaseDto.ContactPersonName ?? "",
    //             LandlordAddress = legalcaseDto.LandlordAddress ?? "",
    //             LandlordAttorney = legalcaseDto.AttorneyOfRecord ?? "",
    //             LandlordLawFirm = legalcaseDto.LawFirm ?? "",

    //             // --- Building ---
    //             Addr = legalcaseDto.BuildingAddress ?? "",
    //             Unit = legalcaseDto.UnitOrApartmentNumber ?? "",
    //             Borough = legalcaseDto.City ?? "",
    //             MDR = legalcaseDto.Mdr ?? "",
    //             Regulation = RegulationList.FirstOrDefault(x => x.Id == legalcaseDto.RegulationStatusId)?.Name,

    //             // --- Tenancy / Terms ---
    //             Tenancy = legalcaseDto.TenancyTypeName ?? "",
    //             Written = legalcaseDto.WrittenLease?.ToString(),
    //             OralAgreement = legalcaseDto.OralAgreeMent?.ToString(),
    //             CaseProgram = CaseProgramList.FirstOrDefault(x => x.Id == legalcaseDto.CaseProgramId)?.Name,

    //             GoodCauseApplies = legalcaseDto.GoodCauseApplies?.ToString(),
    //             MovedIn = legalcaseDto.DateTenantMoved?.ToDateTime(TimeOnly.MinValue),
    //             LeaseEnd = legalcaseDto.LeaseEnd?.ToDateTime(TimeOnly.MinValue),

    //             // --- Rent ---
    //             RentDueDate = DateRentList.FirstOrDefault(x => x.Id == legalcaseDto.RentDueEachMonthOrWeekId)?.Name,
    //             MonthlyRent = legalcaseDto.MonthlyRent,
    //             TenantShare = legalcaseDto.TenantShare?.ToString(),
    //             SocialServices = legalcaseDto.SocialService ?? "",
    //             LastPaid = legalcaseDto.LastRentPaid ?? "",
    //             TotalOwed = legalcaseDto.TotalOwed?.ToString(),

    //             // --- Tenants ---
    //             Tenants = Tenants.Where(t => !string.IsNullOrWhiteSpace(t)).ToList(),
    //             Undertenants = Undertenants.Where(u => !string.IsNullOrWhiteSpace(u)).ToList(),

    //             // --- Case / Notice ---
    //             Served = ToDateTime(legalcaseDto.DateNoticeServed),
    //             PredicateNotice = legalcaseDto.PredicateNotice
    //         };

    //     // Calculate notice-specific values
    //     //var days = CalcNoticeDays(MergeData.Tenancy, MergeData.MovedIn);
    //     MergeData.Days = legalcaseDto.CalculatedNoticeLength;

    //     //var dueDay = ParseDueDay(MergeData.RentDueDate);
    //     //MergeData.Expire = CalcExpireAligned(MergeData.Served, days, dueDay);
    //     MergeData.Expire = legalcaseDto.ExpirationDate;

    //     //MergeData.Template = PickPredicateNotice(MergeData.Tenancy);

    //     // Clean up tenant lists
    //     MergeData.Tenants = MergeData.Tenants.Where(t => !string.IsNullOrWhiteSpace(t)).ToList();
    //     MergeData.Undertenants = MergeData.Undertenants.Where(u => !string.IsNullOrWhiteSpace(u)).ToList();
    // }

    private DateTime? ToDateTime(DateOnly? date)
    {
        return date.HasValue ? date.Value.ToDateTime(TimeOnly.MinValue) : (DateTime?)null;
    }


    private void OnClientChanged()
    {
        var client = ClientList.FirstOrDefault(x => x.Id == legalcaseDto.ClientId);
        if (client != null)
        {
            legalcaseDto.ClientName = $"{client.FirstName} {client.LastName}".Trim();
            legalcaseDto.ClientEmail = client.Email;
            legalcaseDto.ClientPhone = client.Phone;
            legalcaseDto.Address1 = client.Address1;
            legalcaseDto.Address2 = client.Address2;
            legalcaseDto.City = client.City;
            legalcaseDto.StateId = client.StateId;
            legalcaseDto.ZipCode = client.ZipCode;
        }
    }

    // private async Task<bool> ValidateCurrentStep()
    // {
    //     messageStore.Clear();

    //     var caseTypeName = CaseTypeList
    // .FirstOrDefault(x => x.Id == legalcaseDto.CaseTypeId)?.Name;

    //     @if (caseTypeName == "Holdover" || caseTypeName == "NonPayment")
    //     {
    //         {
    //             if (Steps[CurrentStep].Name == "CaseAndclient")
    //             {
    //                 Require(() => legalcaseDto.CaseTypeId, nameof(legalcaseDto.CaseTypeId), "Case type required");

    //                 if (!IsNewClient)
    //                 {
    //                     Require(() => legalcaseDto.ClientId, nameof(legalcaseDto.ClientId), "Client is required");
    //                 }

    //                 Require(() => legalcaseDto.ClientName, nameof(legalcaseDto.ClientName), "Client Name is required");
    //                 Require(() => legalcaseDto.ClientTypeId, nameof(legalcaseDto.ClientTypeId), "Client Type is required");

    //                 // Email required
    //                 Require(() => legalcaseDto.ClientEmail, nameof(legalcaseDto.ClientEmail), "Client Email is required");

    //                 // ❌ WRONG email format check
    //                 var email = legalcaseDto.ClientEmail;
    //                 if (!string.IsNullOrWhiteSpace(email))
    //                 {
    //                     // Simple regex for email validation
    //                     var emailRegex = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";

    //                     if (!System.Text.RegularExpressions.Regex.IsMatch(email, emailRegex))
    //                     {
    //                         messageStore.Add(() => legalcaseDto.ClientEmail, "Invalid email format");
    //                         return false;
    //                     }
    //                 }



    //                 // ❌ Duplicate email check
    //                 // var isEmailExists = await _clientService.IsEmailExists(legalcaseDto.ClientEmail);

    //                 // if (isEmailExists)
    //                 // {
    //                 //     messageStore.Add(() => legalcaseDto.ClientEmail, "Email already exists");
    //                 //     return false;
    //                 // }
    //             }

    //             else if (Steps[CurrentStep].Name == "Landlord")
    //             {

    //                 bool islandlordIdSelected = legalcaseDto.LandlordId.HasValue && legalcaseDto.LandlordId.Value != Guid.Empty;
    //                 bool islandlordTextEntered = !string.IsNullOrWhiteSpace(searchlandlordText);

    //                 // ✔ Validation trigger only when both are empty
    //                 if (!islandlordIdSelected && !islandlordTextEntered)
    //                 {
    //                     Require(() => legalcaseDto.LandlordId, nameof(legalcaseDto.LandlordId), "Landlord name is required");
    //                 }

    //                 if (!IsLandlordSelected)
    //                 {

    //                     Require(() => legalcaseDto.ContactPersonName, nameof(legalcaseDto.ContactPersonName), "Contact Person is required");
    //                 }
    //                 if (!IsLandlordSelected)
    //                 {
    //                     Require(() => legalcaseDto.LandlordAddress, nameof(legalcaseDto.LandlordAddress), "Address is required");
    //                 }


    //             }
    //             else if (Steps[CurrentStep].Name == "Building")
    //             {
    //                 if (!isBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.Mdr, nameof(legalcaseDto.Mdr), "MDR is required");
    //                 }

    //                 if (!IsNewBuilding)
    //                 {
    //                     Require(() => legalcaseDto.BuildingId, nameof(legalcaseDto.BuildingId), "Building is required");

    //                 }
    //                 if (IsNewBuilding)
    //                 {
    //                     Require(() => legalcaseDto.BuildingZip, nameof(legalcaseDto.BuildingZip), "Zipcode is Required");
    //                     Require(() => legalcaseDto.BuildingStateId, nameof(legalcaseDto.BuildingStateId), "Please select a state");
    //                 }

    //                 if (!isBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.Borough, nameof(legalcaseDto.Borough), "City is required");
    //                 }
    //                 if (!isBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.Units, nameof(legalcaseDto.Units), "Units is required");
    //                 }

    //                 if (!isBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.BuildingAddress, nameof(legalcaseDto.BuildingAddress), "Address is required");
    //                 }
    //                 if (!isBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.RegulationStatusId, nameof(legalcaseDto.RegulationStatusId), "Please select a regulation");
    //                 }



    //             }


    //             else if (Steps[CurrentStep].Name == "Tenant")
    //             {
    //                 bool isTenantSelected = legalcaseDto.TenantId.HasValue && legalcaseDto.TenantId.Value != Guid.Empty;
    //                 bool isTextEntered = !string.IsNullOrWhiteSpace(searchTenantText);

    //                 // Tenant is required
    //                 if (!isTenantSelected)
    //                 {
    //                     Require(() => legalcaseDto.TenantId, nameof(legalcaseDto.TenantId), "Unit/Tenant Name is required");
    //                 }


    //                 Require(() => legalcaseDto.TenantName, nameof(legalcaseDto.TenantName), "Tenant Name is required");
    //             }

    //             else if (Steps[CurrentStep].Name == "Terms")
    //             {
    //                 Require(() => legalcaseDto.DateTenantMoved, nameof(legalcaseDto.DateTenantMoved), "Date is required");

    //             }
    //             else if (Steps[CurrentStep].Name == "Rent")
    //             {
    //                 Require(() => legalcaseDto.MonthlyRent, nameof(legalcaseDto.MonthlyRent), "Monthly rent required");
    //                 Require(() => legalcaseDto.RentDueEachMonthOrWeekId, nameof(legalcaseDto.RentDueEachMonthOrWeekId), "rent due  required");

    //             }
    //             else if (Steps[CurrentStep].Name == "Case")
    //             {
    //                 Require(() => legalcaseDto.TenancyTypeId, nameof(legalcaseDto.TenancyTypeId), "Tenancy type required");
    //                 Require(() => legalcaseDto.DateNoticeServed, nameof(legalcaseDto.DateNoticeServed), "Notice Serve Date required");
    //             }
    //         }

    //     }

    //     @if (caseTypeName == "HPD")
    //     {
    //         {
    //             if (Steps[CurrentStep].Name == "CaseAndclient")
    //             {
    //                 Require(() => legalcaseDto.CaseTypeId, nameof(legalcaseDto.CaseTypeId), "Case type required");

    //                 if (!IsNewClient)
    //                 {
    //                     Require(() => legalcaseDto.ClientId, nameof(legalcaseDto.ClientId), "Client is required");
    //                 }

    //                 Require(() => legalcaseDto.ClientName, nameof(legalcaseDto.ClientName), "Client Name is required");
    //                 Require(() => legalcaseDto.ClientTypeId, nameof(legalcaseDto.ClientTypeId), "Client Type is required");

    //                 // Email required
    //                 Require(() => legalcaseDto.ClientEmail, nameof(legalcaseDto.ClientEmail), "Client Email is required");

    //                 // ❌ WRONG email format check
    //                 var email = legalcaseDto.ClientEmail;
    //                 if (!string.IsNullOrWhiteSpace(email))
    //                 {
    //                     // Simple regex for email validation
    //                     var emailRegex = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";

    //                     if (!System.Text.RegularExpressions.Regex.IsMatch(email, emailRegex))
    //                     {
    //                         messageStore.Add(() => legalcaseDto.ClientEmail, "Invalid email format");
    //                         return false;
    //                     }
    //                 }



    //                 // ❌ Duplicate email check
    //                 var isEmailExists = await _clientService.IsEmailExists(legalcaseDto.ClientEmail);

    //                 if (isEmailExists)
    //                 {
    //                     messageStore.Add(() => legalcaseDto.ClientEmail, "Email already exists");
    //                     return false;
    //                 }
    //             }
    //             else if (Steps[CurrentStep].Name == "CaseInfo")
    //             {
    //                 // 🟢 Validate CourtId
    //                 if (legalcaseDto.CourtLocationId == null || legalcaseDto.CourtLocationId == Guid.Empty)
    //                 {
    //                     Require(() => legalcaseDto.CourtLocationId, nameof(legalcaseDto.CourtLocationId), "Court Location is required");
    //                 }

    //                 // 🟢 Validate CountyId (Correct Validation)
    //                 if (legalcaseDto.CountyId == null || legalcaseDto.CountyId == Guid.Empty)
    //                 {
    //                     Require(() => legalcaseDto.CountyId, nameof(legalcaseDto.CountyId), "County is required");
    //                 }

    //                 // 🟢 Validate Case Types (HPD)
    //                 if (legalcaseDto.SelectedCaseTypeHPDIds == null || !legalcaseDto.SelectedCaseTypeHPDIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.CaseTypeHPDId, nameof(legalcaseDto.CaseTypeHPDId), "Please select at least one Case Type");
    //                 }
    //             }


    //             else if (Steps[CurrentStep].Name == "Party")
    //             {
    //                 Require(() => legalcaseDto.PartyRepresentId, nameof(legalcaseDto.PartyRepresentId), "Please select at least one Representation");

    //                 // ✅ Custom validation for Guid LandlordId
    //                 bool isExistingLandlordSelected = legalcaseDto.LandlordId.HasValue && legalcaseDto.LandlordId.Value != Guid.Empty;
    //                 bool isNewLandlordEntered = !string.IsNullOrWhiteSpace(searchlandlordText);

    //                 if (!isExistingLandlordSelected && !isNewLandlordEntered)
    //                 {
    //                     Require(() => legalcaseDto.LandlordId, nameof(legalcaseDto.LandlordId), "Landlord Name is required");

    //                 }

    //                 // TENANT VALIDATION (Require se)
    //                 bool isTenantIdSelected = legalcaseDto.TenantId.HasValue && legalcaseDto.TenantId.Value != Guid.Empty;
    //                 bool isTenantTextEntered = !string.IsNullOrWhiteSpace(searchTenantText);

    //                 // ✔ Validation trigger only when both are empty
    //                 if (!isTenantIdSelected && !isTenantTextEntered)
    //                 {
    //                     Require(() => legalcaseDto.TenantId, nameof(legalcaseDto.TenantId), "Tenant Name is required");
    //                 }

    //             }


    //             else if (Steps[CurrentStep].Name == "Building")
    //             {

    //                 if (!IsNewBuilding)
    //                 {
    //                     Require(() => legalcaseDto.BuildingId, nameof(legalcaseDto.BuildingId), "Select Building");

    //                 }
    //                 if (!IsExistingBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.Units, nameof(legalcaseDto.Units), "Units required");
    //                 }
    //                 if (!IsExistingBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.BuildingAddress, nameof(legalcaseDto.BuildingAddress), "Address required");
    //                 }
    //                 if (!IsExistingBuildingSelected)
    //                 {
    //                     Require(() => legalcaseDto.PremiseTypeId, nameof(legalcaseDto.PremiseTypeId), "Select Building Type");
    //                 }

    //                 Require(() => legalcaseDto.RegistrationStatusTypeId, nameof(legalcaseDto.RegistrationStatusTypeId), "Select Registration Status");

    //             }

    //             else if (Steps[CurrentStep].Name == "PetitionerTenant")
    //             {
    //                 if (legalcaseDto.SelectedHarassmentTypeIds == null || !legalcaseDto.SelectedHarassmentTypeIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.HarassmentTypeId, nameof(legalcaseDto.HarassmentTypeId), "Please select at least one Harasmment");
    //                 }


    //             }
    //             else if (Steps[CurrentStep].Name == "RespondentLandlord")
    //             {
    //                 if (legalcaseDto.SelectedDefenseTypeIds == null || !legalcaseDto.SelectedDefenseTypeIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.DefenseTypeId, nameof(legalcaseDto.DefenseTypeId), "Please select at least one Defense");
    //                 }

    //             }
    //             else if (Steps[CurrentStep].Name == "Appearance")
    //             {
    //                 Require(() => legalcaseDto.AppearanceDate, nameof(legalcaseDto.AppearanceDate), "Please select date");
    //                 Require(() => legalcaseDto.AppearanceTime, nameof(legalcaseDto.AppearanceTime), "Please select Time");
    //                 if (legalcaseDto.SelectedAppearanceTypeIds == null || !legalcaseDto.SelectedAppearanceTypeIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.AppearanceTypeId, nameof(legalcaseDto.AppearanceTypeId), "Please select at least one Appearance");
    //                 }


    //             }
    //             else if (Steps[CurrentStep].Name == "Relief")
    //             {
    //                 if (legalcaseDto.SelectedReliefPetitionerTypeIds == null || !legalcaseDto.SelectedReliefPetitionerTypeIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.ReliefPetitionerTypeId, nameof(legalcaseDto.ReliefPetitionerTypeId), "Please select at least one Relief Petitioner");
    //                 }
    //                 if (legalcaseDto.SelectedReliefRespondentTypeIds == null || !legalcaseDto.SelectedReliefRespondentTypeIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.ReliefRespondentTypeId, nameof(legalcaseDto.ReliefRespondentTypeId), "Please select at least one Relief Respondent");
    //                 }


    //             }
    //             else if (Steps[CurrentStep].Name == "Billing")
    //             {
    //                 Require(() => legalcaseDto.BilingTypeId, nameof(legalcaseDto.BilingTypeId), "Please select at least one Relief Petitioner");

    //             }
    //         }

    //     }
    //     @if (caseTypeName == "Per Diem")
    //     {
    //         {
    //             if (Steps[CurrentStep].Name == "CaseAndclient")
    //             {
    //                 Require(() => legalcaseDto.CaseTypeId, nameof(legalcaseDto.CaseTypeId), "Case type required");

    //                 if (!IsNewClient)
    //                 {
    //                     Require(() => legalcaseDto.ClientId, nameof(legalcaseDto.ClientId), "Client is required");
    //                 }

    //                 Require(() => legalcaseDto.ClientName, nameof(legalcaseDto.ClientName), "Client Name is required");
    //                 Require(() => legalcaseDto.ClientTypeId, nameof(legalcaseDto.ClientTypeId), "Client Type is required");

    //                 // Email required
    //                 Require(() => legalcaseDto.ClientEmail, nameof(legalcaseDto.ClientEmail), "Client Email is required");

    //                 // ❌ WRONG email format check
    //                 var email = legalcaseDto.ClientEmail;
    //                 if (!string.IsNullOrWhiteSpace(email))
    //                 {
    //                     // Simple regex for email validation
    //                     var emailRegex = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";

    //                     if (!System.Text.RegularExpressions.Regex.IsMatch(email, emailRegex))
    //                     {
    //                         messageStore.Add(() => legalcaseDto.ClientEmail, "Invalid email format");
    //                         return false;
    //                     }
    //                 }



    //                 // ❌ Duplicate email check
    //                 // var isEmailExists = await _clientService.IsEmailExists(legalcaseDto.ClientEmail);

    //                 // if (isEmailExists)
    //                 // {
    //                 //     messageStore.Add(() => legalcaseDto.ClientEmail, "Email already exists");
    //                 //     return false;
    //                 // }
    //             }
    //             else if (Steps[CurrentStep].Name == "Attorney")
    //             {
    //                 Require(() => legalcaseDto.Attrney, nameof(legalcaseDto.Attrney), "Attorney/Firm is required");
    //             }
    //             else if (Steps[CurrentStep].Name == "CaseInfo")
    //             {
    //                 Require(() => legalcaseDto.CourtLocationId, nameof(legalcaseDto.CourtLocationId), "Court Location is required");

    //                 Require(() => legalcaseDto.CountyId, nameof(legalcaseDto.CountyId), "County  is required");
    //                 if (legalcaseDto.SelectedCaseTypePerDiemIds == null || !legalcaseDto.SelectedCaseTypePerDiemIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.CaseTypePerDiemId, nameof(legalcaseDto.CaseTypePerDiemId), "Please select at least one Case Type");
    //                 }

    //             }
    //             else if (Steps[CurrentStep].Name == "Party")
    //             {
    //                 Require(() => legalcaseDto.PartyRepresentPerDiemId, nameof(legalcaseDto.PartyRepresentPerDiemId), "Please select at least one Representation");


    //             }

    //             else if (Steps[CurrentStep].Name == "Appearance")
    //             {
    //                 Require(() => legalcaseDto.AppearanceDate, nameof(legalcaseDto.AppearanceDate), "Please select date");
    //                 Require(() => legalcaseDto.AppearanceTime, nameof(legalcaseDto.AppearanceTime), "Please select Time");
    //                 if (legalcaseDto.SelectedAppearanceTypePerDiemIds == null || !legalcaseDto.SelectedAppearanceTypePerDiemIds.Any())
    //                 {
    //                     Require(() => legalcaseDto.AppearanceTypePerdiemId, nameof(legalcaseDto.AppearanceTypePerdiemId), "Please select at least one Appearance");
    //                 }


    //             }
    //             else if (Steps[CurrentStep].Name == "CasebackGround")
    //             {

    //                 Require(() => legalcaseDto.CaseBackground, nameof(legalcaseDto.CaseBackground), "Case background required in briefly");
    //             }
    //             else if (Steps[CurrentStep].Name == "Billing")
    //             {
    //                 Require(() => legalcaseDto.BilingTypeId, nameof(legalcaseDto.BilingTypeId), "Please select at least one Biling");
    //                 Require(() => legalcaseDto.PaymentMethodId, nameof(legalcaseDto.PaymentMethodId), "Please select at least one payment Method");

    //             }
    //             else if (Steps[CurrentStep].Name == "Acknowledgment")
    //             {
    //                 Require(() => legalcaseDto.PerDiemAttorneyname, nameof(legalcaseDto.PerDiemAttorneyname), "Attorney Name is required ");
    //                 Require(() => legalcaseDto.PerDiemSignature, nameof(legalcaseDto.PerDiemSignature), "Signature is required");
    //                 Require(() => legalcaseDto.PerDiemDate, nameof(legalcaseDto.PerDiemDate), "Date is required");

    //             }
    //         }

    //     }

    //     // Notify UI about validation changes
    //     _editContext.NotifyValidationStateChanged();

    //     // Get current validation messages (optional: for logging)
    //     var errors = _editContext.GetValidationMessages().ToList();
    //     Console.WriteLine($"Validation errors at {CurrentStep}: {string.Join(", ", errors)}");

    //     // Check if form is valid
    //     bool isValid = !_editContext.GetValidationMessages().Any();

    //     // Return validity
    //     return isValid;

    // }

    private async Task<bool> ValidateCurrentStep()
    {
        messageStore.Clear();

        var caseTypeName = CaseTypeList
    .FirstOrDefault(x => x.Id == legalcaseDto.CaseTypeId)?.Name;

        @if (caseTypeName == "Holdover" || caseTypeName == "NonPayment")
        {
            {
                if (Steps[CurrentStep].Name == "CaseAndclient")
                {
                    Require(() => legalcaseDto.CaseTypeId, nameof(legalcaseDto.CaseTypeId), "Case type required");

                    if (!IsNewClient)
                    {
                        Require(() => legalcaseDto.ClientId, nameof(legalcaseDto.ClientId), "Client is required");
                    }

                    Require(() => legalcaseDto.ClientName, nameof(legalcaseDto.ClientName), "Client Name is required");
                    Require(() => legalcaseDto.ClientTypeId, nameof(legalcaseDto.ClientTypeId), "Client Type is required");

                    // Email required
                    Require(() => legalcaseDto.ClientEmail, nameof(legalcaseDto.ClientEmail), "Client Email is required");

                    // ❌ WRONG email format check
                    var email = legalcaseDto.ClientEmail;
                    if (!string.IsNullOrWhiteSpace(email))
                    {
                        // Simple regex for email validation
                        var emailRegex = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";

                        if (!System.Text.RegularExpressions.Regex.IsMatch(email, emailRegex))
                        {
                            messageStore.Add(() => legalcaseDto.ClientEmail, "Invalid email format");
                            return false;
                        }
                    }



                    // ❌ Duplicate email check
                    // var isEmailExists = await _clientService.IsEmailExists(legalcaseDto.ClientEmail);

                    // if (isEmailExists)
                    // {
                    //     messageStore.Add(() => legalcaseDto.ClientEmail, "Email already exists");
                    //     return false;
                    // }
                }

                else if (Steps[CurrentStep].Name == "Landlord")
                {

                    bool islandlordIdSelected = legalcaseDto.LandlordId.HasValue && legalcaseDto.LandlordId.Value != Guid.Empty;
                    bool islandlordTextEntered = !string.IsNullOrWhiteSpace(searchlandlordText);

                    // ✔ Validation trigger only when both are empty
                    if (!islandlordIdSelected && !islandlordTextEntered)
                    {
                        Require(() => legalcaseDto.LandlordId, nameof(legalcaseDto.LandlordId), "Landlord name is required");
                    }

                    if (!IsLandlordSelected)
                    {

                        Require(() => legalcaseDto.ContactPersonName, nameof(legalcaseDto.ContactPersonName), "Contact Person is required");
                    }
                    if (!IsLandlordSelected)
                    {
                        Require(() => legalcaseDto.LandlordAddress, nameof(legalcaseDto.LandlordAddress), "Address is required");
                    }


                }
                else if (Steps[CurrentStep].Name == "Building")
                {
                    if (!isBuildingSelected)
                    {
                        Require(() => legalcaseDto.Mdr, nameof(legalcaseDto.Mdr), "MDR is required");
                    }

                    if (!IsNewBuilding)
                    {
                        Require(() => legalcaseDto.BuildingId, nameof(legalcaseDto.BuildingId), "Building is required");

                    }
                    if (IsNewBuilding)
                    {
                        Require(() => legalcaseDto.BuildingZip, nameof(legalcaseDto.BuildingZip), "Zipcode is Required");
                        Require(() => legalcaseDto.BuildingStateId, nameof(legalcaseDto.BuildingStateId), "Please select a state");
                    }

                    if (!isBuildingSelected)
                    {
                        Require(() => legalcaseDto.BoroughorCityId, nameof(legalcaseDto.BoroughorCityId), "City is required");
                    }
                    if (!isBuildingSelected)
                    {
                        Require(() => legalcaseDto.Units, nameof(legalcaseDto.Units), "Units is required");
                    }

                    if (!isBuildingSelected)
                    {
                        Require(() => legalcaseDto.BuildingAddress, nameof(legalcaseDto.BuildingAddress), "Address is required");
                    }
                    if (!isBuildingSelected)
                    {
                        Require(() => legalcaseDto.RegulationStatusId, nameof(legalcaseDto.RegulationStatusId), "Please select a regulation");
                    }
                    Require(() => legalcaseDto.RegistrationStatusTypeId, nameof(legalcaseDto.RegistrationStatusTypeId), "Select Registration Status");



                }


                else if (Steps[CurrentStep].Name == "Tenant")
                {
                    bool isTenantSelected = legalcaseDto.TenantId.HasValue && legalcaseDto.TenantId.Value != Guid.Empty;
                    bool isTextEntered = !string.IsNullOrWhiteSpace(searchTenantText);

                    // Tenant is required
                    if (!isTenantSelected && !isTextEntered)
                    {
                        Require(() => legalcaseDto.TenantId, nameof(legalcaseDto.TenantId), "Unit/Apt is required");
                    }


                    Require(() => legalcaseDto.TenantName, nameof(legalcaseDto.TenantName), "Tenant Name is required");
                    Require(() => legalcaseDto.RentDueEachMonthOrWeekId, nameof(legalcaseDto.RentDueEachMonthOrWeekId), "Select Date Rent due");
                    Require(() => legalcaseDto.TenancyTypeId, nameof(legalcaseDto.TenancyTypeId), "Select Tenancy type");
                    Require(() => legalcaseDto.MonthlyRent, nameof(legalcaseDto.MonthlyRent), "Monthly Rent is required");
                }

                else if (Steps[CurrentStep].Name == "Terms")
                {
                    Require(() => legalcaseDto.DateTenantMoved, nameof(legalcaseDto.DateTenantMoved), "Date is required");

                }
                else if (Steps[CurrentStep].Name == "Rent")
                {
                    Require(() => legalcaseDto.MonthlyRent, nameof(legalcaseDto.MonthlyRent), "Monthly rent required");
                    Require(() => legalcaseDto.RentDueEachMonthOrWeekId, nameof(legalcaseDto.RentDueEachMonthOrWeekId), "rent due  required");

                }
                // else if (Steps[CurrentStep].Name == "Case")
                // {
                //     Require(() => legalcaseDto.TenancyTypeId, nameof(legalcaseDto.TenancyTypeId), "Tenancy type required");
                //     Require(() => legalcaseDto.DateNoticeServed, nameof(legalcaseDto.DateNoticeServed), "Notice Serve Date required");
                // }
            }

        }


        @if (caseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
        {
            {
                if (Steps[CurrentStep].Name == "CaseAndclient")
                {
                    Require(() => legalcaseDto.CaseTypeId, nameof(legalcaseDto.CaseTypeId), "Case type required");

                    if (!IsNewClient)
                    {
                        Require(() => legalcaseDto.ClientId, nameof(legalcaseDto.ClientId), "Client is required");
                    }

                    Require(() => legalcaseDto.ClientName, nameof(legalcaseDto.ClientName), "Client Name is required");
                    Require(() => legalcaseDto.ClientTypeId, nameof(legalcaseDto.ClientTypeId), "Client Type is required");

                    // Email required
                    Require(() => legalcaseDto.ClientEmail, nameof(legalcaseDto.ClientEmail), "Client Email is required");

                    // ❌ WRONG email format check
                    var email = legalcaseDto.ClientEmail;
                    if (!string.IsNullOrWhiteSpace(email))
                    {
                        // Simple regex for email validation
                        var emailRegex = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";

                        if (!System.Text.RegularExpressions.Regex.IsMatch(email, emailRegex))
                        {
                            messageStore.Add(() => legalcaseDto.ClientEmail, "Invalid email format");
                            return false;
                        }
                    }



                    // ❌ Duplicate email check
                    // var isEmailExists = await _clientService.IsEmailExists(legalcaseDto.ClientEmail);

                    // if (isEmailExists)
                    // {
                    //     messageStore.Add(() => legalcaseDto.ClientEmail, "Email already exists");
                    //     return false;
                    // }
                }
                else if (Steps[CurrentStep].Name == "CaseInfo")
                {
                    // 🟢 Validate CourtId
                    if (legalcaseDto.CourtLocationId == null || legalcaseDto.CourtLocationId == Guid.Empty)
                    {
                        Require(() => legalcaseDto.CourtLocationId, nameof(legalcaseDto.CourtLocationId), "Court Location is required");
                    }

                    // 🟢 Validate CountyId (Correct Validation)
                    if (legalcaseDto.CountyId == null || legalcaseDto.CountyId == Guid.Empty)
                    {
                        Require(() => legalcaseDto.CountyId, nameof(legalcaseDto.CountyId), "County is required");
                    }

                    // 🟢 Validate Case Types (HPD)
                    if (legalcaseDto.SelectedCaseTypeHPDIds == null || !legalcaseDto.SelectedCaseTypeHPDIds.Any())
                    {
                        Require(() => legalcaseDto.CaseTypeHPDId, nameof(legalcaseDto.CaseTypeHPDId), "Please select at least one Case Type");
                    }
                }


                else if (Steps[CurrentStep].Name == "Party")
                {
                    Require(() => legalcaseDto.PartyRepresentId, nameof(legalcaseDto.PartyRepresentId), "Please select at least one Representation");

                    // ✅ Custom validation for Guid LandlordId
                    bool isExistingLandlordSelected = legalcaseDto.LandlordId.HasValue && legalcaseDto.LandlordId.Value != Guid.Empty;
                    bool isNewLandlordEntered = !string.IsNullOrWhiteSpace(searchlandlordText);

                    if (!isExistingLandlordSelected && !isNewLandlordEntered)
                    {
                        Require(() => legalcaseDto.LandlordId, nameof(legalcaseDto.LandlordId), "Landlord Name is required");

                    }

                    // TENANT VALIDATION (Require se)
                    bool isTenantIdSelected = legalcaseDto.TenantId.HasValue && legalcaseDto.TenantId.Value != Guid.Empty;
                    bool isTenantTextEntered = !string.IsNullOrWhiteSpace(searchTenantText);

                    // ✔ Validation trigger only when both are empty
                    if (!isTenantIdSelected && !isTenantTextEntered)
                    {
                        Require(() => legalcaseDto.TenantId, nameof(legalcaseDto.TenantId), "Tenant Name is required");
                    }

                }


                else if (Steps[CurrentStep].Name == "Building")
                {

                    if (!IsNewBuilding)
                    {
                        Require(() => legalcaseDto.BuildingId, nameof(legalcaseDto.BuildingId), "Select Building");

                    }
                    if (!IsExistingBuildingSelected)
                    {
                        Require(() => legalcaseDto.Units, nameof(legalcaseDto.Units), "Units required");
                    }
                    if (!IsExistingBuildingSelected)
                    {
                        Require(() => legalcaseDto.BuildingAddress, nameof(legalcaseDto.BuildingAddress), "Address required");
                    }
                    if (!IsExistingBuildingSelected)
                    {
                        Require(() => legalcaseDto.PremiseTypeId, nameof(legalcaseDto.PremiseTypeId), "Select Building Type");
                    }

                    Require(() => legalcaseDto.RegistrationStatusTypeId, nameof(legalcaseDto.RegistrationStatusTypeId), "Select Registration Status");

                }

                else if (Steps[CurrentStep].Name == "PetitionerTenant")
                {
                    if (legalcaseDto.SelectedHarassmentTypeIds == null || !legalcaseDto.SelectedHarassmentTypeIds.Any())
                    {
                        Require(() => legalcaseDto.HarassmentTypeId, nameof(legalcaseDto.HarassmentTypeId), "Please select at least one Harasmment");
                    }


                }
                else if (Steps[CurrentStep].Name == "RespondentLandlord")
                {
                    if (legalcaseDto.SelectedDefenseTypeIds == null || !legalcaseDto.SelectedDefenseTypeIds.Any())
                    {
                        Require(() => legalcaseDto.DefenseTypeId, nameof(legalcaseDto.DefenseTypeId), "Please select at least one Defense");
                    }

                }
                else if (Steps[CurrentStep].Name == "Appearance")
                {
                    Require(() => legalcaseDto.AppearanceDate, nameof(legalcaseDto.AppearanceDate), "Please select date");
                    Require(() => legalcaseDto.AppearanceTime, nameof(legalcaseDto.AppearanceTime), "Please select Time");
                    if (legalcaseDto.SelectedAppearanceTypeIds == null || !legalcaseDto.SelectedAppearanceTypeIds.Any())
                    {
                        Require(() => legalcaseDto.AppearanceTypeId, nameof(legalcaseDto.AppearanceTypeId), "Please select at least one Appearance");
                    }


                }
                else if (Steps[CurrentStep].Name == "Relief")
                {
                    if (legalcaseDto.SelectedReliefPetitionerTypeIds == null || !legalcaseDto.SelectedReliefPetitionerTypeIds.Any())
                    {
                        Require(() => legalcaseDto.ReliefPetitionerTypeId, nameof(legalcaseDto.ReliefPetitionerTypeId), "Please select at least one Relief Petitioner");
                    }
                    if (legalcaseDto.SelectedReliefRespondentTypeIds == null || !legalcaseDto.SelectedReliefRespondentTypeIds.Any())
                    {
                        Require(() => legalcaseDto.ReliefRespondentTypeId, nameof(legalcaseDto.ReliefRespondentTypeId), "Please select at least one Relief Respondent");
                    }


                }
                else if (Steps[CurrentStep].Name == "Billing")
                {
                    Require(() => legalcaseDto.BilingTypeId, nameof(legalcaseDto.BilingTypeId), "Please select at least one Relief Petitioner");

                }
            }

        }
        @if (caseTypeName == "Per Diem")
        {
            {
                if (Steps[CurrentStep].Name == "CaseAndclient")
                {
                    Require(() => legalcaseDto.CaseTypeId, nameof(legalcaseDto.CaseTypeId), "Case type required");

                    if (!IsNewClient)
                    {
                        Require(() => legalcaseDto.ClientId, nameof(legalcaseDto.ClientId), "Client is required");
                    }

                    Require(() => legalcaseDto.ClientName, nameof(legalcaseDto.ClientName), "Client Name is required");
                    Require(() => legalcaseDto.ClientTypeId, nameof(legalcaseDto.ClientTypeId), "Client Type is required");

                    // Email required
                    Require(() => legalcaseDto.ClientEmail, nameof(legalcaseDto.ClientEmail), "Client Email is required");

                    // ❌ WRONG email format check
                    var email = legalcaseDto.ClientEmail;
                    if (!string.IsNullOrWhiteSpace(email))
                    {
                        // Simple regex for email validation
                        var emailRegex = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";

                        if (!System.Text.RegularExpressions.Regex.IsMatch(email, emailRegex))
                        {
                            messageStore.Add(() => legalcaseDto.ClientEmail, "Invalid email format");
                            return false;
                        }
                    }



                    // ❌ Duplicate email check
                    // var isEmailExists = await _clientService.IsEmailExists(legalcaseDto.ClientEmail);

                    // if (isEmailExists)
                    // {
                    //     messageStore.Add(() => legalcaseDto.ClientEmail, "Email already exists");
                    //     return false;
                    // }
                }
                else if (Steps[CurrentStep].Name == "Attorney")
                {
                    Require(() => legalcaseDto.Attrney, nameof(legalcaseDto.Attrney), "Attorney/Firm is required");
                }
                else if (Steps[CurrentStep].Name == "CaseInfo")
                {
                    Require(() => legalcaseDto.CourtLocationId, nameof(legalcaseDto.CourtLocationId), "Court Location is required");

                    Require(() => legalcaseDto.CountyId, nameof(legalcaseDto.CountyId), "County  is required");
                    if (legalcaseDto.SelectedCaseTypePerDiemIds == null || !legalcaseDto.SelectedCaseTypePerDiemIds.Any())
                    {
                        Require(() => legalcaseDto.CaseTypePerDiemId, nameof(legalcaseDto.CaseTypePerDiemId), "Please select at least one Case Type");
                    }

                }
                else if (Steps[CurrentStep].Name == "Party")
                {
                    Require(() => legalcaseDto.PartyRepresentPerDiemId, nameof(legalcaseDto.PartyRepresentPerDiemId), "Please select at least one Representation");


                }

                else if (Steps[CurrentStep].Name == "Appearance")
                {
                    Require(() => legalcaseDto.AppearanceDate, nameof(legalcaseDto.AppearanceDate), "Please select date");
                    Require(() => legalcaseDto.AppearanceTime, nameof(legalcaseDto.AppearanceTime), "Please select Time");
                    if (legalcaseDto.SelectedAppearanceTypePerDiemIds == null || !legalcaseDto.SelectedAppearanceTypePerDiemIds.Any())
                    {
                        Require(() => legalcaseDto.AppearanceTypePerdiemId, nameof(legalcaseDto.AppearanceTypePerdiemId), "Please select at least one Appearance");
                    }


                }
                else if (Steps[CurrentStep].Name == "CasebackGround")
                {

                    Require(() => legalcaseDto.CaseBackground, nameof(legalcaseDto.CaseBackground), "Case background required in briefly");
                }
                else if (Steps[CurrentStep].Name == "Billing")
                {
                    Require(() => legalcaseDto.BilingTypeId, nameof(legalcaseDto.BilingTypeId), "Please select at least one Biling");
                    Require(() => legalcaseDto.PaymentMethodId, nameof(legalcaseDto.PaymentMethodId), "Please select at least one payment Method");

                }
                else if (Steps[CurrentStep].Name == "Acknowledgment")
                {
                    Require(() => legalcaseDto.PerDiemAttorneyname, nameof(legalcaseDto.PerDiemAttorneyname), "Attorney Name is required ");
                    Require(() => legalcaseDto.PerDiemSignature, nameof(legalcaseDto.PerDiemSignature), "Signature is required");
                    Require(() => legalcaseDto.PerDiemDate, nameof(legalcaseDto.PerDiemDate), "Date is required");

                }
            }

        }

        // Notify UI about validation changes
        _editContext.NotifyValidationStateChanged();

        // Get current validation messages (optional: for logging)
        var errors = _editContext.GetValidationMessages().ToList();
        Console.WriteLine($"Validation errors at {CurrentStep}: {string.Join(", ", errors)}");

        // Check if form is valid
        bool isValid = !_editContext.GetValidationMessages().Any();

        // Return validity
        return isValid;

    }
    private async Task SelectCourtType()
    {
        var CourtType = CourtTypeList.FirstOrDefault(ty => ty.Id == legalcaseDto.CourtTypeId);
        var query = CourtLocationList.ToList();
        if (CourtType!.Name.Contains("NYC"))
        {
            legalcaseDto.CountyId = null;
            showCountyDropdown = true;
            showCourtPartDropdown = true;
            filteredCourts = query.Where(x => !x.CountyName.Contains("Nassau") && !x.CountyName.Contains("Westchester"))
                                   .ToList();
        }
        else if (CourtType.Name.Contains("Nassau"))
        {
            showCountyDropdown = false;
            showCourtPartDropdown = false;
            var county = CountyList.Where(e => e.Name.Contains("Nassau")).FirstOrDefault();
            legalcaseDto.CountyId = county.Id;
            filteredCourts = query.Where(x => x.CountyName.Contains("Nassau"))
                                   .ToList();

        }
        else if (CourtType.Name.Contains("Westchester"))
        {
            showCountyDropdown = false;
            showCourtPartDropdown = false;
            var county = CountyList.Where(e => e.Name.Contains("Westchester")).FirstOrDefault();
            legalcaseDto.CountyId = county.Id;
            filteredCourts = query.Where(x => x.CountyName.Contains("Westchester"))
                                   .ToList();
        }


        StateHasChanged();
    }

    void OnBillingTypeChanged(Guid id)
    {
        legalcaseDto.BilingTypeId = id;

        // Input reset jab Flat → Hourly switch hota hai
        legalcaseDto.BilingTypeInputValue = null;
    }

    // private bool ValidateAll()
    // {
    //     var previous = CurrentStep;
    //     var ok = true;
    //     foreach (Step s in Enum.GetValues(typeof(Step)))
    //     {
    //         CurrentStep = s;
    //         ok &= ValidateCurrentStep();
    //     }
    //     CurrentStep = previous;
    //     return ok;
    // }

    private void Require<T>(Expression<Func<T>> accessor, string fieldName, string message)
    {
        var value = accessor.Compile().Invoke();
        var fieldIdentifier = new FieldIdentifier(legalcaseDto, fieldName);

        // Clear old message first
        messageStore.Clear(fieldIdentifier);

        // Add message if invalid
        bool isEmpty = value == null ||
                       (value is string s && string.IsNullOrWhiteSpace(s)) ||
                       (value is Guid g && g == Guid.Empty);

        if (isEmpty)
        {
            messageStore.Add(fieldIdentifier, message);
        }

        _editContext.NotifyValidationStateChanged();
    }

    private void Prev()
    {
        if (CurrentStep > 0) CurrentStep--;
    }


    private async Task UpdateAsync()
    {
        @if (legalcaseDto.CaseTypeName == "Holdover" || legalcaseDto.CaseTypeName == "NonPayment")
        {
            try
            {
                spinnerservice.Show();
                var authState = await _authStateProvider.GetAuthenticationStateAsync();
                var user = authState.User;

                var userIdClaim = user.Claims.FirstOrDefault(c => c.Type == ClaimTypes.NameIdentifier)?.Value;

                if (!string.IsNullOrEmpty(userIdClaim) && Guid.TryParse(userIdClaim, out Guid userGuid))
                {
                    legalcaseDto.UpdatedBy = userGuid;
                    legalcaseDto.UpdatedOn = DateTime.Now;
                }
                else
                {
                    // unauthenticated user
                    legalcaseDto.UpdatedBy = Guid.Empty;
                    legalcaseDto.UpdatedOn = DateTime.Now;
                }
                // 1. Handle Client
                if (selectedClient == null)
                {
                    // create new client
                    var nameparts = legalcaseDto.ClientName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                    newClient = new CreateToClientDto()
                    {
                        FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                        LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                        Email = legalcaseDto.ClientEmail,
                        Phone = legalcaseDto.ClientPhone,
                        ClientTypeId = legalcaseDto.ClientTypeId,
                        CreatedBy = legalcaseDto.CreatedBy

                    };


                    var clientId = await _clientService.CreateOnlyClient(newClient);
                    legalcaseDto.ClientId = clientId;
                }
                else
                {
                    // check if changed -> update
                    if (selectedClient != null && HasClientChanged(selectedClient, legalcaseDto))
                    {
                        var nameparts = legalcaseDto.ClientName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                        var updateclient = new EditToClientDto
                        {
                            Id = legalcaseDto.ClientId ?? Guid.Empty,
                            FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                            LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                            Email = legalcaseDto.ClientEmail,
                            Phone = legalcaseDto.ClientPhone,
                            ClientTypeId = legalcaseDto.ClientTypeId,
                            Reference = legalcaseDto.Reference

                        };
                        await _clientService.UpdateClientformCase(updateclient);
                    }
                }

                // 2. Handle Landlord
                if (selectedlandlord == null)
                {
                    var nameparts = searchlandlordText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                    newLandlord = new CreateToLandLordDto()
                    {

                        FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                        LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                        Address1 = legalcaseDto.LandlordAddress,
                        //LawFirm = legalcaseDto.LawFirm,
                        ContactPersonName = legalcaseDto.ContactPersonName,
                        //AttorneyOfRecord = legalcaseDto.AttorneyOfRecord,
                        ClientId = legalcaseDto.ClientId
                    };
                    var landlordId = await _landlordService.AddOnlyLandLordfromCase(newLandlord);
                    legalcaseDto.LandlordId = landlordId;
                }
                else
                {
                    if (selectedlandlord != null && HasLandlordChanged(selectedlandlord, legalcaseDto))
                    {
                        var nameparts = searchlandlordText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                        var updateLandLord = new EditToLandlordDto()
                        {
                            Id = legalcaseDto.LandlordId.Value,
                            FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                            LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                            Address1 = legalcaseDto.LandlordAddress,
                            ClientId = legalcaseDto.ClientId,
                            ContactPersonName = legalcaseDto.ContactPersonName
                        };
                        await _landlordService.UpdateLandLordsfromCase(updateLandLord);
                    }
                }

                // 2. Handle Building
                if (selectedbuilding == null)
                {
                    newBuilding = new CreateToBuildingDto()
                    {
                        Address1 = legalcaseDto.BuildingAddress,
                        //Address2 = address2,
                        CityId = legalcaseDto.BoroughorCityId,
                        StateId = legalcaseDto.BuildingStateId,
                        Zipcode = legalcaseDto.BuildingZip,
                        BuildingUnits = legalcaseDto.Units,
                        ApartmentCode = legalcaseDto.UnitOrApartmentNumber,
                        MDRNumber = legalcaseDto.Mdr,
                        RegulationStatusId = legalcaseDto.RegulationStatusId,
                        LandlordId = legalcaseDto.LandlordId,
                        ExemptionBasisId = legalcaseDto.ExemptionBasisId,
                        ExemptionreasonId = legalcaseDto.ExemptionReasonId,
                        PrimaryResidence = legalcaseDto.PrimaryResidence,
                        GoodCause = legalcaseDto.GoodCause,
                        OwnerOccupied = legalcaseDto.OwnerOccupied,
                        TenancyTypeForBuildingId = legalcaseDto.TenancyTypeForBuildingId,
                        RegistrationStatusId = legalcaseDto.RegistrationStatusTypeId,
                        ExemptionBasisother = legalcaseDto.ExemptionBasisOther,
                        RentRegulationOther = legalcaseDto.RentRegulationOther,
                    };

                    var buildingId = await _buildingService.AddOnlyApartmentfromCase(newBuilding);
                    legalcaseDto.BuildingId = buildingId;
                }
                else
                {
                    if (selectedbuilding != null && HasBuildingChanged(selectedbuilding, legalcaseDto))
                    {
                        // var parts = legalcaseDto.BuildingAddress
                        // .Split(',', StringSplitOptions.RemoveEmptyEntries)
                        // .Select(p => p.Trim())
                        // .ToList();

                        // // Always take last 3 parts for City, State, Zip
                        // string zipcode = parts.Count > 0 ? parts[^1] : string.Empty;
                        // string state = parts.Count > 1 ? parts[^2] : string.Empty;
                        // string city = parts.Count > 2 ? parts[^3] : string.Empty;

                        // // Everything before those is Address1 + Address2 (optional)
                        // string addressBlock = string.Join(", ", parts.Take(parts.Count - 3));

                        // string address1 = addressBlock;
                        // string address2 = null;

                        // if (!string.IsNullOrEmpty(addressBlock))
                        // {
                        //     var addressParts = addressBlock.Split(',', 2, StringSplitOptions.TrimEntries);
                        //     address1 = addressParts[0];
                        //     if (addressParts.Length > 1)
                        //         address2 = addressParts[1];
                        // }

                        var updateBuilding = new EditToBuildingDto()
                        {
                            Id = legalcaseDto.BuildingId.Value,
                            Address1 = legalcaseDto.BuildingAddress,
                            RegistrationStatusId = legalcaseDto.RegistrationStatusTypeId,
                            BuildingTypeId = legalcaseDto.BuildingTypeId,
                            CityId = legalcaseDto.BoroughorCityId,

                            BuildingUnits = legalcaseDto.Units,
                            ApartmentCode = legalcaseDto.UnitOrApartmentNumber,
                            MDRNumber = legalcaseDto.Mdr,
                            RegulationStatusId = legalcaseDto.RegulationStatusId,
                            ExemptionBasisId = legalcaseDto.ExemptionBasisId,
                            ExemptionreasonId = legalcaseDto.ExemptionReasonId,
                            PrimaryResidence = legalcaseDto.PrimaryResidence,
                            GoodCause = legalcaseDto.GoodCause,
                            OwnerOccupied = legalcaseDto.OwnerOccupied,
                            TenancyTypeForBuildingId = legalcaseDto.TenancyTypeForBuildingId,
                            RentRegulationOther = legalcaseDto.RentRegulationOther,
                            ExemptionBasisother = legalcaseDto.ExemptionBasisOther,
                        };

                        await _buildingService.UpdateonlyBuildingfromCase(updateBuilding);

                    }
                }

                if (selectedtenant == null)
                {
                    var parts = Tenants[0].Split(' ', StringSplitOptions.RemoveEmptyEntries);

                    var firstName = parts.FirstOrDefault() ?? "";
                    var lastName = parts.Length > 1 ? parts.Last() : "";
                    var newTenant = new CreateToTenantDto()
                    {
                        FirstName = firstName,
                        LastName = lastName,
                        UnitOrApartmentNumber = legalcaseDto.UnitOrApartmentNumber ?? searchTenantText,
                        BuildingId = legalcaseDto.BuildingId,
                        PrimaryResidence = legalcaseDto.PrimaryResidence,
                        TenancyTypeId = legalcaseDto.TenancyTypeId,
                        MonthlyRent = legalcaseDto.MonthlyRent,
                        TenantShare = legalcaseDto.TenantShare,
                        RentDueEachMonthOrWeekId = legalcaseDto.RentDueEachMonthOrWeekId

                    };
                    var tenantId = await _tenantService.AddTenantfromCase(newTenant);
                    IsNewTenant = true;
                    legalcaseDto.TenantId = tenantId;

                }
                else
                {
                    if (Tenants.Count > 0 && selectedtenant != null)
                    {
                        var mainTenantName = Tenants[0]?.Trim();
                        if (!string.IsNullOrWhiteSpace(mainTenantName))
                        {
                            var parts = mainTenantName.Split(' ', 2, StringSplitOptions.RemoveEmptyEntries);
                            var firstName = parts.Length > 0 ? parts[0] : "";
                            var lastName = parts.Length > 1 ? parts[1] : "";

                            // Only update if anything actually changed
                            if (HasTenantChanged(selectedtenant, legalcaseDto, firstName, lastName))
                            {
                                var updateTenant = new EditToTenantDto
                                {
                                    Id = legalcaseDto.TenantId ?? Guid.Empty,
                                    FirstName = firstName,
                                    LastName = lastName,
                                    BuildingId = legalcaseDto.BuildingId,
                                    UnitOrApartmentNumber = legalcaseDto.UnitOrApartmentNumber,
                                    MonthlyRent = legalcaseDto.MonthlyRent,
                                    TenantShare = legalcaseDto.TenantShare,
                                    RentDueEachMonthOrWeekId = legalcaseDto.RentDueEachMonthOrWeekId,
                                    // TotalRentOwed = legalcaseDto.TotalOwed,
                                    TenancyTypeId = legalcaseDto.TenancyTypeId,
                                    PrimaryResidence = legalcaseDto.PrimaryResidence,
                                    SocialServices = legalcaseDto.SocialService,
                                    UpdatedOn = DateTime.Now
                                };

                                await _tenantService.UpdateTenantAsync(updateTenant);
                            }
                        }
                    }

                }

                if (AdditionalTenantList.Count > 0)
                {
                    foreach (var t in AdditionalTenantList)
                    {
                        t.TenantId = legalcaseDto.TenantId;
                    }

                    var toadd = AdditionalTenantList.Where(e => e.Id == null || e.Id == Guid.Empty && e.IsDeleted == false).ToList();
                    var toupdate = AdditionalTenantList.Where(e => e.Id != null && e.Id != Guid.Empty && e.IsDeleted == false).ToList();
                    if (toadd.Any())
                    {
                        await _additionalTenant.AddAdditionalTenantAsync(toadd);
                    }
                    if (toupdate.Any())
                    {
                        await _additionalTenant.UpdateAdditionalTenantAsync(toupdate);
                    }

                }

                if (legalcaseDto != null || legalcaseDto.Id == Guid.Empty)
                {

                    var result = await _legalCaseService.UpdateCaseAsync(legalcaseDto);

                    if (result == null)
                    {
                        return;
                    }
                    if (AdditionalTenantList.Any())
                    {
                        var toAdd = AdditionalTenantList
                    .Where(o => o.IsDeleted != true && (o.LegalCaseId == null || o.LegalCaseId == Guid.Empty))
                    .ToList();

                        var toUpdate = AdditionalTenantList
                        .Where(o => o.IsDeleted != true && (o.LegalCaseId != null && o.LegalCaseId != Guid.Empty))
                        .ToList();

                        var toDelete = AdditionalTenantList
                            .Where(o => o.IsDeleted == true && (o.LegalCaseId != null && o.LegalCaseId != Guid.Empty))
                            .ToList();
                        foreach (var occupant in toAdd)
                        {
                            occupant.LegalCaseId = legalcaseDto.Id;
                        }
                        if (toUpdate.Any())
                            await _caseAdditionalTenant.UpdateAdditionalCaseTenantAsync(toUpdate);

                        if (toAdd.Any())
                            await _caseAdditionalTenant.AddAdditionalCaseTenantAsync(toAdd);

                        if (toDelete.Any())
                            await _caseAdditionalTenant.DeleteAdditionalCaseTenants(toDelete);
                    }

                    if (AdditionalOccupantsList.Any())
                    {
                        foreach (var occupant in AdditionalOccupantsList)
                        {
                            occupant.LegalCaseId = result;
                        }

                        var toAdd = AdditionalOccupantsList
                            .Where(o => o.IsDeleted != true && (o.Id == null || o.Id == Guid.Empty))
                            .ToList();

                        var toUpdate = AdditionalOccupantsList
                        .Where(o => o.IsDeleted != true && (o.Id != null && o.Id != Guid.Empty))
                        .ToList();

                        var toDelete = AdditionalOccupantsList
                            .Where(o => o.IsDeleted == true && (o.Id != null && o.Id != Guid.Empty))
                            .ToList();

                        if (toUpdate.Any())
                            await _additionalOccupant.UpdateAdditionalOccupantsAsync(toUpdate);

                        if (toAdd.Any())
                            await _additionalOccupant.AddAdditionalOccupantsAsync(toAdd);

                        if (toDelete.Any())
                            await _additionalOccupant.DeleteAdditionalOccupants(toDelete);
                    }

                    if (AdditionalPetitioners.Any())
                    {
                        var addpetitioner = AdditionalPetitioners.Where(e => e.Id == null || e.Id == Guid.Empty).Select(e => new CaseAdditionalPetitioner()
                        {
                            Name = e.Name,
                            LegalcaseId = result,
                            TenantId = legalcaseDto.TenantId,
                        }).ToList();
                        AdditionalPetitionersDelete.AddRange(addpetitioner);

                        if (addpetitioner.Any())
                        {
                            var petitioner = await _legalCaseService.AddAdditionalpetitioner(addpetitioner);

                        }
                    }

                    if (AdditionalRespondent.Any())
                    {
                        var addrespondent = AdditionalRespondent.Where(e => e.Id == null || e.Id == Guid.Empty).Select(e => new CaseAdditionalRespondent()
                        {
                            Name = e.Name,
                            LegalcaseId = result,
                            LandlordId = legalcaseDto.LandlordId,
                        }).ToList();
                        AdditionalRespondentDelete.AddRange(addrespondent);

                        if (addrespondent.Any())
                        {
                            var respondent = await _legalCaseService.AddAdditionalrespondent(addrespondent);

                        }
                    }
                    if (AdditionalRespondent.Count() != AdditionalRespondentDelete.Count())
                    {
                        var itemsToDelete = AdditionalRespondent
                            .Where(ar => !AdditionalRespondentDelete.Any(d => d.Name == ar.Name))
                            .ToList();

                        foreach (var item in itemsToDelete)
                        {
                            await _legalCaseService.DeleteAdditionalrespondent(item);

                            AdditionalRespondent.Remove(item);
                        }

                    }
                    if (AdditionalPetitioners.Count() != AdditionalPetitioners.Count())
                    {
                        var itemsToDelete = AdditionalPetitioners
                            .Where(ar => !AdditionalPetitionersDelete.Any(d => d.Name == ar.Name))
                            .ToList();

                        foreach (var item in itemsToDelete)
                        {
                            await _legalCaseService.DeleteAdditionalpetitioner(item);

                            AdditionalPetitioners.Remove(item);
                        }

                    }
                    if (Rows.Count > 0)
                    {
                        var addrows = Rows.Where(e => (e.Id == null || e.Id == Guid.Empty) && (e.Amount != null || e.Month != null)).Select(e => new ArrearLedgerDto()
                        {
                            LegalCaseId = legalcaseDto.Id,
                            CaseNoticeId =  null,
                            Notes = e.Notes,
                            Amount = e.Amount,
                            Month = e.Month,
                        }).ToList();
                        if (addrows.Any())
                        {
                            await _legalCaseService.AddArrearLedgerAsync(addrows);
                        }

                        var updaterows = Rows.Where(e => e.Id != null && e.Id != Guid.Empty).Select(e => new ArrearLedgerDto()
                        {
                            Id = e.Id,
                            LegalCaseId = legalcaseDto.Id,
                            CaseNoticeId = null,
                            Notes = e.Notes,
                            Amount = e.Amount,
                            Month = e.Month,
                        }).ToList();
                        if (updaterows.Any())
                        {
                            await _legalCaseService.UpdateArrearLedgerAsync(updaterows);
                        }
                    }

                    navmessage.Set("edit", true, "Case updated successfully.");
                    nav.NavigateTo($"/legalcase/details/{legalcaseDto.Id}");

                }
            }
            catch (Exception ex)
            {
                throw new Exception();

            }
        }
        @if (legalcaseDto.CaseTypeName == "HPD" || legalcaseDto.CaseTypeName == "Illegal Lockout")
        {
            try
            {
                spinnerservice.Show();
                var authState = await _authStateProvider.GetAuthenticationStateAsync();
                var user = authState.User;

                var userIdClaim = user.Claims.FirstOrDefault(c => c.Type == ClaimTypes.NameIdentifier)?.Value;

                if (!string.IsNullOrEmpty(userIdClaim) && Guid.TryParse(userIdClaim, out Guid userGuid))
                {
                    legalcaseDto.UpdatedBy = userGuid;
                    legalcaseDto.UpdatedOn = DateTime.Now;
                }
                else
                {
                    // unauthenticated user
                    legalcaseDto.UpdatedBy = Guid.Empty;
                    legalcaseDto.UpdatedOn = DateTime.Now;
                }
                // 1. Handle Client
                if (selectedClient == null)
                {
                    // create new client
                    var nameparts = legalcaseDto.ClientName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                    newClient = new CreateToClientDto()
                    {
                        FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                        LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                        Email = legalcaseDto.ClientEmail,
                        Phone = legalcaseDto.ClientPhone,
                        ClientTypeId = legalcaseDto.ClientTypeId,
                        CreatedBy = legalcaseDto.CreatedBy

                    };


                    var clientId = await _clientService.CreateOnlyClient(newClient);
                    legalcaseDto.ClientId = clientId;
                }
                else
                {
                    // check if changed -> update
                    if (selectedClient != null && HasClientChanged(selectedClient, legalcaseDto))
                    {
                        var nameparts = legalcaseDto.ClientName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                        var updateclient = new EditToClientDto
                        {
                            Id = legalcaseDto.ClientId ?? Guid.Empty,
                            FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                            LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                            Email = legalcaseDto.ClientEmail,
                            Phone = legalcaseDto.ClientPhone,
                            ClientTypeId = legalcaseDto.ClientTypeId,
                            Reference = legalcaseDto.Reference

                        };
                        await _clientService.UpdateClientformCase(updateclient);
                    }
                }

                // 2. Handle Landlord
                if (selectedlandlord == null)
                {
                    var nameparts = searchlandlordText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                    newLandlord = new CreateToLandLordDto()
                    {

                        FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                        LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,

                        ClientId = legalcaseDto.ClientId
                    };
                    var landlordId = await _landlordService.AddOnlyLandLordfromCase(newLandlord);
                    legalcaseDto.LandlordId = landlordId;
                }
                else
                {
                    if (selectedlandlord != null && HasLandlordChanged(selectedlandlord, legalcaseDto))
                    {

                        var nameparts = searchlandlordText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                        var updateLandLord = new EditToLandlordDto()
                        {
                            Id = legalcaseDto.LandlordId.Value,
                            FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                            LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                            Address1 = legalcaseDto.LandlordAddress,
                            ClientId = legalcaseDto.ClientId,
                            ContactPersonName = legalcaseDto.ContactPersonName
                        };
                        await _landlordService.UpdateLandLordsfromCase(updateLandLord);
                    }
                }

                // 2. Handle Building
                if (selectedbuilding == null)
                {
                    newBuilding = new CreateToBuildingDto()
                    {
                        Address1 = legalcaseDto.BuildingAddress,
                        BuildingUnits = legalcaseDto.Units,
                        PremiseTypeId = legalcaseDto.PremiseTypeId,
                        RegistrationStatusId = legalcaseDto.RegistrationStatusTypeId,

                        LandlordId = legalcaseDto.LandlordId
                    };

                    var buildingId = await _buildingService.AddOnlyApartmentfromCase(newBuilding);
                    legalcaseDto.BuildingId = buildingId;
                }
                else
                {
                    if (selectedbuilding != null && HasBuildingChanged(selectedbuilding, legalcaseDto))
                    {



                        var updateBuilding = new EditToBuildingDto()
                        {
                            Id = legalcaseDto.BuildingId.Value,
                            Address1 = legalcaseDto.BuildingAddress,
                            RegistrationStatusId = legalcaseDto.RegistrationStatusTypeId,
                            PremiseTypeId = legalcaseDto.PremiseTypeId,
                            CityId = legalcaseDto.BoroughorCityId,

                            BuildingUnits = legalcaseDto.Units,
                            ApartmentCode = legalcaseDto.ApartmentNumber,
                            MDRNumber = legalcaseDto.Mdr,
                            RegulationStatusId = legalcaseDto.RegulationStatusId,
                        };

                        await _buildingService.UpdateonlyBuildingfromCase(updateBuilding);

                    }
                }

                if (selectedtenant == null)
                {
                    var nameparts = searchTenantText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                    newTenant = new CreateToTenantDto()
                    {

                        FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                        LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                        BuildingId = legalcaseDto.BuildingId,
                    };
                    var tenantId = await _tenantService.AddOnlyTenantfromCase(newTenant);
                    legalcaseDto.TenantId = tenantId;
                }
                else
                {
                    if (selectedtenant != null && HasTenantChanged(selectedtenant, legalcaseDto))
                    {
                        var nameparts = searchlandlordText.Split(' ', StringSplitOptions.RemoveEmptyEntries);

                        var updateTenant = new EditToTenantDto()
                        {
                            Id = legalcaseDto.TenantId.Value,
                            FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                            LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,

                            BuildingId = legalcaseDto.BuildingId,



                        };
                        await _tenantService.UpdateTenantfromCase(updateTenant);
                    }
                }

                legalcaseDto.SelectedCaseTypeHPDIds = CaseTypeHPDList
                                                   .Where(x => x.IsSelected)
                                                   .Select(x => x.Id)
                                                   .ToList();
                legalcaseDto.SelectedHarassmentTypeIds = HarassmentTypesList
                  .Where(x => x.IsSelected)
                  .Select(x => x.Id)
                  .ToList();

                legalcaseDto.SelectedDefenseTypeIds = DefenseTypesList
              .Where(x => x.IsSelected)
              .Select(x => x.Id)
              .ToList();

                legalcaseDto.SelectedAppearanceTypeIds = AppearanceTypesList
            .Where(x => x.IsSelected)
            .Select(x => x.Id)
            .ToList();

                legalcaseDto.SelectedReliefPetitionerTypeIds = ReliefPetitionerTypesList
            .Where(x => x.IsSelected)
            .Select(x => x.Id)
            .ToList();

                legalcaseDto.SelectedReliefRespondentTypeIds = ReliefRespondentTypesList
                       .Where(x => x.IsSelected)
                       .Select(x => x.Id)
                       .ToList();



                if (legalcaseDto != null || legalcaseDto.Id == Guid.Empty)
                {


                    var result = await _legalCaseService.UpdateCaseAsync(legalcaseDto);

                    if (result != null)
                    {
                        navmessage.Set("edit", true, "Case updated successfully.");
                        nav.NavigateTo($"/legalcase/details/{legalcaseDto.Id}");
                    }


                }
            }
            catch (Exception ex)
            {
                throw new Exception();

            }
        }
        @if (legalcaseDto.CaseTypeName == "Per Diem")
        {
            try
            {
                spinnerservice.Show();
                var authState = await _authStateProvider.GetAuthenticationStateAsync();
                var user = authState.User;

                var userIdClaim = user.Claims.FirstOrDefault(c => c.Type == ClaimTypes.NameIdentifier)?.Value;

                if (!string.IsNullOrEmpty(userIdClaim) && Guid.TryParse(userIdClaim, out Guid userGuid))
                {
                    legalcaseDto.UpdatedBy = userGuid;
                    legalcaseDto.UpdatedOn = DateTime.Now;
                }
                else
                {
                    // unauthenticated user
                    legalcaseDto.UpdatedBy = Guid.Empty;
                    legalcaseDto.UpdatedOn = DateTime.Now;
                }
                // 1. Handle Client
                if (selectedClient == null)
                {
                    // create new client
                    var nameparts = legalcaseDto.ClientName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                    newClient = new CreateToClientDto()
                    {
                        FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                        LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                        Email = legalcaseDto.ClientEmail,
                        Phone = legalcaseDto.ClientPhone,
                        ClientTypeId = legalcaseDto.ClientTypeId,
                        CreatedBy = legalcaseDto.CreatedBy

                    };


                    var clientId = await _clientService.CreateOnlyClient(newClient);
                    legalcaseDto.ClientId = clientId;
                }
                else
                {
                    // check if changed -> update
                    if (selectedClient != null && HasClientChanged(selectedClient, legalcaseDto))
                    {
                        var nameparts = legalcaseDto.ClientName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                        var updateclient = new EditToClientDto
                        {
                            Id = legalcaseDto.ClientId ?? Guid.Empty,
                            FirstName = nameparts.Count() > 0 ? nameparts[0] : string.Empty,
                            LastName = nameparts.Count() > 1 ? nameparts[nameparts.Count() - 1] : string.Empty,
                            Email = legalcaseDto.ClientEmail,
                            Phone = legalcaseDto.ClientPhone,
                            ClientTypeId = legalcaseDto.ClientTypeId,
                            Reference = legalcaseDto.Reference

                        };
                        await _clientService.UpdateClientformCase(updateclient);
                    }
                }



                legalcaseDto.SelectedCaseTypePerDiemIds = CaseTypePerDiemList
                                                   .Where(x => x.IsSelected)
                                                   .Select(x => x.Id)
                                                   .ToList();
                legalcaseDto.SelectedDocumentInstructionPerDiemIds = DocumentInstructionPerDiemList
                  .Where(x => x.IsSelected)
                  .Select(x => x.Id)
                  .ToList();

                legalcaseDto.SelectedReportingRequirementPerDiemIds = ReportingRequirementPerDiemList
              .Where(x => x.IsSelected)
              .Select(x => x.Id)
              .ToList();

                legalcaseDto.SelectedAppearanceTypePerDiemIds = AppearanceTypesPerDiemList
            .Where(x => x.IsSelected)
            .Select(x => x.Id)
            .ToList();





                if (legalcaseDto != null || legalcaseDto.Id == Guid.Empty)
                {


                    var result = await _legalCaseService.UpdateCaseAsync(legalcaseDto);

                    if (result != null)
                    {
                        navmessage.Set("edit", true, "Case updated successfully.");
                        nav.NavigateTo($"/legalcase/details/{legalcaseDto.Id}");
                    }


                }
            }
            catch (Exception ex)
            {
                throw new Exception();

            }
        }


    }
    private bool HasTenantChanged(EditToTenantDto existing, IntakeModel current, string firstName, string lastName)
    {
        return existing.FirstName != firstName
            || existing.LastName != lastName
            || existing.UnitOrApartmentNumber != current.UnitOrApartmentNumber
            || existing.MonthlyRent != current.MonthlyRent
            || existing.TenantShare != current.TenantShare
            || existing.RentDueEachMonthOrWeekId != current.RentDueEachMonthOrWeekId
            || existing.TotalRentOwed != current.TotalOwed
            || existing.TenancyTypeId != current.TenancyTypeId
            || existing.SocialServices != current.SocialService;
    }

    private bool HasAdditionalTenantChanged(AddtionalTenantDto existing, string firstName, string lastName)
    {
        return existing.FirstName != firstName || existing.LastName != lastName;
    }

    private bool HasOccupantChanged(AdditionalOccupantDto existing, string newName)
    {
        return existing.Name != newName;
    }

    private bool HasClientChanged(EditToClientDto existing, IntakeModel dto)
    {
        return !dto.ClientName.Contains(existing.FirstName)
            || !dto.ClientName.Contains(existing.LastName!)
            || existing.Email != dto.ClientEmail
            || existing.Phone != dto.ClientPhone
            || existing.ClientTypeId != dto.ClientTypeId;
    }

    private bool HasLandlordChanged(EditToLandlordDto existing, IntakeModel dto)
    {
        return !dto.landlordName.Contains(existing.FirstName)
            || !dto.landlordName.Contains(existing.LastName!)
            || existing.Address1 != dto.LandlordAddress
            || existing.AttorneyOfRecord != dto.AttorneyOfRecord
            || existing.LawFirm != dto.LawFirm;
    }

    private bool HasBuildingChanged(EditToBuildingDto existing, IntakeModel dto)
    {
        return existing.CityId != dto.BoroughorCityId
            || !dto.BuildingAddress.Contains(existing.Address1)
            || existing.ApartmentCode != dto.ApartmentNumber
            || existing.MDRNumber != dto.Mdr
            || existing.RegulationStatusId != dto.RegulationStatusId
            || existing.BuildingUnits != dto.Units;
    }

    // Helper functions
    private int DiffYears(DateTime? from, DateTime? to)
    {
        if (!from.HasValue || !to.HasValue) return 0;
        return (int)((to.Value - from.Value).TotalDays / 365);
    }

    private void CalcNoticeDays()
    {
        if (CaseTypeList.FirstOrDefault(x => x.Id == legalcaseDto.CaseTypeId)?.Name == "Holdover")
        {
            if (legalcaseDto.DateTenantMoved != null && legalcaseDto.TenancyTypeId != null)
            {
                int length = 0;

                var type = TenancyTypeList
                    .Where(a => a.Id == legalcaseDto.TenancyTypeId)
                    .Select(e => e.Name?.ToLower())
                    .FirstOrDefault();

                // ✅ Special case tenancy types get fixed 10 days
                if (new[] { "squatter", "licensee", "referee" }.Contains(type))
                {
                    length = 10;
                }
                else
                {
                    // ✅ Otherwise calculate by years
                    var yrs = DiffYears(legalcaseDto.DateTenantMoved?.ToDateTime(TimeOnly.MinValue), DateTime.Today);

                    if (yrs < 1)
                        length = 30;
                    else if (yrs < 2)
                        length = 60;
                    else
                        length = 90;
                }

                legalcaseDto.CalculatedNoticeLength = length;

                // ✅ Set PredicateNotice text
                legalcaseDto.PredicateNotice = type switch
                {
                    "licensee" => "10 Days Notice - Tenant Of Record Vacated (Licensee)",
                    "referee" => "10 Days Notice - Referee Deed / Prior Owner",
                    "squatter" => "10 Days Notice - Squatter / Intruder",
                    "month-to-month" => $"{length} Days Notice - Month to Month",
                    _ => ""
                };
            }
        }
    }

    private int ParseDueDay(string str)
    {
        if (string.IsNullOrWhiteSpace(str)) return 1;
        if (int.TryParse(str, out var d)) return Math.Clamp(d, 1, 31);
        return 1;
    }

    private void CalcExpireAligned()
    {
        int dueDay = ParseDueDay(DateRentList.FirstOrDefault(x => x.Id == legalcaseDto.RentDueEachMonthOrWeekId)?.Name);
        int? days = legalcaseDto.CalculatedNoticeLength;
        var servedISO = ToDateTime(legalcaseDto.DateNoticeServed);

        if (!servedISO.HasValue || days == 0)
        {
            legalcaseDto.ExpirationDate = null; // use null for DateOnly?
            return;
        }

        var target = servedISO.Value.AddDays((double)days);
        DateOnly expiration;

        if (dueDay == 1)
        {
            // last day of month
            expiration = new DateOnly(target.Year, target.Month, DateTime.DaysInMonth(target.Year, target.Month));
        }
        else
        {
            expiration = new DateOnly(target.Year, target.Month, dueDay - 1);
        }

        legalcaseDto.ExpirationDate = expiration;
    }


    private string PickPredicateNotice(string tenancy)
    {
        return tenancy switch
        {
            "licensee" => "10 Days Notice - Tenant Of Record Vacated (Licensee)",
            "referee" => "10 Days Notice - Referee Deed / Prior Owner",
            "squatter" => "10 Days Notice - Squatter / Intruder",
            "month" => $"{legalcaseDto.CalculatedNoticeLength} Days Notice - Month to Month",
            _ => ""
        };
    }

    public class NoticeMergeModel
    {
        // --- Client ---
        // public string ClientName { get; set; }
        // public string ClientType { get; set; }
        // public string ClientEmail { get; set; }
        // public string ClientPhone { get; set; }
        // public string ClientRef { get; set; }

        // // --- Landlord ---
        // public string LandlordName { get; set; }
        // public string Contact { get; set; }
        // public string LandlordAddress { get; set; }
        // public string LandlordAttorney { get; set; }
        // public string LandlordLawFirm { get; set; }

        // // --- Building ---
        // public string Addr { get; set; }
        // public string Unit { get; set; }
        // public string Borough { get; set; }
        // public string MDR { get; set; }
        // public string Regulation { get; set; }

        // // --- Tenancy / Terms ---
        // public string Tenancy { get; set; }
        // public string Written { get; set; }
        // public string OralAgreement { get; set; }
        // public string CaseProgram { get; set; }
        // public string GoodCauseApplies { get; set; }
        // public DateTime? MovedIn { get; set; }
        // public DateTime? LeaseEnd { get; set; }

        // // --- Rent ---
        // public string RentDueDate { get; set; }
        // public double? MonthlyRent { get; set; }
        // public string TenantShare { get; set; }
        // public string SocialServices { get; set; }
        // public string LastPaid { get; set; }
        // public string TotalOwed { get; set; }

        // // --- Tenants ---
        // public List<string> Tenants { get; set; } = new();
        // public List<string> Undertenants { get; set; } = new();

        // // --- Case / Notice ---
        // public DateTime? Served { get; set; }
        // public int? Days { get; set; }
        // public DateOnly? Expire { get; set; }
        // public string Template { get; set; }
        // public string PredicateNotice { get; set; }
    }

    // public NoticeMergeModel BuildMerge(NoticeMergeModel model)
    // {
    //     var noticeServed = string.IsNullOrEmpty(model.Served) ? (DateTime?)null : DateTime.Parse(model.Served);
    //     var days = CalcNoticeDays(model.Tenancy, model.MovedIn);

    //     var dueDay = ParseDueDay(model.RentDueDate);
    //     model.Days = days;
    //     model.Expire = CalcExpireAligned(string.IsNullOrEmpty(model.Served) ? null : DateTime.Parse(model.Served), days, dueDay);
    //     model.Template = PickPredicateNotice(model.Tenancy);

    //     model.Tenants = model.Tenants.Where(t => !string.IsNullOrWhiteSpace(t)).ToList();
    //     model.Undertenants = model.Undertenants.Where(t => !string.IsNullOrWhiteSpace(t)).ToList();

    //     return model;
    // }

    private bool showClientTextbox = false;
    private EditToClientDto selectedClient;
    private string searchText;
    private CreateToClientDto newClient = new();
    private bool IsNewClient = false;
    private List<EditToClientDto> filteredClients = new();

    private bool IsNewLandlord = false;
    private EditToLandlordDto selectedlandlord;
    private string searchlandlordText;
    private CreateToLandLordDto newLandlord = new();
    private List<EditToLandlordDto> filteredLandlords = new();

    private bool IsNewBuilding = false;
    private EditToBuildingDto selectedbuilding;
    private CreateToBuildingDto newBuilding = new();
    private List<EditToBuildingDto> filteredBuildings = new();
    private string searchBuildingText;

    private bool IsNewTenant = false;
    private bool PrimaryResidence = false;
    private Guid? TenancytypeId = Guid.Empty;
    private EditToTenantDto selectedtenant;
    private List<EditToTenantDto> filteredTenant = new();
    private string searchTenantText;


    private async Task OnSearchLandlordInput(ChangeEventArgs e)
    {
        searchlandlordText = e.Value?.ToString() ?? "";
        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {

            await Task.Delay(300, _cts.Token);

            // Empty input → show all
            if (string.IsNullOrWhiteSpace(searchlandlordText))
            {
                await ShowAlllandlords();
                return;
            }

            // 3 letters se kam → show all
            if (searchlandlordText.Length < 3)
            {
                await ShowAlllandlords();
                return;
            }

            if (legalcaseDto.ClientId == null || legalcaseDto.ClientId == Guid.Empty)
            {
                filteredLandlords = new List<EditToLandlordDto>();
                return;
            }
            else
            {
                filteredLandlords = await _landlordService.SearchLandlordsAsync(
              searchlandlordText,
              legalcaseDto.ClientId.Value);

            }



        }
        catch (TaskCanceledException)
        {
            // Old task cancelled → ignore
        }

    }


    private async void saveLandLordName()
    {
        legalcaseDto.landlordName = searchlandlordText;
    }

    private async Task SelectLandlord(EditToLandlordDto landlord)
    {
        showLandlordfields = true;
        selectedlandlord = landlord;

        searchlandlordText = $"{landlord.FirstName} {landlord.LastName}";
        filteredLandlords.Clear();

        // Fill card
        legalcaseDto.LandlordId = landlord.Id;
        legalcaseDto.landlordName = $"{landlord.FirstName} {landlord.LastName}";
        legalcaseDto.ContactPersonName = landlord.ContactPersonName;
        legalcaseDto.LandlordAddress = landlord.Address1;




        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.ContactPersonName)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.LandlordAddress)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.LandlordId)));

        _editContext.NotifyValidationStateChanged();


    }

    private async void SelectLandlords()
    {
        showLandlordfields = true;
        searchlandlordText = null;
        selectedlandlord = null;
        legalcaseDto.LandlordId = null;
        legalcaseDto.landlordName = searchlandlordText;
        legalcaseDto.ContactPersonName = null;
        legalcaseDto.LandlordAddress = null;
        legalcaseDto.AttorneyOfRecord = null;
        legalcaseDto.LawFirm = null;


    }
    private async void AddClient()
    {
        showClientTextbox = true;
        searchText = null;
        selectedClient = null;
        legalcaseDto.ClientId = Guid.Empty;
        legalcaseDto.ClientName = searchText;
        legalcaseDto.ClientTypeId = null;
        legalcaseDto.Email = null;
        legalcaseDto.Phone = null;
        legalcaseDto.Reference = null;
    }


    private async void CancelLandlords()
    {
        showLandlordfields = false;
        showTenantfields = false;
        searchlandlordText = null;
        selectedlandlord = null;
        legalcaseDto.LandlordId = null;
        legalcaseDto.landlordName = searchlandlordText;
        legalcaseDto.ContactPersonName = null;
        legalcaseDto.LandlordAddress = null;
        legalcaseDto.AttorneyOfRecord = null;
        legalcaseDto.LawFirm = null;

        legalcaseDto.BuildingAddress = null;
        legalcaseDto.BuildingId = null;
        legalcaseDto.Mdr = null;
        legalcaseDto.Borough = null;
        legalcaseDto.Units = null;
        legalcaseDto.RegulationStatusId = null;
        legalcaseDto.StateId = null;
        legalcaseDto.ZipCode = null;
        isBuildingSelected = false;
        IsNewBuilding = false;
        showBuildingfields = false;
        searchBuildingText = null;


        searchTenantText = null;
        legalcaseDto.UnitOrApartmentNumber = null;
        legalcaseDto.TenantName = null;
        AdditionalPetitioners.Clear();
        AdditionalPetitionersDelete.Clear();
        AdditionalRespondent.Clear();
        AdditionalRespondentDelete.Clear();
        Tenants.Clear();
        legalcaseDto.TenantId = null;



        StateHasChanged();



    }

    private void ClearSelectedLandlord()
    {
        selectedlandlord = null;
        searchlandlordText = string.Empty;
    }
    private async Task OnSearchBuildingInput(ChangeEventArgs e)
    {
        searchBuildingText = e.Value.ToString();
        _cts?.Cancel();
        _cts = new CancellationTokenSource();
        // ⭐ Empty — show all landlords
        try
        {

            await Task.Delay(300, _cts.Token);
            if (string.IsNullOrWhiteSpace(searchBuildingText))
            {
                await ShowAllBuildings();
                return;
            }

            // ⭐ Jab tak 3 characters nahi — show all landlords
            if (searchBuildingText.Length < 3)
            {
                await ShowAllBuildings();
                return;
            }

            if (legalcaseDto.LandlordId == null || legalcaseDto.LandlordId == Guid.Empty)
            {
                filteredBuildings = new List<EditToBuildingDto>();
                return;
            }
            else
            {
                // ⭐ 3 characters → server search
                filteredBuildings = await _buildingService.SearchBuilding(
                    searchBuildingText,
                    legalcaseDto.LandlordId.Value
                );
            }


        }
        catch (TaskCanceledException)
        {
            // Old task cancelled → ignore
        }
    }
    private async Task SelectedOwnerOccupied()
    {
        if (legalcaseDto.OwnerOccupied == true)
        {
            legalcaseDto.RegistrationStatusTypeId = RegistrationstatusList.Where(e => e.Name.Equals("Registered")).FirstOrDefault().Id;
        }
    }
    private async Task OnSearchTenantInput(ChangeEventArgs e)
    {
        searchTenantText = e.Value?.ToString() ?? "";
        _cts?.Cancel();
        _cts = new CancellationTokenSource();
        try
        {

            await Task.Delay(300, _cts.Token);
            // ⭐ Empty input → load all tenants (ONLY here)
            if (string.IsNullOrWhiteSpace(searchTenantText))
            {
                await ShowAllTenantForHoldover();
                return;
            }

            // ⭐ 1st & 2nd character → DO NOTHING (keep list unchanged)
            if (searchTenantText.Length < 3)
            {
                // ❗ No reload here (important)
                return;
            }
            if (legalcaseDto.BuildingId == null || legalcaseDto.BuildingId == Guid.Empty)
            {
                filteredTenant = new List<EditToTenantDto>();
                return;
            }
            else
            {
                // ⭐ 3+ characters → server search
                filteredTenant = await _tenantService.SearchTenantsAsync(
                    searchTenantText,
                    legalcaseDto.BuildingId.Value);
            }




        }
        catch (TaskCanceledException)
        {
            // Old task cancelled → ignore
        }

    }

    private async Task ShowAllBuildings()
    {
        if (legalcaseDto.LandlordId == null || legalcaseDto.LandlordId == Guid.Empty)
        {
            filteredBuildings = new List<EditToBuildingDto>();
            return;
        }
        else
        {

            filteredBuildings = await _buildingService.GetBuildingsByLandlordIdAsync(legalcaseDto.LandlordId.Value);
        }

    }

    private void SelectTenant()
    {
        legalcaseDto.ApartmentNumber = searchTenantText;
    }
    private async Task SelectBuilding(EditToBuildingDto building)
    {
        isBuildingSelected = true;
        showBuildingfields = true;
        selectedbuilding = building;
        searchBuildingText = building.BuildingCode;
        filteredBuildings.Clear();

        // Fill card
        legalcaseDto.BuildingId = building.Id;
        legalcaseDto.BuildingAddress = building.Address1;
        legalcaseDto.Units = building.BuildingUnits;
        legalcaseDto.UnitOrApartmentNumber = building.ApartmentCode;
        legalcaseDto.BoroughorCityId = building.CityId;
        legalcaseDto.Mdr = building.MDRNumber;
        legalcaseDto.RegulationStatusId = building.RegulationStatusId;
        legalcaseDto.BuildingTypeId = building.BuildingTypeId;
        legalcaseDto.RegistrationStatusTypeId = building.RegistrationStatusId;
        legalcaseDto.ExemptionBasisId = building.ExemptionBasisId;
        legalcaseDto.ExemptionReasonId = building.ExemptionreasonId;
        // legalcaseDto.PrimaryResidence = building.PrimaryResidence;
        legalcaseDto.GoodCause = building.GoodCause != null ? building.GoodCause.Value : false;
        legalcaseDto.OwnerOccupied = building.OwnerOccupied != null ? building.OwnerOccupied.Value : false;
        legalcaseDto.ExemptionBasisOther = building.ExemptionBasisother;
        legalcaseDto.RentRegulationOther = building.RentRegulationOther;


        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.BuildingAddress)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.Mdr)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.Borough)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.Units)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.PremiseTypeId)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.RegulationStatusId)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.RegistrationStatusTypeId)));

        _editContext.NotifyValidationStateChanged();


    }


    private async void SelectedTenant(EditToTenantDto tenant)
    {

        selectedtenant = tenant;
        Tenants.Clear();
        foreach (var item in AdditionalTenantList)
        {
            item.IsDeleted = true;
        }
        Tenants.Add($"{tenant.FirstName} {tenant.LastName}");



        searchTenantText = $"{tenant.UnitOrApartmentNumber}";

        legalcaseDto.UnitOrApartmentNumber = tenant.UnitOrApartmentNumber;
        legalcaseDto.TenantName = tenant.FirstName + " " + tenant.LastName;
        legalcaseDto.TenantId = tenant.Id;
        legalcaseDto.PrimaryResidence = tenant.PrimaryResidence;
        legalcaseDto.TenancyTypeId = tenant.TenancyTypeId;
        legalcaseDto.MonthlyRent = tenant.MonthlyRent;
        legalcaseDto.RentDueEachMonthOrWeekId = tenant.RentDueEachMonthOrWeekId;
        legalcaseDto.TenantShare = tenant.TenantShare;

        AdditionalTenantfromDbList = await _additionalTenant.GetAllAdditionalTenantsAsync(legalcaseDto.TenantId);
        if (AdditionalTenantfromDbList.Count > 0)
        {
            Tenants.AddRange(AdditionalTenantfromDbList.Select(e => $"{e.FirstName} {e.LastName}").ToList());
            AdditionalTenantList.AddRange(AdditionalTenantfromDbList.Select(e => new AddtionalTenantDto
            {
                FirstName = e.FirstName,
                LastName = e.LastName,
                TenantId = e.TenantId,
                Id = e.Id,
            }));
        }
        filteredTenant?.Clear();


        StateHasChanged();


    }


    private void OnBindBuldingCancel()
    {
        isBuildingSelected = false;
        showBuildingfields = false;
        selectedbuilding = null;
        selectedtenant = null;
        searchBuildingText = null;
        searchTenantText = null;
        IsNewBuilding = false;
        // Fill card
        legalcaseDto.BuildingId = null;
        legalcaseDto.BuildingAddress = null;
        legalcaseDto.Units = null;

        legalcaseDto.City = null;
        legalcaseDto.Mdr = null;
        legalcaseDto.RegulationStatusId = null;

        TenantList = new();
        Tenants = new();

        legalcaseDto.ApartmentNumber = null;
        legalcaseDto.TenantName = null;
        legalcaseDto.UnitNumber = null;
        legalcaseDto.IsUnitIllegalId = null;


        legalcaseDto.TenantRecord = null;
        legalcaseDto.HasPossession = null;
        legalcaseDto.UnitNumber = null;
        legalcaseDto.IsUnitIllegalId = null;
        legalcaseDto.DateTenantMoved = null;
        legalcaseDto.MonthlyRent = null;
        legalcaseDto.TenantShare = null;
        legalcaseDto.RentDueEachMonthOrWeekId = null;
        legalcaseDto.TotalOwed = null;
        legalcaseDto.TenancyTypeId = null;
        legalcaseDto.SocialService = null;

        searchTenantText = null;
        legalcaseDto.UnitOrApartmentNumber = null;
        legalcaseDto.TenantName = null;
        Tenants.Clear();
        legalcaseDto.TenantId = null;
        legalcaseDto.BuildingStateId = StateList.Where(e => e.Name.Contains("New York")).FirstOrDefault().Id;


    }
    private void OnBindBuldingAfter()
    {
        showBuildingfields = true;
        selectedbuilding = null;
        searchBuildingText = null;
        IsNewBuilding = true;
        // Fill card
        legalcaseDto.BuildingId = null;
        legalcaseDto.BuildingAddress = null;
        legalcaseDto.Units = null;
        legalcaseDto.UnitOrApartmentNumber = null;
        legalcaseDto.City = null;
        legalcaseDto.Mdr = null;
        legalcaseDto.RegulationStatusId = null;
        legalcaseDto.StateId = null;
        legalcaseDto.ZipCode = null;
        legalcaseDto.BuildingStateId = StateList.Where(e => e.Name.Contains("New York")).FirstOrDefault().Id;
        legalcaseDto.PremiseTypeId = null;
        legalcaseDto.RegistrationStatusTypeId = null;
        legalcaseDto.ExemptionReasonId = null;
        legalcaseDto.ExemptionBasisId = null;
        legalcaseDto.TenancyTypeForBuildingId = null;
        legalcaseDto.PrimaryResidence = false;
        legalcaseDto.GoodCause = false;
        legalcaseDto.OwnerOccupied = false;
        TenantList = new();
        Tenants = new();


        legalcaseDto.TenantName = null;
        legalcaseDto.UnitNumber = null;
        legalcaseDto.IsUnitIllegalId = null;
        legalcaseDto.TenantName = null;
        legalcaseDto.TenantId = null;
        legalcaseDto.TenantRecord = null;
        legalcaseDto.HasPossession = null;
        legalcaseDto.UnitNumber = null;
        legalcaseDto.IsUnitIllegalId = null;
        legalcaseDto.DateTenantMoved = null;
        legalcaseDto.MonthlyRent = null;
        legalcaseDto.TenantShare = null;
        legalcaseDto.RentDueEachMonthOrWeekId = null;
        legalcaseDto.TotalOwed = null;
        legalcaseDto.TenancyTypeId = null;
        legalcaseDto.SocialService = null;


    }


    // private void OnSearchTenantInput(ChangeEventArgs e)
    // {
    //     searchlandlordText = e.Value.ToString();
    //     Tenants = TenantList
    //         .Where(c => c.UnitOrApartmentNumber.Contains(legalcaseDto.UnitOrApartmentNumber, StringComparison.OrdinalIgnoreCase)
    //                     // || c.LastName.Contains(searchlandlordText, StringComparison.OrdinalIgnoreCase)
    //                     // || c.LandLordCode.Contains(searchlandlordText, StringComparison.OrdinalIgnoreCase)
    //                     )
    //         .Select(e => e.FirstName).ToList();
    // }

    // private async void SelectTenant(EditToTenantDto Tenant)
    // {
    // 	selectedTenant = landlord;
    // 	searchlandlordText = $"{landlord.FirstName} {landlord.LastName}";
    // 	filteredLandlords.Clear();

    // 	// Fill card
    // 	legalcaseDto.LandlordId = landlord.Id;
    // 	legalcaseDto.landlordName = $"{landlord.FirstName} {landlord.LastName}";
    // 	legalcaseDto.ContactPersonName = landlord.ContactPersonName;
    // 	legalcaseDto.LandlordAddress = landlord.Address1;
    // 	legalcaseDto.AttorneyOfRecord = landlord.AttorneyOfRecord;
    // 	legalcaseDto.LawFirm = landlord.LawFirm;

    // 	BuildingList = await _buildingService.GetBuildingsByLandlordIdAsync(landlord.Id);


    // }

    private async Task OnSearchInput(ChangeEventArgs e)
    {
        searchText = e.Value?.ToString() ?? "";

        // Agar koi old search chal rahi hai → cancel karo
        _cts?.Cancel();
        _cts = new CancellationTokenSource();

        try
        {

            await Task.Delay(300, _cts.Token);

            // Empty input → show all
            if (string.IsNullOrWhiteSpace(searchText))
            {
                await ShowAllClients();
                return;
            }

            // 3 letters se kam → show all
            if (searchText.Length < 3)
            {

                await ShowAllClients();
                return;
            }

            // Ab server search
            filteredClients = await _clientService.SearchClient(searchText);
        }
        catch (TaskCanceledException)
        {
            // Old task cancelled → ignore
        }
    }

    private void InputboxClientBlur()
    {
        filteredClients = null;
    }
    private void LandlordInputBlur()
    {
        filteredLandlords = null;
    }
    private void TanentInputBlur()
    {
        filteredTenant = null;
    }
    private void BuildingInputBlur()
    {
        filteredBuildings = null;
    }

    private void OnBindClientAfter()
    {
        if (filteredClients.Count <= 0)
        {
            selectedClient = null;
            showClientTextbox = true;

            legalcaseDto.ClientId = null;
            legalcaseDto.ClientName = null;
            legalcaseDto.ClientEmail = null;
            legalcaseDto.ClientPhone = null;
            legalcaseDto.Address1 = null;
            legalcaseDto.Address2 = null;
            legalcaseDto.City = null;
            legalcaseDto.StateId = null;
            legalcaseDto.ZipCode = null;
        }

    }





    private async void SelectClient(EditToClientDto client)
    {
        showClientTextbox = true;
        selectedClient = client;
        searchText = $"{client.FirstName} {client.LastName}";
        filteredClients.Clear();

        // Fill card
        legalcaseDto.ClientId = client.Id;
        legalcaseDto.ClientName = $"{client.FirstName} {client.LastName}";
        legalcaseDto.ClientEmail = client.Email;
        legalcaseDto.ClientPhone = client.Phone;
        legalcaseDto.Address1 = client.Address1;
        legalcaseDto.Address2 = client.Address2;
        legalcaseDto.City = client.City;
        legalcaseDto.StateId = client.StateId;
        legalcaseDto.ZipCode = client.ZipCode;
        legalcaseDto.ClientTypeId = client.ClientTypeId;
        legalcaseDto.Reference = client.Reference;

        showClientTextbox = false;

        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.ClientId)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.ClientName)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.ClientTypeId)));
        messageStore.Clear(new FieldIdentifier(legalcaseDto, nameof(legalcaseDto.ClientEmail)));
        _editContext.NotifyValidationStateChanged();



    }




    private void ClearSelectedClient()
    {
        selectedClient = null;
        searchText = string.Empty;


        showClientTextbox = false;
        IsNewClient = false;
        searchText = null;
        selectedClient = null;
        legalcaseDto.ClientId = null;
        legalcaseDto.ClientName = searchText;
        legalcaseDto.ClientTypeId = null;
        legalcaseDto.ClientEmail = null;
        legalcaseDto.ClientPhone = null;
        legalcaseDto.Reference = null;
        legalcaseDto.Address1 = null;
        legalcaseDto.landlordName = null;
        legalcaseDto.LandlordId = null;
        legalcaseDto.ContactPersonName = null;
        legalcaseDto.LandlordAddress = null;
        selectedlandlord = null;
        showLandlordfields = false;
        searchlandlordText = null;

        // for building
        legalcaseDto.BuildingAddress = null;
        legalcaseDto.BuildingId = null;
        legalcaseDto.Mdr = null;
        legalcaseDto.Borough = null;
        legalcaseDto.Units = null;
        legalcaseDto.RegulationStatusId = null;
        legalcaseDto.StateId = null;
        legalcaseDto.ZipCode = null;
        isBuildingSelected = false;
        IsNewBuilding = false;
        showBuildingfields = false;
        searchBuildingText = null;

        // for Tenant
        searchTenantText = null;
        legalcaseDto.UnitOrApartmentNumber = null;
        legalcaseDto.TenantName = null;
        Tenants.Clear();
        legalcaseDto.TenantId = null;
        legalcaseDto.AttorneyOfRecord = null;
        // legalcaseDto.AttrneyEmail = null;
        // legalcaseDto.AttrneyContactInfo = null;
        // legalcaseDto.Attrney = null;

        // legalcaseDto.CourtLocationId = null;
        legalcaseDto.CourtPart = null;
        searchCourtText = null;
        // searchCountyText = null;


        StateHasChanged();
    }





    public class InputSelectNullableBool : InputSelect<bool?>
    {
        protected override bool TryParseValueFromString(string value, out bool? result, out string validationErrorMessage)
        {
            if (string.IsNullOrEmpty(value))
            {
                result = null;
                validationErrorMessage = null;
                return true;
            }

            if (bool.TryParse(value, out var parsed))
            {
                result = parsed;
                validationErrorMessage = null;
                return true;
            }

            result = null;
            validationErrorMessage = "Invalid selection.";
            return false;
        }
    }
    void OnPartyRepresentChanged(Guid id)
    {
        legalcaseDto.PartyRepresentId = id;

    }

    void OnBuildingTypeChanged(Guid id)
    {
        legalcaseDto.BuildingTypeId = id;
    }
    void OnRegistrationStatusChanged(Guid id)
    {
        legalcaseDto.RegistrationStatusTypeId = id;
    }

    void OnBilingTypeHpdChanged(Guid id)
    {
        legalcaseDto.BilingTypeId = id;
    }

    private async Task ShowAllTenantForHoldover()
    {
        if (legalcaseDto.BuildingId == null || legalcaseDto.BuildingId == Guid.Empty)
        {
            filteredTenant = new List<EditToTenantDto>();
            return;
        }
        else
        {
            filteredTenant = await _tenantService.GetTenantsByBuildingIdAsync(legalcaseDto.BuildingId.Value);

        }
    }

    private async Task ShowAllClients()
    {
        filteredClients = await _clientService.GetAllClient(loggedInUserId, isAdmin);
    }

    private async Task ShowAllCounty()
    {
        filteredCounties = await _countyService.GetAllCounty();
    }

    private async Task ShowAllCourts()
    {
        if (legalcaseDto.CountyId != null)
        {
            // Sirf selected county ke courts dikhao
            filteredCourts = CourtLocationList
                                .Where(x => x.CountyId == legalcaseDto.CountyId)
                                .ToList();
        }
        else
        {

            filteredCourts = await _courtService.GetAllCourtDataAsync();
        }

    }

    private void SelectCounty()
    {

        if (legalcaseDto.CountyId != null && legalcaseDto.CountyId != Guid.Empty)
        {
            filteredCourts = CourtLocationList.Where(x => x.CountyId == legalcaseDto.CountyId)
                                .ToList();
        }

        StateHasChanged();
    }

    private async Task SelectCourt()
    {
        var selectedCourtId = legalcaseDto.CourtLocationId;

        var court = CourtLocationList.Where(ct => ct.Id == legalcaseDto.CourtLocationId).FirstOrDefault();
        var Courttype = CourtTypeList.Where(cts => cts.Name.Contains(court.CountyName)).FirstOrDefault();
        if (Courttype == null)
        {
            Courttype = CourtTypeList.Where(cts => cts.Name.Contains("NYC")).FirstOrDefault();
        }
        if (court.CourtPart.Any())
        {
            showCourtPartDropdown = true;
            CourtPartList = court.CourtPart.ToList();
        }




        if ((legalcaseDto.CourtTypeId == null || legalcaseDto.CourtTypeId == Guid.Empty) && legalcaseDto.CourtTypeId != Courttype.Id)
        {

            var CourtType = new CourtType();
            var query = CourtTypeList.ToList();
            if (court.CountyName.Contains("Nassau") || court.CountyName.Contains("Westchester"))
            {
                CourtType = query.Where(x => x.Name.Contains(legalcaseDto.County))
                                  .FirstOrDefault();
            }
            else
            {
                showCountyDropdown = true;
                CourtType = query.Where(x => !x.Name.Contains("Nassau") && !x.Name.Contains("Westchester"))
                                    .FirstOrDefault();
            }
            legalcaseDto.CourtTypeId = CourtType.Id;
            await SelectCourtType();
        }

        if ((legalcaseDto.CountyId == null || legalcaseDto.CountyId == Guid.Empty) && legalcaseDto.CountyId != court.CountyId)
        {
            var county = CountyList.FirstOrDefault(cts => cts.Id == court.CountyId);
            // if (court.CountyName.Contains("Nassau") || court.CountyName.Contains("Westchester"))
            // {
            legalcaseDto.CountyId = county.Id;
            legalcaseDto.County = county?.Name;

            // }
            SelectCounty();
        }

        await InvokeAsync(StateHasChanged);
        legalcaseDto.CourtLocationId = null;
        await Task.Delay(10);

        if (filteredCourts.Any(x => x.Id == selectedCourtId))
        {
            legalcaseDto.CourtLocationId = selectedCourtId;
        }
        else
        {
            // Optional: clear the selection if invalid
            legalcaseDto.CourtLocationId = Guid.Empty;
        }

        StateHasChanged();
    }

    private async Task ShowAlllandlords()
    {
        if (legalcaseDto.ClientId == null || legalcaseDto.ClientId == Guid.Empty)
        {
            filteredLandlords = new List<EditToLandlordDto>();
            return;
        }
        else
        {

            filteredLandlords = await _landlordService.GetLandlordsByClientIdAsync(legalcaseDto.ClientId);
        }
    }

    private async Task SelectLandlordhpd(EditToLandlordDto landlord)
    {
        showLandlordfields = true;
        selectedlandlord = landlord;

        searchlandlordText = $"{landlord.FirstName} {landlord.LastName}";
        filteredLandlords.Clear();

        // Fill card
        legalcaseDto.LandlordId = landlord.Id;
        legalcaseDto.landlordName = $"{landlord.FirstName} {landlord.LastName}";

        var respondents = await _legalCaseService.GetAdditionalrespondent(landlord.Id);
        if (respondents != null)
        {
            foreach (var r in respondents)
            {
                // Check for existing entry by Id (or any unique field)
                if (!AdditionalRespondent.Any(x => x.Id == r.Id))
                {
                    AdditionalRespondent.Add(r);
                }
            }
        }
        // ⭐ Load tenants for this landlord
        var tenants = await _tenantService.GetTenantsByLandlordIdAsync(landlord.Id);

        if (tenants.Any())
        {
            filteredTenant = tenants;
            tenantLoadedFromLandlord = true;

        }
        else
        {
            filteredTenant = new List<EditToTenantDto>();
            tenantLoadedFromLandlord = false;
        }

        // Tenant search input hamesha empty rakho
        searchTenantText = "";

        // Tenant select reset
        legalcaseDto.TenantId = null;
        legalcaseDto.TenantName = "";

        StateHasChanged();
    }


    private bool HasTenantChanged(EditToTenantDto existing, IntakeModel dto)
    {
        return !dto.TenantName.Contains(existing.FirstName)
            || !dto.TenantName.Contains(existing.LastName!);

    }

    // private enum Step { Landlord = 0, Building = 1, Tenant = 2, Rent = 3, Case = 4, Review = 5 }
}
