@page "/realestate/search"


<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EvictionFiler — Real Estate Case Envelope (Responsive)</title>
    <style>
        :root {
            --bg: #f6f7fb;
            --card: #fff;
            --ink: #0f172a;
            --muted: #6b7280;
            --line: #e5e7eb;
            --chip: #eef2ff
        }

        html, body {
            margin: 0;
            background: var(--bg);
            color: var(--ink);
            font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
        }

        .wrap {
            max-width: 1200px;
            margin: 24px auto;
            padding: 0 16px
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
            flex-wrap: wrap
        }

        .title {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap
        }

        .pill {
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid var(--line);
            background: #eef2ff;
            color: #3730a3;
            font-size: 12px
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(4,1fr);
            gap: 12px;
            margin: 12px 0
        }

        .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 14px
        }

            .card h4 {
                margin: 0 0 8px 0;
                font-size: 14px;
                color: #334155
            }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px
        }

        .kv {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px
        }

        .meta {
            color: var(--muted);
            font-size: 12px
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin: 8px 0 12px;
            flex-wrap: wrap
        }

            .tabs button {
                padding: 8px 12px;
                border-radius: 10px;
                border: 1px solid var(--line);
                background: #fff;
                font-weight: 700;
                color: #334155
            }

            .tabs .active {
                background: #0ea5e9;
                color: #07263a;
                border-color: #7dd3fc
            }

        table {
            width: 100%;
            border-collapse: collapse
        }

        th, td {
            padding: 10px;
            border-bottom: 1px solid var(--line);
            text-align: left;
            font-size: 14px;
            white-space: nowrap
        }

        th {
            color: #475569
        }

        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        .btn {
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--line);
            background: #fff;
            font-weight: 800;
            text-decoration: none;
            color: #0f172a
        }

            .btn.primary {
                background: #111827;
                color: #fff;
                border-color: #111827
            }

        .footer {
            margin: 18px 0;
            color: #94a3b8;
            font-size: 12px;
            text-align: center
        }

        .scroll {
            overflow: auto;
            -webkit-overflow-scrolling: touch
        }
        @@media (max-width: 1024px) {
            .cards

        {
            grid-template-columns: repeat(2,1fr)
        }

        .row {
            grid-template-columns: 1fr
        }

        }
        @@media (max-width: 640px) {
            .cards

        {
            grid-template-columns: 1fr
        }

        }
    </style>
    <script>window.EF_API_BASE = "/api";</script>
    <script type="module" src="real_estate_api.js"></script>
</head>
<body>
    <div class="wrap">
        <div class="header">
            <div class="title">
                <h2 style="margin:0;font-size:18px">Case RE00001234 — Real Estate</h2>
                <span class="pill">Active</span><span class="pill">Closing</span><span class="pill">Kings</span>
            </div>
            <a class="btn primary" href="/realestate">Back to Dashboard</a>
        </div>

        <div class="cards">
            <div class="card"><h4>Deal Value</h4><div style="font-weight:900;font-size:22px">$1,250,000</div><div class="meta">Condo • 1 Plaza #15D</div></div>
            <div class="card"><h4>Days Open</h4><div style="font-weight:900;font-size:22px">42</div><div class="meta">Opened 08/20/2025</div></div>
            <div class="card"><h4>Progress</h4><div style="height:10px;background:#f1f5f9;border-radius:999px;border:1px solid var(--line);overflow:hidden"><div style="width:45%;height:10px;background:#06b6d4"></div></div><div class="meta" style="margin-top:6px">45% complete</div></div>
            <div class="card"><h4>Trust Balance</h4><div style="font-weight:900;font-size:22px">$6,800</div><div class="meta">Open receivables: $1,200</div></div>
        </div>

        <div class="row">
            <div class="card">
                <h4>Parties & Property</h4>
                <div class="kv">
                    <div>
                        <div class="meta">Seller</div><div>ABC Holdings LLC</div>
                        <div class="meta" style="margin-top:8px">Buyer</div><div>John & Jane Smith</div>
                        <div class="meta" style="margin-top:8px">Attorneys</div><div>Green Law / Blue & Co.</div>
                    </div>
                    <div>
                        <div class="meta">Property</div><div>1 Plaza #15D, Brooklyn 11201</div>
                        <div class="meta" style="margin-top:8px">BBL</div><div>3001-45-1234</div>
                        <div class="meta" style="margin-top:8px">Board/Managing Agent</div><div>Plaza Condo / Gotham Mgmt</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h4>Court / Agency Info</h4>
                <div class="kv">
                    <div>
                        <div class="meta">Venue</div><div>Kings Supreme (if litigated)</div>
                        <div class="meta" style="margin-top:8px">Index #</div><div>—</div>
                        <div class="meta" style="margin-top:8px">Judge/Part</div><div>—</div>
                    </div>
                    <div>
                        <div class="meta">DOB/BSA</div><div>Open permits: 1 • Violations: 0</div>
                        <div class="meta" style="margin-top:8px">HPD/DHCR</div><div>RS status: N/A • DHCR: —</div>
                        <div class="meta" style="margin-top:8px">Title</div><div>First Am. Title • Order # T-7788</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="active" onclick="sel(0)">Activity</button>
            <button onclick="sel(1)">Timeline</button>
            <button onclick="sel(2)">Documents</button>
            <button onclick="sel(3)">Actions</button>
        </div>

        <div id="t0" class="card scroll">
            <h4>Recent Activity</h4>
            <table>
                <thead><tr><th>When</th><th>User</th><th>Event</th><th>Link</th></tr></thead>
                <tbody>
                    <tr><td>Today 10:40a</td><td>Paralegal S. Patel</td><td>Received clean title — ready for closing</td><td><a href="#" class="btn">Open</a></td></tr>
                    <tr><td>Yesterday</td><td>Atty. Green</td><td>Approved RS lease terms — 123 Example Ave 4B</td><td><a href="#" class="btn">Open</a></td></tr>
                    <tr><td>Mon</td><td>Intake Bot</td><td>Generated Condo Contract of Sale</td><td><a href="#" class="btn">Open</a></td></tr>
                </tbody>
            </table>
        </div>

        <div id="t1" class="card scroll" style="display:none">
            <h4>Timeline</h4>
            <table>
                <thead><tr><th>Due</th><th>Task</th><th>Status</th></tr></thead>
                <tbody>
                    <tr><td>10/05</td><td>Mortgage Commitment Deadline</td><td><span class="pill">Open</span></td></tr>
                    <tr><td>10/07</td><td>Finalize Title Clearance</td><td><span class="pill">Open</span></td></tr>
                    <tr><td>10/09</td><td>Schedule Closing</td><td><span class="pill">At Risk</span></td></tr>
                </tbody>
            </table>
        </div>

        <div id="t2" class="card scroll" style="display:none">
            <h4>Documents</h4>
            <table>
                <thead><tr><th>Type</th><th>Name</th><th>Status</th><th>Action</th></tr></thead>
                <tbody>
                    <tr><td>Contract</td><td>Condo Contract of Sale</td><td>Signed</td><td><a class="btn" href="#">View</a></td></tr>
                    <tr><td>Rider</td><td>Smoke-Free / Pets / Access</td><td>Draft</td><td><a class="btn" href="#">Edit</a></td></tr>
                    <tr><td>Lease (RS)</td><td>DHCR Rider RTP-8</td><td>Ready to stamp</td><td><a class="btn" href="#">Generate</a></td></tr>
                </tbody>
            </table>
        </div>

        <div id="t3" class="card" style="display:none">
            <h4>Actions</h4>
            <div class="actions">
                <a class="btn primary" href="contracts_leases_wizard.html" target="_blank">Draft Contract / Lease</a>
                <a class="btn" href="service_picker.html" target="_blank">Add Billing Line</a>
                <a class="btn" href="#" onclick="alert('Order title')">Order Title</a>
                <a class="btn" href="#" onclick="alert('Generate RS Lease Package')">Generate RS Lease Package</a>
                <a class="btn" href="#" onclick="alert('Import NYSCEF email')">Import NYSCEF Email</a>
                <a class="btn" href="#" onclick="alert('Create Motion (Supreme)')">Create Motion (Supreme)</a>
            </div>
        </div>

        <div class="footer">© EvictionFiler — Real Estate Case Envelope (Responsive Demo)</div>
    </div>

    <script>
        function sel(i){
          ['t0','t1','t2','t3'].forEach((id,idx)=> document.getElementById(id).style.display = (i===idx)?'':'none');
          document.querySelectorAll('.tabs button').forEach((b,idx)=> b.classList.toggle('active', idx===i));
        }
    </script>
    <script type="module">

        import { getCaseEnvelope, getCaseDocs, getCaseTimeline, postCaseAction } from './real_estate_api.js';

        const CASE_ID = new URLSearchParams(location.search).get('id') || 'RE00001234';

        async function hydrateEnvelope(){
          try{
            const env = await getCaseEnvelope(CASE_ID);
            // Top pills / title
            document.querySelector('.title h2').textContent = `Case ${env.case_id || CASE_ID} — ${env.practice || 'Real Estate'}`;
            const pills = document.querySelectorAll('.title .pill');
            if(pills.length>=3){
              pills[0].textContent = env.status || 'Active';
              pills[1].textContent = env.type || 'Closing';
              pills[2].textContent = env.venue_short || env.county || '—';
            }
            // Cards
            const cards = document.querySelectorAll('.cards .card');
            if(env.deal_value) cards[0].querySelector('div:nth-child(2)').textContent = env.deal_value_formatted || env.deal_value;
            if(env.days_open) cards[1].querySelector('div:nth-child(2)').textContent = env.days_open;
            if(env.progress_pct) cards[2].querySelector('div div div').style.width = env.progress_pct + '%';
            if(env.trust_balance) cards[3].querySelector('div:nth-child(2)').textContent = env.trust_balance_formatted || env.trust_balance;
            // Parties / Property
            const meta = document.querySelectorAll('.kv .meta + div');
            if(env.parties){
              meta[0].textContent = env.parties.seller || env.parties.landlord || meta[0].textContent;
              meta[1].textContent = env.parties.buyer || env.parties.tenant || meta[1].textContent;
              meta[2].textContent = env.parties.attorneys || meta[2].textContent;
            }
            if(env.property){
              meta[3].textContent = env.property.address || meta[3].textContent;
              meta[4].textContent = env.property.bbl || meta[4].textContent;
              meta[5].textContent = env.property.board_agent || meta[5].textContent;
            }
            // Court / Agency
            const right = document.querySelectorAll('.row .card:nth-child(2) .kv .meta + div');
            if(env.court){
              right[0].textContent = env.court.venue || right[0].textContent;
              right[1].textContent = env.court.index || '—';
              right[2].textContent = env.court.judge || '—';
            }
            if(env.agency){
              right[3].textContent = env.agency.dob_bsa || right[3].textContent;
              right[4].textContent = env.agency.hpd_dhcr || right[4].textContent;
              right[5].textContent = env.agency.title || right[5].textContent;
            }
            // Timeline
            const timeline = await getCaseTimeline(CASE_ID);
            const t1 = document.querySelector('#t1 tbody'); t1.innerHTML='';
            (timeline||[]).forEach(x=>{
              const tr=document.createElement('tr');
              tr.innerHTML = `<td>${x.due}</td><td>${x.task}</td><td><span class="pill">${x.status||'Open'}</span></td>`;
              t1.appendChild(tr);
            });
            // Docs
            const docs = await getCaseDocs(CASE_ID);
            const d1 = document.querySelector('#t2 tbody'); d1.innerHTML='';
            (docs||[]).forEach(x=>{
              const tr=document.createElement('tr');
              tr.innerHTML = `<td>${x.type}</td><td>${x.name}</td><td>${x.status}</td><td><a class="btn" href="${x.url||'#'}" target="_blank">Open</a></td>`;
              d1.appendChild(tr);
            });
          }catch(e){
            console.error(e);
            alert('Failed to load case: '+ e.message);
          }
        }
        hydrateEnvelope();

        // Action buttons
        window.orderTitle = ()=> postCaseAction(CASE_ID, 'order_title', {}).then(()=>alert('Title ordered')).catch(e=>alert(e.message));
        window.generateRS = ()=> postCaseAction(CASE_ID, 'generate_rs_package', {}).then(()=>alert('RS package enqueued')).catch(e=>alert(e.message));

    </script>
</body>
</html>
